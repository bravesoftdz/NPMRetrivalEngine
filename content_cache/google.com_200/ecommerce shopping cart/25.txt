<!doctype html>
<html lang="en-US">
 <head> 
  <meta charset="utf-8"> 
  <title>krakenjs - Give your node.js express apps some extra arms</title> 
  <meta name="description" content="Give your node.js express apps some extra arms"> 
  <meta property="og:site_name" content="krakenjs"> 
  <meta property="og:title" content="krakenjs - Give your node.js express apps some extra arms"> 
  <meta property="og:description" content="Built at PayPal, Kraken builds upon express and enables environment-aware, dynamic configuration, advanced middleware capabilities, security, and app lifecycle events."> 
  <meta property="og:url" content="http://krakenjs.com"> 
  <meta property="og:image" content="http://krakenjs.com/img/krakenLogo.png"> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <link rel="stylesheet" href="/components/bootstrap/dist/css/bootstrap.min.css"> 
  <link rel="stylesheet" href="/css/syntax.css"> 
  <link rel="stylesheet" href="/css/kraken.css"> 
 </head> 
 <body data-spy="scroll" data-target="#documentation-nav"> 
  <header id="header" role="banner"> 
   <div class="ocean"> 
    <div class="rocks"> 
     <div class="container"> 
      <nav class="navbar navbar-default" role="navigation"> 
       <div class="navbar-header"> 
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
        <a href="http://paypal.github.io" class="navbar-brand"><img src="/img/paypalopensource.svg" width="160" height="20" alt="PayPal open source"></a> 
       </div> 
       <div class="collapse navbar-collapse" id="navbar-collapse"> 
        <ul class="nav navbar-nav"> 
         <li><a href="/index.html#documentation">Get Started</a></li> 
         <li><a href="/index.html#examples">Examples</a></li> 
         <li><a href="/blog.html">Blog</a></li> 
         <li><a href="https://github.com/krakenjs/kraken-js">GitHub</a></li> 
        </ul> 
       </div> 
      </nav> 
      <div class="col-sm-2 hidden-xs"> 
       <img src="/img/kraken.svg" alt="kraken logo" class="logo"> 
      </div> 
      <div class="col-sm-10"> 
       <h1>kraken<em>js</em></h1> 
       <h2>Give your node.js express apps some extra arms</h2> 
       <a class="btn btn-custom" href="/#getting-started">Get Started</a> 
       <a class="btn btn-custom secondary" href="/blog.html">Latest News</a> 
      </div> 
     </div> 
    </div> 
   </div> 
  </header> 
  <main role="main"> 
   <div id="intro"> 
    <div class="container"> 
     <div id="features" class="doc"> 
      <h2 id="the-kraken-suite">The kraken suite</h2> 
      <p>Kraken is a secure and scalable layer that extends <a href="http://expressjs.com/">express</a> by providing structure and convention. Though kraken is the main pillar of our framework, the following modules can also be used independently:</p> 
     </div> 
    </div> 
    <div class="container"> 
     <div id="modules"> 
      <div class="lusca col-sm-3"> 
       <a href="http://github.com/krakenjs/lusca"> <img src="/img/Lusca.svg"> <strong>Lusca</strong> Application security </a> 
      </div> 
      <div class="kappa col-sm-3"> 
       <a href="http://github.com/krakenjs/kappa"> <img src="img/Kappa.png"> <strong>Kappa</strong> NPM Proxy </a> 
      </div> 
      <div class="makara col-sm-3"> 
       <a href="makara.html"><img src="/img/Makara.svg"><strong>Makara</strong>Dust I18N</a> 
      </div> 
      <div class="adaro col-sm-3"> 
       <a href="adaro.html"><img src="/img/Adaro.svg"><strong>Adaro</strong>Dust Templating</a> 
      </div> 
     </div> 
    </div> 
   </div> 
   <div id="documentation"> 
    <div class="container"> 
     <nav id="documentation-nav" class="hidden-xs"> 
      <ul class="nav" role="navigation"></ul> 
     </nav> 
     <div id="content"> 
      <h2 id="getting-started">Getting started</h2> 
      <h4 id="0-install-nodejs-and-essential-build-tools">0. Install node.js and essential build tools</h4> 
      <p><a href="http://nodejs.org">Install node.js</a>, which will in turn install npm, which is used to manage all your dependencies.</p> 
      <p>In order for the <code class="highlighter-rouge">npm install</code> command to work, you need these essential build tools:</p> 
      <ul> 
       <li>Python 2.6 or 2.7</li> 
       <li>C++ compiler (GCC 4.2 or newer)</li> 
       <li>Make</li> 
      </ul> 
      <p>The method of installing these pre-requisites will vary by operating system.</p> 
      <h4 id="1-install-the-generator">1. Install the generator</h4> 
      <p>Start by installing the generator globally using npm: <code class="highlighter-rouge">[sudo] npm install -g yo generator-kraken bower grunt-cli</code></p> 
      <h4 id="2-create-a-project">2. Create a project</h4> 
      <p>Once installed, you can create a basic project using the generator. Type <code class="highlighter-rouge">yo kraken</code> and follow the prompts:</p> 
      <figure class="highlight">
       <pre><code class="language-text" data-lang="text">$ yo kraken

     ,'""`.
hh  / _  _ \
    |(@)(@)|   Release the Kraken!
    )  __  (
   /,'))((`.\
  (( ((  )) ))
   `\ `)(' /'

Tell me a bit about your application:

[?] Name: HelloWorld
[?] Description: A test kraken application
[?] Author: YourName GoesHere
...</code></pre>
      </figure> 
      <p>The generator will create a new directory for your application, set up an empty project and download all the necessary dependencies.</p> 
      <h4 id="3-start-your-server">3. Start your server</h4> 
      <p>To run your project, just go into the newly created directory and type <code class="highlighter-rouge">npm start</code>:</p> 
      <figure class="highlight">
       <pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span><span class="nb">cd </span>HelloWorld
<span class="gp">$ </span>npm start

<span class="gp">&gt; </span>helloworld@0.1.0 start ~/HelloWorld
<span class="gp">&gt; </span>node index.js

<span class="o">[</span>development] Listening on http://localhost:8000</code></pre>
      </figure> 
      <p>Your kraken application will start up on port 8000. You can visit it at <a href="http://localhost:8000">http://localhost:8000</a>. If all goes well, your very polite application will say hello.</p> 
      <h3 id="structure-of-a-project">Structure of a Project</h3> 
      <p>Kraken keeps your code organized by splitting up the configuration, content+templates and routing logic into different places so that it’s easy to keep track of everything and to easily swap out components. Let’s start by looking at the base structure of the project you just created:</p> 
      <figure class="highlight">
       <pre><code class="language-text" data-lang="text">/config  
Application configuration including environment-specific configs

/controllers
Routes and logic

/locales
Language specific content bundles

/lib
Common libraries to be used across your app

/models
Models

/public
Web resources that are publicly available

/public/templates
Server and browser-side templates

/tasks
Grunt tasks to be automatically registered by [grunt-config-dir](https://github.com/logankoester/grunt-config-dir)

/tests
Unit and functional test cases

index.js
Application entry point</code></pre>
      </figure> 
      <p>Let’s say you want to create a simple application. As your application grows, this becomes unmanageable and messy. Kraken helps you stay organized by imposing a sound structure and strategy.</p> 
      <p>First let’s look at our basic <code class="highlighter-rouge">index.js</code> entry point:</p> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>


<span class="kd">var</span> <span class="nx">kraken</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'kraken-js'</span><span class="p">),</span>
    <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'express'</span><span class="p">)(),</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">onconfig</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'view engines:js:renderer:arguments'</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>

            <span class="nx">next</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">config</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="cm">/* more options are documented in the README */</span>
    <span class="p">},</span>
    <span class="nx">port</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span> <span class="o">||</span> <span class="mi">8000</span><span class="p">;</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">kraken</span><span class="p">(</span><span class="nx">options</span><span class="p">));</span>


<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'[%s] Listening on http://localhost:%d'</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">env</span><span class="p">,</span> <span class="nx">port</span><span class="p">);</span>
<span class="p">});</span></code></pre>
      </figure> 
      <p>As you can see from the <code class="highlighter-rouge">index.js</code> entry point, kraken is just an express middleware. The configuration is just an object that defines an <code class="highlighter-rouge">onconfig</code>. That function is called when the application begins configuration.</p> 
      <p>There are a few other <a href="https://github.com/krakenjs/kraken-js#options">options that can be set</a> as well as the <code class="highlighter-rouge">onconfig</code> handler.</p> 
      <p>So, where’s all the configuration? Where are the routes?</p> 
      <h3 id="configuration">Configuration</h3> 
      <p>Kraken’s configuration can be found in the <code class="highlighter-rouge">config/config.json</code> file.</p> 
      <p>This JSON file contains key value pairs that are loaded at runtime. The advantage of this is that all your application configuration is in a single, well-known place; and you can swap it out without having to touch a single line of code.</p> 
      <p>This config file is also where you can define middleware and specify its load-order. To find out more, check out <a href="https://github.com/krakenjs/meddleware">meddleware</a>.</p> 
      <h4 id="development-vs-production-environments">Development vs. Production environments</h4> 
      <p>A common scenario is that development environments have slightly different parameters than production. Kraken allows you to define a second file <code class="highlighter-rouge">config/development.json</code> with alternate values.</p> 
      <p>You can control which file is loaded by defining an environment variable: <code class="highlighter-rouge">NODE_ENV</code> and setting its value to <code class="highlighter-rouge">production</code> or <code class="highlighter-rouge">development</code> as appropriate.</p> 
      <h3 id="security">Security</h3> 
      <p>Security is provided out-of-the-box by the <a href="http://github.com/krakenjs/lusca">Lusca</a> module. Lusca is middleware for express, and it follows <a href="http://www.owasp.org/">OWASP</a> best practices by enabling the following request/response headers for all calls:</p> 
      <ul> 
       <li><a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29">Cross Site Request Forgery</a></li> 
       <li><a href="https://www.owasp.org/index.php/Content_Security_Policy">Content Security Policy</a></li> 
       <li><a href="http://support.microsoft.com/kb/290333">Platform for Privacy Preferences Project</a></li> 
       <li><a href="https://www.owasp.org/index.php/Clickjacking">X-FRAME-OPTIONS</a></li> 
       <li>And more!</li> 
      </ul> 
      <p>If you want to disable or configure them, please see the <a href="http://github.com/krakenjs/lusca">Lusca README</a>.</p> 
      <h3 id="routes">Routes</h3> 
      <p>Kraken moves the routing logic into separate files in the <code class="highlighter-rouge">controllers</code> folder, allowing you to group routes by functionality.</p> 
      <p>For example, a route for your home page, would use a <code class="highlighter-rouge">controllers/index.js</code> file that looks as follows:</p> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">IndexModel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'../models/index'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">router</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IndexModel</span><span class="p">();</span>

    <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="nx">model</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span></code></pre>
      </figure> 
      <p>This file would define the routes and the logic for the home page. The advantage of keeping routes and logic segregated in individual files starts to show as the application grows. If something fails, it’s very easy to pinpoint where things went wrong.</p> 
      <p>Kraken is built on top of express, so the rest of the logic should be familiar to Node developers.</p> 
      <p>New to 1.x, your controllers are given an instance of your top-level <code class="highlighter-rouge">router</code> instead of the <code class="highlighter-rouge">app</code> instance, and routes are automatically determined for you based on folder-structure. For example, if you wanted to specify a handler for <code class="highlighter-rouge">/users</code>, simple drop this in <code class="highlighter-rouge">/controllers/users/index.js</code>:</p> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">router</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// notice that my route is '/' but I respond to '/users'</span>
    <span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">'you can find me at /users'</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span></code></pre>
      </figure> 
      <p>With 1.x, route registration is supercharged and very flexible. Check out <a href="https://github.com/krakenjs/express-enrouten">express-enrouten</a> to learn more.</p> 
      <h3 id="models">Models</h3> 
      <p>Kraken also separates data models from the controller logic, resulting in cleaner, more organized code. Data models live in the <code class="highlighter-rouge">models</code> folder.</p> 
      <p>When a new controller is created, the framework will also create a simple model for you.</p> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">IndexModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">name</span><span class="p">:</span> <span class="s1">'myApp'</span>
    <span class="p">};</span>
<span class="p">};</span></code></pre>
      </figure> 
      <p>While not very complex, this model serves as a base to build upon. See the <a href="https://github.com/krakenjs/kraken-example-with-shoppingcart">Kraken Shopping Cart</a> example for more complex usage of models.</p> 
      <h3 id="templates">Templates</h3> 
      <p>Kraken uses <a href="http://linkedin.github.io/dustjs/">LinkedIn’s Dust</a> as the templating language of choice. <a href="http://github.com/krakenjs/adaro">Adaro</a> is the module responsible for rendering and managing the templates.</p> 
      <p>Templates are loaded from the <code class="highlighter-rouge">public/templates</code> directory. Because they reside in the public folder, this allows kraken to use the same templates on the server side as well as the client side, allowing you to reuse code.</p> 
      <p>If we wanted to greet our customers, a basic template would be:</p> 
      <figure class="highlight">
       <pre><code class="language-html" data-lang="html"><span class="nt">&lt;h1&gt;</span>Hello {name}!<span class="nt">&lt;/h1&gt;</span></code></pre>
      </figure> 
      <h3 id="localization">Localization</h3> 
      <p>Thanks to <a href="http://github.com/krakenjs/makara">Makara</a>, kraken has the ability to load content bundles on the fly, based on the request context. If we wanted to greet a user in their native language (e.g.: Spanish), we can simply add this context to the response before rendering the template:</p> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="nx">res</span><span class="p">.</span><span class="nx">locals</span><span class="p">.</span><span class="nx">locale</span> <span class="o">=</span> <span class="p">{</span> <span class="na">language</span><span class="p">:</span> <span class="s1">'es'</span><span class="p">,</span> <span class="na">country</span><span class="p">:</span> <span class="s1">'ES'</span> <span class="p">};</span>

<span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Antonio Banderas'</span> <span class="p">};</span>
<span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span><span class="nx">model</span><span class="p">);</span></code></pre>
      </figure> 
      <p>We would also change our template as follows, using a <code class="highlighter-rouge">@pre type="content"</code> tag:</p> 
      <figure class="highlight">
       <pre><code class="language-html" data-lang="html"><span class="nt">&lt;h1&gt;</span>{@pre type="content" key="index.greeting"/}<span class="nt">&lt;/h1&gt;</span></code></pre>
      </figure> 
      <p>This instructs the framework to pick up the index.greeting string from one of the locale content bundles.</p> 
      <p>The <code class="highlighter-rouge">locales</code> directory holds these bundles, organized by country and language. The bundles are nothing more than simple <code class="highlighter-rouge">key=value</code> .property files. If our sample application caters to English and Spanish speakers, we would create two bundles:</p> 
      <p><code class="highlighter-rouge">locales/US/en/index.properties</code> to hold <code class="highlighter-rouge">index.greeting=Hello {name}!</code></p> 
      <p>and</p> 
      <p><code class="highlighter-rouge">locales/ES/es/index.properties</code> to hold <code class="highlighter-rouge">index.greeting=Hola {name}!</code></p> 
      <p>So, in the above example, since the language and country are set to <code class="highlighter-rouge">es</code> and <code class="highlighter-rouge">ES</code> respectively, the framework would pick the second bundle and display:</p> 
      <figure class="highlight">
       <pre><code class="language-text" data-lang="text">Hola Antonio Banderas!</code></pre>
      </figure> 
      <h3 id="grunt-tasks">Grunt tasks</h3> 
      <p>Generated projects include the following grunt tasks by default:</p> 
      <ul> 
       <li><code class="highlighter-rouge">$ grunt build</code> will localize and compile your templates to the <code class="highlighter-rouge">.build</code> directory, and also copy static assets there</li> 
       <li><code class="highlighter-rouge">$ grunt test</code> will run jshint as well as any mocha tests</li> 
      </ul> 
      <h3 id="faq">FAQ</h3> 
      <h4 id="how-can-i-disable-csrf-for-specific-routes">How can I disable CSRF for specific routes?</h4> 
      <p>If you need to disable the <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)">CSRF</a> protection provided by the <a href="https://github.com/krakenjs/lusca#luscacsrfoptions">lusca module</a> for certain paths –a common use case for APIs– you can accomplish this through the configuration file, on the middleware section. The strategy is to first disable the default CSRF handling, and then re-enable it for the routes we want to protect. This can be done using a <a href="http://www.regular-expressions.info/lookaround.html">negative lookahead regular expression</a>.</p> 
      <blockquote> 
       <p><strong>Example:</strong> Protect all routes, <em>except</em> those starting with <code class="highlighter-rouge">/api</code> :</p> 
      </blockquote> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
    <span class="s2">"middleware"</span><span class="err">:</span> <span class="p">{</span>
        <span class="cm">/** * Override the default lusca configuration to disable CSRF handling. */</span>
        <span class="s2">"appsec"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"module"</span><span class="err">:</span> <span class="p">{</span>
                <span class="s2">"arguments"</span><span class="err">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">"xframe"</span><span class="p">:</span> <span class="s2">"SAMEORIGIN"</span><span class="p">,</span>
                        <span class="s2">"p3p"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                        <span class="s2">"csp"</span><span class="p">:</span> <span class="kc">false</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>

        <span class="cm">/** * Enable *ONLY* CSRF filtered by route. * Note: The route "regex" needs the double parens * because of how express parses route strings. */</span>
        <span class="s2">"csrf"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"enabled"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s2">"priority"</span><span class="err">:</span> <span class="mi">111</span><span class="p">,</span>
            <span class="s2">"route"</span><span class="err">:</span> <span class="s2">"/((?!api))*"</span><span class="p">,</span>
            <span class="s2">"module"</span><span class="err">:</span> <span class="p">{</span>
                <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"lusca"</span><span class="p">,</span>
                <span class="s2">"method"</span><span class="err">:</span> <span class="s2">"csrf"</span><span class="p">,</span>
                <span class="s2">"arguments"</span><span class="err">:</span> <span class="p">[</span> <span class="p">{}</span> <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
      </figure> 
      <hr> 
      <h4 id="how-can-i-register-middleware-in-config">How can I register middleware in config?</h4> 
      <p>We use meddleware to facilitate the registration of middleware.</p> 
      <blockquote> 
       <p><strong>Example:</strong> Let’s define a middleware to let any origin access the resource. Say it’s in ‘./middlewares/cors’</p> 
      </blockquote> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin"</span><span class="p">,</span> <span class="s2">"*"</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Headers"</span><span class="p">,</span> <span class="s2">"Origin, X-Requested-With, Content-Type, Accept"</span><span class="p">);</span>
        <span class="nx">next</span><span class="p">();</span>
    <span class="p">};</span>
<span class="p">};</span></code></pre>
      </figure> 
      <p>I can include above middleware in my config like so:</p> 
      <figure class="highlight">
       <pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="s2">"middleware"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"cors"</span><span class="err">:</span> <span class="p">{</span>
            <span class="s2">"enabled"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="s2">"priority"</span><span class="err">:</span> <span class="mi">119</span><span class="p">,</span>
            <span class="s2">"module"</span><span class="err">:</span> <span class="p">{</span>
                <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"path: ./middlewares/cors"</span> <span class="c1">//"path" is a shortstop-handler</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
      </figure> 
      <hr> 
      <h4 id="im-encountering-typeerror-cannot-call-method-replace-of-undefined-when-i-run-my-app-help">I’m encountering <code class="highlighter-rouge">TypeError: Cannot call method 'replace' of undefined</code> when I run my app. Help!</h4> 
      <p>If you’re running in production mode, Kraken will look for pre-compiled templates in the <code class="highlighter-rouge">./.build</code> directory. This error likely indicates that you have not built your project. Try running <code class="highlighter-rouge">grunt build</code>.</p> 
      <hr> 
      <h4 id="how-should-i-access-configuration-values-in-my-application">How should I access configuration values in my application?</h4> 
      <p>Since kraken compiles your configuration at runtime – taking in to account the environment plus shortstop handlers – you should not attempt to <code class="highlighter-rouge">require</code> the JSON directly.</p> 
      <p>You can access the configuration from the request: <code class="highlighter-rouge">req.app.kraken.get("my:config:property")</code>.</p> 
      <p>You can also access the configuration in an <code class="highlighter-rouge">onconfig</code> handler as discussed here: <a href="https://github.com/krakenjs/kraken-js#options">https://github.com/krakenjs/kraken-js#options</a></p> 
      <p>If you are using an onconfig handler, just be aware that startup is asynchronous. I.e. don’t rely on the config value until onconfig has fired, or the app emits the start event.</p> 
      <hr> 
      <h4 id="how-can-i-contribute-to-this-project">How can I contribute to this project?</h4> 
      <p>Bugs and new features should be submitted using <a href="https://github.com/krakenjs/kraken-js/issues/new">GitHub issues</a>. Please include with a detailed description and the expected behavior. If you would like to submit a change yourself do the following steps.</p> 
      <ul> 
       <li>Fork it.</li> 
       <li>Create a feature branch.</li> 
       <li>Commit a test that fails due to the bug</li> 
       <li>Commit a fix that makes the test pass</li> 
       <li>Open a <a href="https://github.com/krakenjs/kraken-js/pulls">pull request</a>.</li> 
      </ul> 
      <p>This page is built from the <code class="highlighter-rouge">krakenjs.github.io</code> repository. To refine the document even further, you can <a href="https://github.com/krakenjs/krakenjs.github.io/issues/new">create an issue</a>, or better yet, submit a <a href="https://github.com/krakenjs/krakenjs.github.io/pulls">pull request</a>.</p> 
      <h3 id="examples">Examples</h3> 
      <p>Here’s a few examples to get you going with kraken:</p> 
      <ul> 
       <li> <p><strong><a href="https://github.com/krakenjs/kraken-example-with-shoppingcart">Kraken Shopping Cart</a></strong><br> An end-to-end example showing how to build a shopping cart that integrates with PayPal</p> </li> 
       <li> <p><strong><a href="https://github.com/krakenjs/kraken-example-with-passport">Kraken Passport Integration</a></strong><br> Authenticate and securely store user credentials using Passport, Mongo and bcrypt</p> </li> 
       <li> <p><strong><a href="https://github.com/krakenjs/kraken-example-with-i18n">Localization and Internationalization</a></strong><br> Greet users in different languages. Shows support for localized content bundles.</p> </li> 
       <li> <p><strong><a href="https://github.com/krakenjs/kraken-example-with-specialization">Specialization</a></strong><br> Show different layouts to different users based on a set of rules (locality, A/B testing, etc).</p> </li> 
      </ul> 
      <h3 id="recommended-patterns">Recommended patterns</h3> 
      <ul> 
       <li> <p><strong><a href="https://github.com/krakenjs/kraken-js/wiki/Using-kraken-js-middleware-config-to-setup-environment-specific-routes">Environment specific routing</a></strong> Use <code class="highlighter-rouge">NODE_ENV</code> specific middleware to set up routing per-environment</p> </li> 
       <li> <p><strong><a href="https://github.com/krakenjs/kraken-js/wiki/Using-krakenjs-middleware-config-for-express-subapps-mounting">Subapp mounting</a></strong> Use kraken middleware for express subapp mounting</p> </li> 
       <li> <p><strong><a href="https://github.com/krakenjs/kraken-js/wiki/Using-krakenjs-middleware-config-for-whitelisting-and-blacklisting-routes">Whitelisting and blacklisting routes</a></strong> Use kraken middleware configuration to whitelist and blacklist routes</p> </li> 
      </ul> 
     </div> 
    </div> 
   </div> 
  </main> 
  <footer id="footer" role="contentinfo"> 
   <div class="container"> 
    <ul> 
     <li>Designed with ? and care by <a href="http://www.paypal.com" alt="PayPal">PayPal</a></li> 
     <li>Code licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0.html" alt="Apache License.">Apache License v2.0</a></li> 
     <li>Documentation licensed under <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.en_US">Creative Commons Attribution 4.0 International License</a></li> 
    </ul> 
   </div> 
  </footer> 
  <script src="/components/jquery/dist/jquery.min.js"></script> 
  <script src="/components/bootstrap/dist/js/bootstrap.min.js"></script> 
  <script src="/js/kraken.js"></script> 
  <script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-45342705-1', 'krakenjs.com');
    ga('send', 'pageview');
</script>   
 </body>
</html>