<!doctype html>
<!--[if lt IE 7]>  <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en-US" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if IE 7]>     <html class="no-js lt-ie9 lt-ie8" lang="en-US" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if IE 8]>     <html class="no-js lt-ie9" lang="en-US" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns#">
 <head> 
  <meta charset="UTF-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
  <meta name="viewport" content="width=device-width"> 
  <link href="/wp-content/uploads/2016/03/favicon.png" type="image/png" rel="icon"> 
  <link rel="profile" href="http://gmpg.org/xfn/11"> 
  <link rel="pingback" href="https://stormpath.com/xmlrpc.php"> 
  <title>Easy API Key Management for Node - A Sample App</title> 
  <meta name="description" content="Get a walk through of an Express js application, including how to generate and show an API key for a logged in user"> 
  <meta name="robots" content="noodp"> 
  <link rel="canonical" href="https://stormpath.com/blog/express-sample-api-key-management"> 
  <meta property="og:locale" content="en_US"> 
  <meta property="og:type" content="article"> 
  <meta property="og:title" content="Easy API Key Management for Node - A Sample App"> 
  <meta property="og:description" content="Get a walk through of an Express js application, including how to generate and show an API key for a logged in user"> 
  <meta property="og:url" content="https://stormpath.com/blog/express-sample-api-key-management"> 
  <meta property="og:site_name" content="Stormpath User Identity API"> 
  <meta property="article:section" content="Node"> 
  <meta property="article:published_time" content="2014-09-12T00:00:00-07:00"> 
  <meta property="article:modified_time" content="2016-11-01T10:30:30-07:00"> 
  <meta property="og:updated_time" content="2016-11-01T10:30:30-07:00"> 
  <meta property="og:image" content="http://stormpath.com/wp-content/uploads/2016/03/og-node-1200x630.jpg"> 
  <meta name="twitter:card" content="summary_large_image"> 
  <meta name="twitter:description" content="Get a walk through of an Express js application, including how to generate and show an API key for a logged in user"> 
  <meta name="twitter:title" content="Easy API Key Management for Node - A Sample App"> 
  <meta name="twitter:image" content="http://stormpath.com/wp-content/uploads/2016/03/og-node-1200x630.jpg"> 
  <meta property="DC.date.issued" content="2014-09-12T00:00:00-07:00"> 
  <link rel="dns-prefetch" href="//s0.wp.com"> 
  <link rel="dns-prefetch" href="//s.w.org"> 
  <link rel="alternate" type="application/rss+xml" title="Stormpath User Identity API » Feed" href="https://stormpath.com/feed"> 
  <link rel="alternate" type="application/rss+xml" title="Stormpath User Identity API » Comments Feed" href="https://stormpath.com/comments/feed"> 
  <link rel="alternate" type="application/rss+xml" title="Stormpath User Identity API » Easy API Key Management for Node – A Sample App Comments Feed" href="https://stormpath.com/blog/express-sample-api-key-management/feed"> 
  <script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/stormpath.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};
			!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script> 
  <style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style> 
  <link rel="stylesheet" id="crayon-theme-stormpath-css" href="https://stormpath.com/wp-content/uploads/crayon-syntax-highlighter/themes/stormpath/stormpath.css?ver=_2.7.2_beta" type="text/css" media="all"> 
  <link rel="stylesheet" id="crayon-font-monaco-css" href="https://stormpath.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" type="text/css" media="all"> 
  <link rel="stylesheet" id="contact-form-7-css" href="https://stormpath.com/wp-content/plugins/contact-form-7/includes/css/styles.css?ver=4.7" type="text/css" media="all"> 
  <link rel="stylesheet" id="stormpath-style-css" href="https://stormpath.com/wp-content/themes/stormpath/style.css?ver=4.8.2" type="text/css" media="all"> 
  <link rel="stylesheet" id="jetpack_css-css" href="https://stormpath.com/wp-content/plugins/jetpack/css/jetpack.css?ver=4.7.1" type="text/css" media="all"> 
  <script type="text/javascript" src="https://stormpath.com/wp-includes/js/jquery/jquery.js?ver=1.12.4"></script> 
  <script type="text/javascript" src="https://stormpath.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1"></script> 
  <script type="text/javascript">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script> 
  <script type="text/javascript" src="https://stormpath.com/wp-content/plugins/jetpack/modules/related-posts/related-posts.js?ver=20150408"></script> 
  <link rel="https://api.w.org/" href="https://stormpath.com/wp-json/"> 
  <link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://stormpath.com/xmlrpc.php?rsd"> 
  <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://stormpath.com/wp-includes/wlwmanifest.xml"> 
  <link rel="shortlink" href="https://stormpath.com/?p=2513"> 
  <link rel="alternate" type="application/json+oembed" href="https://stormpath.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fstormpath.com%2Fblog%2Fexpress-sample-api-key-management"> 
  <link rel="alternate" type="text/xml+oembed" href="https://stormpath.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fstormpath.com%2Fblog%2Fexpress-sample-api-key-management&amp;format=xml"> 
  <script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');

fbq('init', '986262161469311');
fbq('track', "PageView");</script> 
  <noscript>
   &lt;img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=986262161469311&amp;amp;ev=PageView&amp;amp;noscript=1"&gt;
  </noscript> 
  <script src="https://cdn.optimizely.com/js/225847041.js"></script> 
  <style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style> 
  <meta name="generator" content="Powered by Visual Composer - drag and drop page builder for WordPress."> 
  <!--[if lte IE 9]><link rel="stylesheet" type="text/css" href="https://stormpath.com/wp-content/plugins/js_composer/assets/css/vc_lte_ie9.min.css" media="screen"><![endif]-->
  <!--[if IE  8]><link rel="stylesheet" type="text/css" href="https://stormpath.com/wp-content/plugins/js_composer/assets/css/vc-ie8.min.css" media="screen"><![endif]-->
  <noscript>
   <style type="text/css"> .wpb_animate_when_almost_visible { opacity: 1; }</style>
  </noscript>
 </head> 
 <body id="blog" class="post-template-default single single-post postid-2513 single-format-standard stretched wpb-js-composer js-comp-ver-4.11.2.1 vc_responsive"> 
  <!--[if lt IE 8]>
<p class="chromeframe">You are using an <strong>outdated</strong> browser. Please "browsehappy.com" upgrade your browser or "www.google.com/chromeframe/?redirect=true" activate Google Chrome Frame to improve your experience.</p>
<![endif]--> 
  <div id="wrapper" class="clearfix"> 
   <header class="main-navbar"> 
    <nav class="navbar navbar-default navbar-fixed-top" id="main-nav-menu"> 
     <div class="container main-navbar-container"> 
      <div class="navbar-header-container"> 
       <div class="navbar-header"> 
        <a href="https://stormpath.com" class="standard-logo main-nav-logo" data-dark-logo="http://stormpath.com/wp-content/uploads/2017/08/logos.png"><img src="https://stormpath.com/wp-content/uploads/2017/08/logos.png" alt="Stormpath Logo"></a> 
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-navbar-collapsable" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> 
       </div> 
      </div> 
      <style>
              .global-msg {
                  color: #bbb;
                  text-align: right;
                  margin-top: 18px;
                  padding: 0px;
              }
          </style> 
      <div class="collapse navbar-collapse" id="main-navbar-collapsable"> 
       <ul id="menu-menu-1" class="nav navbar-nav main-navbar__links">
        <li id="menu-item-5143" class="menu-item menu-item-type-post_type menu-item-object-page current_page_parent menu-item-5143"><a class="main-navbar__link" href="https://stormpath.com/blog">Blog</a></li> 
       </ul> 
       <div class="global-msg visible-lg-block">
        <p>The Stormpath API shut down on August 17, 2017. Thank you to all the developers who have used Stormpath.</p> 
       </div> 
      </div> 
     </div> 
    </nav> 
   </header> 
   <div id="content" class="site-content"> 
    <section id="content"> 
     <div class="content-wrap nopadding"> 
      <div class="blog_header nopadding"> 
       <div class="container blog_header_rule nopadding"> 
        <h1 class="entry-title col-md-8 col-sm-12 col-xs-12 nopadding">Easy API Key Management for Node – A Sample App</h1> 
       </div> 
      </div> 
      <div class="container clearfix nopadding"> 
       <main id="blog-content" class="site-main" role="main"> 
        <div class="col-md-8 col-sm-12 col-xs-12 nobottommargin nopadding clearfix"> 
         <article id="post-2513" class="post-2513 post type-post status-publish format-standard hentry category-node" role="article"> 
          <div class="post-meta"> 
           <div class="author_avatar"> 
            <img alt="" src="https://secure.gravatar.com/avatar/7b07d4a0708d14291681bb4f80ba857b?s=96&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/7b07d4a0708d14291681bb4f80ba857b?s=192&amp;d=mm&amp;r=g 2x" class="avatar avatar-96 photo" height="96" width="96"> 
           </div> 
           <p class="author-and-date"> by Team Stormpath <span class="dividers">|</span> September 12, 2014 <span class="dividers">|</span> </p> 
           <ul class="post-categories"> 
            <li><a href="https://stormpath.com/blog/category/node" rel="category tag">Node</a></li>
           </ul> 
          </div> 
          <div class="entry-content"> 
           <p><strong>Update 2/29/16:</strong> These code examples have been updated to reflect the 3.0 release of <a href="https://github.com/stormpath/express-stormpath/">the express-stormpath integration</a>.</p> 
           <p>When you build a REST API, creating the infrastructure required to secure an API with keys, OAuth tokens, and scopes can be tedious, risky and time-consuming. Fortunately, Stormpath just added API key management to our <a href="https://github.com/stormpath/express-stormpath">express-stormpath</a> package. Now, API and web app developers using express.js can generate and manage API Keys and OAuth tokens as well as lookup and secure developer accounts – all without custom OAuth code.</p> 
           <h2 id="what-were-building">What We’re Building<a href="#what-were-building" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>This post will walk you through building an express application that lets you:</p> 
           <ul> 
            <li>Create a new account (register) with email and password.</li> 
            <li>Log into your new account (login) with email and password.</li> 
            <li>Display a dashboard page once you’ve logged in, that is only accessible to registered users.</li> 
            <li>Automatically generate and show an API Key for a logged in user on the dashboard.</li> 
            <li>Make a REST call using Basic authentication.</li> 
            <li>Generate an OAuth token with scope.</li> 
            <li>Make a REST call using Bearer authentication.</li> 
            <li>Allow a logged in user to log out of their account (logout).</li> 
           </ul> 
           <p>The API I built is a simple one: it returns the weather for a requested city in Fahrenheit.</p> 
           <h2 id="before-we-start">Before We Start…<a href="#before-we-start" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>Note the directory structure of the <a href="https://github.com/stormpath/stormpath-express-api-auth-sample">github repository for this project</a>. All server-side logic (<em>which this post focuses on</em>) will be in <code>server.js</code>.</p> 
           <h2 id="login">Login<a href="#login" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>User registration and login are built into express-stormpath, and a good place to start with any app.</p> 
           <p><img src="https://stormpath.com/wp-content/uploads/2016/04/nodeapisample1.png" alt="Default Login Screen Stormpath Express API Management"></p> 
           <p>Let’s take a look at the code that makes this happen. We first import the necessary packages (all code in this post goes into the root node file, in my case <code>/server.js)</code>:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd822687105468" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
var express = require('express');
var server = express();
var stormpath = require('express-stormpath');

// Now, we setup the server to use Stormpath.
server.use(stormpath.init(server, {
  application: {
    href: process.env['STORMPATH_APPLICATION_HREF']
  },
  web: {
    login: {
      nextUri: '/dashboard',
    },
    oauth2: {
      client_credentials: {
        accessToken: {
          ttl: 3600
        }
      }
    }
  }
}));
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-11">
                   11
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-12">
                   12
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-13">
                   13
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-14">
                   14
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-15">
                   15
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-16">
                   16
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-17">
                   17
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-18">
                   18
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-19">
                   19
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-20">
                   20
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-21">
                   21
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd822687105468-22">
                   22
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd822687105468-23">
                   23
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-1">
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">express</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-e">require</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'express'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-2">
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">server</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-e">express</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-3">
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">stormpath</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-e">require</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'express-stormpath'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-4">
                   &nbsp;
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-5">
                   <span class="crayon-c">// Now, we setup the server to use Stormpath.</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-6">
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-st">use</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">stormpath</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">init</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-7">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">application</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-8">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">href</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">process</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">env</span>
                   <span class="crayon-sy">[</span>
                   <span class="crayon-s">'STORMPATH_APPLICATION_HREF'</span>
                   <span class="crayon-sy">]</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-9">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-10">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">web</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-11">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">login</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-12">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">nextUri</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'/dashboard'</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-13">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-14">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">oauth2</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-15">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">client_credentials</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-16">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">accessToken</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-17">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">ttl</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">3600</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-18">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-19">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-20">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-21">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd822687105468-22">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd822687105468-23">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>The <code>application</code> field points Stormpath to the right application for the project. Users will be pointed to the <code>nextUri</code> after logging in or creating an account. As for the Oauth fields, we will get back to those a little later. It is important to avoid storing your API Key, Application Href, and Secret Keys (used for user sessions) in plain text in your code. Instead, export these as environment variables and access them in server.js by doing <code>process.env['name_of_env_var']</code>. Stormpath-express is capable of reading the environment variables itself, so exporting them to your system is enough; however, above I show how to manually set the stormpath-express variables in code.</p> 
           <p>Once a user goes to our site (the root of the site or ‘/’), we need to redirect them to the custom login page provided by stormpath-express, which by default lives at <code>/login</code>.</p> 
           <p></p> 
           <div id="crayon-59cd498fbd82f517806268" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
server.get('/', function(req, res) {
  res.redirect(302, '/login');
});
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd82f517806268-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd82f517806268-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd82f517806268-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd82f517806268-4">
                   4
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd82f517806268-1">
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">get</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'/'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd82f517806268-2">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">redirect</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-cn">302</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'/login'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd82f517806268-3">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd82f517806268-4">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>Now that we have login and account creation out of the way, let’s use API Keys to protect our weather API.</p> 
           <h2 id="api-key-generation">API Key Generation<a href="#api-key-generation" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>First, we need to give the user an API key to use. This way, any REST endpoint is protected and accessible only to users who possess a valid API Key and Secret. Once a user logs in or creates an account, they will go directly to the application dashboard, where an API Key is automatically generated and displayed.</p> 
           <p><img src="https://stormpath.com/wp-content/uploads/2016/04/nodeapisample2.png" alt="Dashboard with API Key"></p> 
           <p>Let’s see what the code looks like:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd833832209987" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
server.get('/dashboard', stormpath.loginRequired, function(req, res) {
  res.locals.user.getApiKeys(function(err, collectionResult) {
    if (collectionResult.items.length === 0) {
      res.locals.user.createApiKey(function(err, apiKey) {
        res.locals.apiKeyId = apiKey.id;
        res.locals.apiKeySecret = apiKey.secret;
        res.locals.username = res.locals.user.username;
        res.render('dashboard.ejs');
      });
    } else {
      collectionResult.each(function(apiKey) {
        res.locals.apiKeyId = apiKey.id;
        res.locals.apiKeySecret = apiKey.secret;
        res.locals.username = res.locals.user.username;
        res.render('dashboard.ejs');
      });
    }
  })
});
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-11">
                   11
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-12">
                   12
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-13">
                   13
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-14">
                   14
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-15">
                   15
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-16">
                   16
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-17">
                   17
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-18">
                   18
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd833832209987-19">
                   19
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd833832209987-20">
                   20
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-1">
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">get</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'/dashboard'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">stormpath</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">loginRequired</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-2">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">user</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">getApiKeys</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">err</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">collectionResult</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-3">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-st">if</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">collectionResult</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">items</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">length</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">===</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">0</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-4">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">user</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">createApiKey</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">err</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">apiKey</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-5">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">apiKeyId</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">apiKey</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">id</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-6">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">apiKeySecret</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">apiKey</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">secret</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-7">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">username</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">user</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">username</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-8">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">render</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'dashboard.ejs'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-9">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-10">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-st">else</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-11">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">collectionResult</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-st">each</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">apiKey</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-12">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">apiKeyId</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">apiKey</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">id</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-13">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">apiKeySecret</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">apiKey</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">secret</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-14">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">username</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">user</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">username</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-15">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">render</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'dashboard.ejs'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-16">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-17">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-18">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd833832209987-19">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd833832209987-20">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>By calling <code>res.locals.user.getApiKeys</code> we ask Stormpath to return a collection of an account’s API Keys. In the <code>if</code> statement, we check if the account has any API Keys. If not, Stormpath generates one and returns it to the client. In the <code>else</code> statement, where an API Key has already been generated, Stormpath returns the first API Key available.</p> 
           <h2 id="making-a-rest-call-with-basic-authentication">Making a REST Call With Basic Authentication<a href="#making-a-rest-call-with-basic-authentication" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>Now the user is logged in and has access using the API Key Id and Secret. Let’s have them make an API call.</p> 
           <p><img src="https://stormpath.com/wp-content/uploads/2016/04/nodeapisample3.png" alt="Basic Authentication Dashboard"></p> 
           <p>In this sample application, the REST endpoint returns a floating point number, representing the weather in the requested city. For example if a GET request is made to <code>/weather/London</code>, a floating point number with one digit after the decimal is returned to the client representing the weather in London. Only one endpoint is available in the form of <code>weather/{{city}}</code>, where city can be any one of the four cities provided by the radio buttons.</p> 
           <p>First, the client has to Base64 encode the key:secret pair and send this to the server as the authorization header. In angular.js, the HTTP request would look something like this:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd837445877831" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$http({
  method: 'GET',
  url: '/weather/' + $scope.city,
  headers: { 'Authorization': 'Basic ' + sharedProperties.getEncodedAuth() }
}).success(function(data, status, headers, config) {
  $scope.temp = data + ' F';
  $scope.myCity = $scope.city;
}).error(function(data, status, headers, config) {
  $window.alert('Error');
});
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd837445877831-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd837445877831-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd837445877831-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd837445877831-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd837445877831-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd837445877831-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd837445877831-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd837445877831-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd837445877831-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd837445877831-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd837445877831-11">
                   11
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd837445877831-1">
                   <span class="crayon-sy">$</span>
                   <span class="crayon-e">http</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd837445877831-2">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">method</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'GET'</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd837445877831-3">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">url</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'/weather/'</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd837445877831-4">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'Authorization'</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'Basic '</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">sharedProperties</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">getEncodedAuth</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd837445877831-5">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">success</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">status</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">config</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd837445877831-6">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">temp</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">' F'</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd837445877831-7">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">myCity</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd837445877831-8">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">error</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">status</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">config</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd837445877831-9">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">window</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">alert</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Error'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd837445877831-10">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd837445877831-11">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>In this HTTP request, we specify the desired city in the url: <code>/weather/{{city}}</code> and add our Base64 encoded API key as the authorization header.</p> 
           <p>Now lets take a look at what happens on the server side, where this request gets processed:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd83a595038428" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
server.get('/weather/:city', stormpath.apiAuthenticationRequired, function(req, res) {
  function getWeather() {
    console.log('Getting weather for ' + req.params.city);
    var url = "'ttp://api.openweathermap.org/data/2.5/weather?q=' + req.params.city;
    var data = '';

    http.get(url, function(myRes) {
      myRes.on('data', function(chunk) {
        data += chunk;
      });

      myRes.on('end', function() {
        callback(data);
      });
    }).on('error', function() {
      console.log('Error getting data.');
    });
  }

  function callback(finalData) {
    var json = JSON.parse(finalData);

    // Convert to Farenheight:
    var farenheight = Math.round((((parseFloat(json.main.temp) - 273.15) * 1.8) + 32) * 10) / 10;
    res.status(200).json(farenheight);
  }

  if (req.headers.authorization.indexOf('Basic') !== 0) {
    return res.status(403).end();
  }

  getWeather();
});
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-11">
                   11
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-12">
                   12
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-13">
                   13
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-14">
                   14
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-15">
                   15
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-16">
                   16
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-17">
                   17
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-18">
                   18
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-19">
                   19
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-20">
                   20
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-21">
                   21
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-22">
                   22
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-23">
                   23
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-24">
                   24
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-25">
                   25
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-26">
                   26
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-27">
                   27
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-28">
                   28
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-29">
                   29
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-30">
                   30
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-31">
                   31
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-32">
                   32
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd83a595038428-33">
                   33
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83a595038428-34">
                   34
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-1">
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">get</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'/weather/:city'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">stormpath</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">apiAuthenticationRequired</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-2">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-e">getWeather</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-3">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">console</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">log</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Getting weather for '</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">params</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-4">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">url</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>"
                   <span class="crayon-s">'ttp://api.openweathermap.org/data/2.5/weather?q='</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">params</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-5">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">''</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-6">
                   &nbsp;
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-7">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">http</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">get</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">url</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">myRes</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-8">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">myRes</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">on</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'data'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">chunk</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-9">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">chunk</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-10">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-11">
                   &nbsp;
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-12">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">myRes</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">on</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'end'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-13">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-e">callback</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-14">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-15">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">on</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'error'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-16">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">console</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">log</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Error getting data.'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-17">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-18">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-19">
                   &nbsp;
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-20">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-e">callback</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">finalData</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-21">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">json</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">JSON</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">parse</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">finalData</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-22">
                   &nbsp;
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-23">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-c">// Convert to Farenheight:</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-24">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">farenheight</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">Math</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">round</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-e">parseFloat</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">json</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">main</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">temp</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">-</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">273.15</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">*</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">1.8</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">32</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">*</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">10</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">/</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">10</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-25">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">status</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-cn">200</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">json</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">farenheight</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-26">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-27">
                   &nbsp;
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-28">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-st">if</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">authorization</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">indexOf</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Basic'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">!==</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">0</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-29">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-st">return</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">status</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-cn">403</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-st">end</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-30">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-31">
                   &nbsp;
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-32">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-e">getWeather</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd83a595038428-33">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83a595038428-34">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>First, notice the <code>stormpath.apiAuthenticationRequired</code> call that precedes the callback function of our route. This function verifies that the authorization credentials sent over are legitimate. If they are not, the server will return a <code>401 Unauthorized</code> error. Assuming the credentials are correct, the server is then allowed to return the weather of the desired city.</p> 
           <p>Here is how the same request can be made with CURL:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd83d178525635" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$ curl --user '[API_KEY]:[API_SECRET]' http://localhost:8080/weather/London
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd83d178525635-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd83d178525635-2">
                   2
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd83d178525635-1">
                   <span class="crayon-sy">$</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">curl</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">--</span>
                   <span class="crayon-i">user</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'[API_KEY]:[API_SECRET]'</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">http</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-c">//localhost:8080/weather/London</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd83d178525635-2">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>If authentication is successful you will get back a floating point number representing the weather in London. If it is not, you will see: <code>{"error":"Invalid API credentials."}</code>.</p> 
           <h2 id="generating-an-oauth-token-with-scope">Generating an OAuth Token with Scope<a href="#generating-an-oauth-token-with-scope" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>Basic Authentication is acceptable for a few use cases, but we strongly recommend you use OAuth if security is important to your API. By using OAuth, making requests to protected endpoints does not expose the API Key Id and Secret. It also gives a developer the ability to only give access to certain scopes of the endpoint the user is trying to access. This is compared to authenticating with API keys, which gives access to the entire endpoint.</p> 
           <p><img src="https://stormpath.com/wp-content/uploads/2016/04/nodeapisample4.png" alt="Generate OAuth Token with Scope"></p> 
           <p>By checking the desired cities and clicking <code>Get Oauth</code>, the user gets a token which can now be used to target the REST endpoint. What exactly happened on the server side to generate this Oauth Token? Let’s look at the server setup code one more time:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd841209299699" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
server.use(stormpath.init(server, {
  application: {
    href: process.env['STORMPATH_APPLICATION_HREF']
  },
  web: {
    login: {
      nextUri: '/dashboard',
    },
    oauth2: {
      client_credentials: {
        accessToken: {
          ttl: 3600
        }
      }
    }
  }
}));
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-11">
                   11
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-12">
                   12
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-13">
                   13
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-14">
                   14
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-15">
                   15
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-16">
                   16
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd841209299699-17">
                   17
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd841209299699-18">
                   18
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-1">
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-st">use</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">stormpath</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">init</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-2">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">application</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-3">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">href</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">process</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">env</span>
                   <span class="crayon-sy">[</span>
                   <span class="crayon-s">'STORMPATH_APPLICATION_HREF'</span>
                   <span class="crayon-sy">]</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-4">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-5">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">web</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-6">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">login</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-7">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">nextUri</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'/dashboard'</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-8">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-9">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">oauth2</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-10">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">client_credentials</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-11">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">accessToken</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-12">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">ttl</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">3600</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-13">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-14">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-15">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-16">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd841209299699-17">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd841209299699-18">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>With this, a <code>POST</code> request sent to that URL will check for API Key credentials and return a Token that is valid for 1 hour (by default). This <code>POST</code> request also needs to have a form parameter “grant_type” with the value set as the requested scope. Here is the request in angular.js:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd843835702262" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
myData = $.param({grant_type: "client_credentials", scope: scopeData});
$http({
  method: 'POST',
  url: '/oauth/token',
  headers: { 'Authorization': 'Basic ' + sharedProperties.getEncodedAuth(), 'Content-Type': 'application/x-www-form-urlencoded' },
  data : myData
}).success(function(data, status, headers, config) {
  var oauthToken = data.access_token;
  $scope.oauthToken = oauthToken;
}).error(function(data, status, headers, config) {
  $window.alert('Error');
});
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd843835702262-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd843835702262-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd843835702262-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd843835702262-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd843835702262-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd843835702262-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd843835702262-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd843835702262-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd843835702262-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd843835702262-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd843835702262-11">
                   11
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd843835702262-12">
                   12
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd843835702262-13">
                   13
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd843835702262-1">
                   <span class="crayon-v">myData</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">param</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">{</span>
                   <span class="crayon-v">grant_type</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">"client_credentials"</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">scopeData</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd843835702262-2">
                   <span class="crayon-sy">$</span>
                   <span class="crayon-e">http</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd843835702262-3">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">method</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'POST'</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd843835702262-4">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">url</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'/oauth/token'</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd843835702262-5">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'Authorization'</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'Basic '</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">sharedProperties</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">getEncodedAuth</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'Content-Type'</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'application/x-www-form-urlencoded'</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd843835702262-6">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-i">myData</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd843835702262-7">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">success</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">status</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">config</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd843835702262-8">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">oauthToken</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">access_token</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd843835702262-9">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">oauthToken</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">oauthToken</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd843835702262-10">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">error</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">status</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">config</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd843835702262-11">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">window</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">alert</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Error'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd843835702262-12">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd843835702262-13">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <h2 id="making-a-rest-call-using-the-oauth-token">Making a REST Call Using the OAuth Token<a href="#making-a-rest-call-using-the-oauth-token" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>In order to hit the REST endpoint using Oauth, we must send our token to the <code>weather/{{city}}</code> endpoint using Bearer authentication:</p> 
           <p></p> 
           <div id="crayon-59cd498fbd846204558923" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
$http({
  method: 'GET',
  url: '/weather/' + $scope.city,
  headers: { 'Authorization': 'Bearer ' + sharedProperties.getOauthToken() }
}).success(function(data, status, headers, config) {
  $scope.temp = data + ' F';
  $scope.myCity = $scope.city;
}).error(function(data, status, headers, config) {
  $window.alert('Permission Denied!');
});
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd846204558923-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd846204558923-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd846204558923-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd846204558923-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd846204558923-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd846204558923-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd846204558923-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd846204558923-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd846204558923-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd846204558923-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd846204558923-11">
                   11
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd846204558923-1">
                   <span class="crayon-sy">$</span>
                   <span class="crayon-e">http</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd846204558923-2">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">method</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'GET'</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd846204558923-3">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">url</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'/weather/'</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">,</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd846204558923-4">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'Authorization'</span>
                   <span class="crayon-o">:</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'Bearer '</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">sharedProperties</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">getOauthToken</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd846204558923-5">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">success</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">status</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">config</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd846204558923-6">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">temp</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">' F'</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd846204558923-7">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">myCity</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">scope</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd846204558923-8">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">error</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">status</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">config</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd846204558923-9">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">$</span>
                   <span class="crayon-v">window</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">alert</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Permission Denied!'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd846204558923-10">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd846204558923-11">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>Now, on the server side we can add the logic for Bearer authentication, and parse our requested scopes.</p> 
           <p></p> 
           <div id="crayon-59cd498fbd849884200387" class="crayon-syntax crayon-theme-stormpath crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;"> 
            <div class="crayon-plain-wrap">
             <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
server.get('/weather/:city', stormpath.apiAuthenticationRequired, function(req, res) {
  if (req.headers.authorization.indexOf('Basic') === 0) {
    getWeather();
  } else if (req.headers.authorization.indexOf('Bearer') === 0) {
    var requestedCity = req.params.city.replace(/\s+/g, '');
    if (res.locals.permissions.indexOf(requestedCity) &gt;= 0) {
      getWeather();
    } else {
      res.status(403).end();
    }
  } else {
    res.status(403).end();
  }

  function getWeather() {
    console.log('Getting weather for ' + req.params.city);
    var url = 'http://api.openweathermap.org/data/2.5/weather?q=' + req.params.city;
    var data = '';

    http.get(url, function(myRes) {
      myRes.on('data', function(chunk) {
        data += chunk;
      });
      myRes.on('end', function() {
        callback(data);
      });
    }).on('error', function() {
      console.log('Error getting data.');
    });
  }

  function callback(finalData) {
    var json = JSON.parse(finalData);
    console.log(json.main.temp);

    // Convert to Farenheight:
    var farenheight = Math.round((((parseFloat(json.main.temp) - 273.15) * 1.8) + 32) * 10) / 10;
    res.status(200).json(farenheight);
  }
});
</textarea>
            </div> 
            <div class="crayon-main" style=""> 
             <table class="crayon-table"> 
              <tbody>
               <tr class="crayon-row"> 
                <td class="crayon-nums " data-settings="hide"> 
                 <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-1">
                   1
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-2">
                   2
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-3">
                   3
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-4">
                   4
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-5">
                   5
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-6">
                   6
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-7">
                   7
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-8">
                   8
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-9">
                   9
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-10">
                   10
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-11">
                   11
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-12">
                   12
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-13">
                   13
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-14">
                   14
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-15">
                   15
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-16">
                   16
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-17">
                   17
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-18">
                   18
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-19">
                   19
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-20">
                   20
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-21">
                   21
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-22">
                   22
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-23">
                   23
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-24">
                   24
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-25">
                   25
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-26">
                   26
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-27">
                   27
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-28">
                   28
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-29">
                   29
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-30">
                   30
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-31">
                   31
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-32">
                   32
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-33">
                   33
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-34">
                   34
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-35">
                   35
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-36">
                   36
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-37">
                   37
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-38">
                   38
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-39">
                   39
                  </div>
                  <div class="crayon-num crayon-striped-num" data-line="crayon-59cd498fbd849884200387-40">
                   40
                  </div>
                  <div class="crayon-num" data-line="crayon-59cd498fbd849884200387-41">
                   41
                  </div>
                 </div> </td> 
                <td class="crayon-code">
                 <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-1">
                   <span class="crayon-v">server</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">get</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'/weather/:city'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">stormpath</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">apiAuthenticationRequired</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-2">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-st">if</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">authorization</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">indexOf</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Basic'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">===</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">0</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-3">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-e">getWeather</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-4">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-st">else</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-st">if</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">headers</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">authorization</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">indexOf</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Bearer'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">===</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">0</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-5">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">requestedCity</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">params</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">replace</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-o">/</span>
                   <span class="crayon-sy">\</span>
                   <span class="crayon-v">s</span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-o">/</span>
                   <span class="crayon-v">g</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">''</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-6">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-st">if</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">locals</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">permissions</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">indexOf</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">requestedCity</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">&gt;=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">0</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-7">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-e">getWeather</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-8">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-st">else</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-9">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">status</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-cn">403</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-st">end</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-10">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-11">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-st">else</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-12">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">status</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-cn">403</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-st">end</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-13">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-14">
                   &nbsp;
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-15">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-e">getWeather</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-16">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">console</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">log</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Getting weather for '</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">params</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-17">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">url</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">'http://api.openweathermap.org/data/2.5/weather?q='</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">req</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">params</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">city</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-18">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-s">''</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-19">
                   &nbsp;
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-20">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">http</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">get</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">url</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">myRes</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-21">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">myRes</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">on</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'data'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">chunk</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-22">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">chunk</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-23">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-24">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">myRes</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">on</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'end'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-25">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-e">callback</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">data</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-26">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-27">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">on</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'error'</span>
                   <span class="crayon-sy">,</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-28">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">console</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">log</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-s">'Error getting data.'</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-29">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-30">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-31">
                   &nbsp;
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-32">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-t">function</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-e">callback</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">finalData</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-sy">{</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-33">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">json</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">JSON</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">parse</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">finalData</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-34">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">console</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">log</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">json</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">main</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">temp</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-35">
                   &nbsp;
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-36">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-c">// Convert to Farenheight:</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-37">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-t">var</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">farenheight</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">=</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-v">Math</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">round</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-e">parseFloat</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">json</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">main</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-v">temp</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">-</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">273.15</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">*</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">1.8</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">+</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">32</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">*</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">10</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-o">/</span>
                   <span class="crayon-h"> </span>
                   <span class="crayon-cn">10</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-38">
                   <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                   <span class="crayon-v">res</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">status</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-cn">200</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">.</span>
                   <span class="crayon-e">json</span>
                   <span class="crayon-sy">(</span>
                   <span class="crayon-v">farenheight</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-39">
                   <span class="crayon-h">&nbsp;&nbsp;</span>
                   <span class="crayon-sy">}</span>
                  </div>
                  <div class="crayon-line crayon-striped-line" id="crayon-59cd498fbd849884200387-40">
                   <span class="crayon-sy">}</span>
                   <span class="crayon-sy">)</span>
                   <span class="crayon-sy">;</span>
                  </div>
                  <div class="crayon-line" id="crayon-59cd498fbd849884200387-41">
                   &nbsp;
                  </div>
                 </div></td> 
               </tr> 
              </tbody>
             </table> 
            </div> 
           </div> 
           <p></p> 
           <p>The requested scopes live inside the <code>res.locals.permissions</code> object and we can search it to see if the city we want the weather for is permitted for us. If so, the server will proceed to return the weather; if not, a <code>403</code> is returned. Compared to a <code>401</code> error, which is stands for an unauthorized request, a <code>403</code> represents a forbidden request.</p> 
           <p>London was part of the scopes in the Oauth Token so getting its weather is no problem:</p> 
           <p><img src="https://stormpath.com/wp-content/uploads/2016/04/nodeapisample5.png" alt="Set Scope for OAuth Token Example"></p> 
           <p>Berlin on the other hand was not, so the weather is not given and an error is returned instead:</p> 
           <p><img src="https://stormpath.com/wp-content/uploads/2016/04/nodeapisample6.png" alt="API scope permission denied"></p> 
           <h2 id="conclusion">Conclusion<a href="#conclusion" class="heading-link"><i class="stp-icons stp-icon-link2"></i></a></h2> 
           <p>Node.js and the stormpath-express package make it easy to generate and manage API Key-based authentication in your webapp or API. If you’d like to see more code and even run this application yourself, check out the <a href="https://github.com/stormpath/stormpath-express-api-auth-sample">source code</a> and let us know what you think!</p> 
           <p>Also, read our blog post on <a href="https://stormpath.com/blog/tutorial-build-rest-api-mobile-apps-using-node-js">using Node.js for REST APIs in mobile apps for Android and iOS</a>.</p> 
           <div class="clearfix"></div> 
          </div> 
         </article> 
        </div> 
        <div class="blog_sidebar col-md-3 col-md-offset-1 nopadding" data-spy="affix" data-offset-top="230" data-offset-bottom="600"> 
         <div id="search-5" class="widget widget_search">
          <form role="search" method="get" class="search-form form" action="https://stormpath.com/"> 
           <label for="form-search-input" class="sr-only">Search for</label> 
           <div class="input-group"> 
            <input type="search" id="form-search-input" class="form-control" placeholder="Search …" value="" name="s" title="Search for:"> 
            <span class="input-group-btn"> <button type="submit" class="button button-green button-small search-button"><i class="stp-icons stp-icon-search"></i></button> </span> 
           </div> 
           <input type="hidden" name="post_type" value="post"> 
          </form> 
         </div>
         <div id="categories-5" class="widget widget_categories">
          <h3 class="widget-title">Explore the Topic</h3> 
          <ul> 
           <li class="cat-item cat-item-10"><a href="https://stormpath.com/blog/category/net">.NET</a> </li> 
           <li class="cat-item cat-item-13"><a href="https://stormpath.com/blog/category/general">General</a> </li> 
           <li class="cat-item cat-item-8"><a href="https://stormpath.com/blog/category/java">Java</a> </li> 
           <li class="cat-item cat-item-74"><a href="https://stormpath.com/blog/category/javascript">Javascript</a> </li> 
           <li class="cat-item cat-item-9"><a href="https://stormpath.com/blog/category/mobile">Mobile</a> </li> 
           <li class="cat-item cat-item-7"><a href="https://stormpath.com/blog/category/node">Node</a> </li> 
           <li class="cat-item cat-item-5"><a href="https://stormpath.com/blog/category/php">PHP</a> </li> 
           <li class="cat-item cat-item-11"><a href="https://stormpath.com/blog/category/python">Python</a> </li> 
           <li class="cat-item cat-item-12"><a href="https://stormpath.com/blog/category/rest-api">REST API</a> </li> 
          </ul> 
         </div> 
         <div class="social-bar widget stormpath-social-counter-widget" data-action="fetch_social_share_count" data-instance="2"> 
          <h3 class="widget-title">Share a Post</h3> 
          <a class="social-icon si-small si-borderless si-twitter share-button" target="_blank" href="https://twitter.com/share?text=Easy+API+Key+Management+for+Node+%26%238211%3B+A+Sample+App - &amp;url=https%3A%2F%2Fstormpath.com%2Fblog%2Fexpress-sample-api-key-management&amp;via=gostormpath"> <i class="stp-icons stp-icon-twitter">
            <div class="social-icon-counter">
             0
            </div></i> <i class="stp-icons stp-icon-twitter">
            <div class="social-icon-counter">
             0
            </div></i> </a> 
          <a class="social-icon si-small si-borderless si-facebook share-button" target="_blank" href="https://www.facebook.com/share.php?u=https%3A%2F%2Fstormpath.com%2Fblog%2Fexpress-sample-api-key-management&amp;title=Easy%20API%20Key%20Management%20for%20Node%20%26%238211%3B%20A%20Sample%20App"> <i class="stp-icons stp-icon-facebook">
            <div class="social-icon-counter">
             0
            </div></i> <i class="stp-icons stp-icon-facebook">
            <div class="social-icon-counter">
             0
            </div></i> </a> 
          <a class="social-icon si-small si-borderless si-gplus share-button" target="_blank" href="https://plus.google.com/share?url=https%3A%2F%2Fstormpath.com%2Fblog%2Fexpress-sample-api-key-management"> <i class="stp-icons stp-icon-gplus">
            <div class="social-icon-counter">
             0
            </div></i> <i class="stp-icons stp-icon-gplus">
            <div class="social-icon-counter">
             0
            </div></i> </a> 
          <a class="social-icon si-small si-borderless si-linkedin share-button" target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fstormpath.com%2Fblog%2Fexpress-sample-api-key-management&amp;title=Easy%20API%20Key%20Management%20for%20Node%20%26%238211%3B%20A%20Sample%20App&amp;source=https%3A%2F%2Fstormpath.com"> <i class="stp-icons stp-icon-linkedin">
            <div class="social-icon-counter">
             0
            </div></i> <i class="stp-icons stp-icon-linkedin">
            <div class="social-icon-counter">
             0
            </div></i> </a> 
         </div> 
        </div> 
       </main> 
      </div> 
     </div> 
    </section> 
    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script> 
   </div> 
   <footer id="footer" class="dark"> 
    <div class="container"> 
     <div class="footer-widgets-wrap nopadding topmargin-sm bottommargin-sm clearfix"> 
      <div class="col-md-4"> 
       <div id="text-4" class="widget widget_text"> 
        <div class="textwidget">
         <img src="https://stormpath.com/wp-content/uploads/2017/08/logos.png" class="footer-logo">
        </div> 
       </div> 
      </div> 
      <div class="col-md-2 col-md-offset-1 col-sm-4 col-xs-5"> 
       <div id="nav_menu-2" class="widget widget_links widget_nav_menu"></div> 
      </div> 
      <div class="col-md-2 col-sm-4 col-xs-6"> 
       <div id="nav_menu-3" class="widget widget_links widget_nav_menu"></div> 
      </div> 
      <div class="col-md-3 col-sm-4 col-xs-12" id="info-social"> 
       <div id="text-3" class="widget widget_text"> 
        <div class="textwidget">
         <div> 
          <strong>Support:</strong> 
          <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="57333221323b382732252417383c23367934383a">[email&nbsp;protected]</a> 
         </div> 
        </div> 
       </div> 
      </div> 
     </div> 
    </div> 
    <div id="copyrights"> 
     <div class="container clearfix"> 
      <div class="col-md-12">
        Copyright 2017 Stormpath 
      </div> 
     </div> 
    </div> 
   </footer> 
  </div> 
  <noscript>
   <iframe src="//www.googletagmanager.com/ns.html?id=GTM-NQZZFW" height="0" width="0" style="display:none;visibility:hidden"></iframe>
  </noscript> 
  <script>!function(e,t,r,n,c,a,l){function i(t,r){return r=e.createElement('div'),r.innerHTML='<a href="'+t.replace(/"/g,'&quot;')+'"></a>',r.childNodes[0].getAttribute('href')}function o(e,t,r,n){for(r='',n='0x'+e.substr(t,2)|0,t+=2;t<e.length;t+=2)r+=String.fromCharCode('0x'+e.substr(t,2)^n);return i(r)}try{for(c=e.getElementsByTagName('a'),l='/cdn-cgi/l/email-protection#',n=0;n<c.length;n++)try{(t=(a=c[n]).href.indexOf(l))>-1&&(a.href='mailto:'+o(a.href,t+l.length))}catch(e){}for(c=e.querySelectorAll('.__cf_email__'),n=0;n<c.length;n++)try{(a=c[n]).parentNode.replaceChild(e.createTextNode(o(a.getAttribute('data-cfemail'),0)),a)}catch(e){}}catch(e){}}(document);</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
                })(window,document,'script','dataLayer','GTM-NQZZFW');</script> 
  <link rel="stylesheet" id="crayon-css" href="https://stormpath.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" type="text/css" media="all"> 
  <script type="text/javascript" src="https://stormpath.com/wp-content/plugins/contact-form-7/includes/js/jquery.form.min.js?ver=3.51.0-2014.06.20"></script> 
  <script type="text/javascript">
/* <![CDATA[ */
var _wpcf7 = {"recaptcha":{"messages":{"empty":"Please verify that you are not a robot."}},"cached":"1"};
/* ]]> */
</script> 
  <script type="text/javascript" src="https://stormpath.com/wp-content/plugins/contact-form-7/includes/js/scripts.js?ver=4.7"></script> 
  <script type="text/javascript" src="https://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201739"></script> 
  <script type="text/javascript" src="https://stormpath.com/wp-content/themes/stormpath/vendor/js/script-global.min.js?ver=4.8.2"></script> 
  <script type="text/javascript" src="https://stormpath.com/wp-includes/js/wp-embed.min.js?ver=4.8.2"></script> 
  <script type="text/javascript">
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/stormpath.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script> 
  <script type="text/javascript" src="https://stormpath.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta"></script> 
  <script type="text/javascript">
/* <![CDATA[ */
var stormpath_social_object = {"ajaxurl":"https:\/\/stormpath.com\/wp-admin\/admin-ajax.php","post_id":"2513"};
/* ]]> */
</script> 
  <script type="text/javascript" src="https://stormpath.com/wp-content/plugins/stormpath-social-media-widgets/widgets/js/social-media-counter.js?ver=4.8.2"></script> 
  <script type="text/javascript">
/* <![CDATA[ */
var countVars = {"disqusShortname":"stormpath"};
/* ]]> */
</script> 
  <script type="text/javascript" src="https://stormpath.com/wp-content/plugins/disqus-comment-system/media/js/count.js?ver=4.8.2"></script>   
 </body>
</html>