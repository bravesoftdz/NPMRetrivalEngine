<!doctype html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0001, minimum-scale=1.0001, maximum-scale=1.0001, user-scalable=no">
  <link rel="profile" href="http://gmpg.org/xfn/11">
  <link rel="pingback" href="/developerblog/xmlrpc.php">
  <title>Bot to Human Handoff in Node.js - Developer Blog</title>
  <meta name="description" content="How we developed a bot to human handoff framework for the Microsoft Bot Framework Node.js SDK.">
  <link rel="canonical" href="https://www.microsoft.com/developerblog/2017/06/30/bot-to-human-handover-in-node-js/">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Bot to Human Handoff in Node.js - Developer Blog">
  <meta property="og:description" content="How we developed a bot to human handoff framework for the Microsoft Bot Framework Node.js SDK.">
  <meta property="og:url" content="https://www.microsoft.com/developerblog/2017/06/30/bot-to-human-handover-in-node-js/">
  <meta property="og:site_name" content="Developer Blog">
  <meta property="article:tag" content="Azure Application Insights">
  <meta property="article:tag" content="Bot Framework SDK">
  <meta property="article:tag" content="bots">
  <meta property="article:tag" content="Microsoft Bot Framework (MBF)">
  <meta property="article:tag" content="sentiment analysis">
  <meta property="article:section" content="Bots">
  <meta property="article:published_time" content="2017-06-30T19:34:12-07:00">
  <meta property="article:modified_time" content="2017-06-30T19:33:54-07:00">
  <meta property="og:updated_time" content="2017-06-30T19:33:54-07:00">
  <meta property="og:image" content="https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/pexels-photo-111184.jpg">
  <meta property="og:image:width" content="2500">
  <meta property="og:image:height" content="1667">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:description" content="How we developed a bot to human handoff framework for the Microsoft Bot Framework Node.js SDK.">
  <meta name="twitter:title" content="Bot to Human Handoff in Node.js - Developer Blog">
  <meta name="twitter:image" content="https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/pexels-photo-111184.jpg">
  <meta name="twitter:creator" content="@liliankasem">
  <link rel="dns-prefetch" href="//s.w.org">
  <link rel="alternate" type="application/rss+xml" title="Developer Blog » Feed" href="https://www.microsoft.com/developerblog/feed/">
  <link rel="alternate" type="application/rss+xml" title="Developer Blog » Comments Feed" href="https://www.microsoft.com/developerblog/comments/feed/">
  <link rel="alternate" type="application/rss+xml" title="Developer Blog » Bot to Human Handoff in Node.js Comments Feed" href="https://www.microsoft.com/developerblog/2017/06/30/bot-to-human-handover-in-node-js/feed/"> 
  <script type="text/javascript">window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.3\/svg\/","svgExt":".svg","source":{"concatemoji":"\/developerblog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.8.2"}};!function(a,b,c){function d(a){var b,c,d,e,f=String.fromCharCode;if(!k||!k.fillText)return!1;switch(k.clearRect(0,0,j.width,j.height),k.textBaseline="top",k.font="600 32px Arial",a){case"flag":return k.fillText(f(55356,56826,55356,56819),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,56826,8203,55356,56819),0,0),c=j.toDataURL(),b!==c&&(k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447),0,0),b=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447),0,0),c=j.toDataURL(),b!==c);case"emoji4":return k.fillText(f(55358,56794,8205,9794,65039),0,0),d=j.toDataURL(),k.clearRect(0,0,j.width,j.height),k.fillText(f(55358,56794,8203,9794,65039),0,0),e=j.toDataURL(),d!==e}return!1}function e(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i,j=b.createElement("canvas"),k=j.getContext&&j.getContext("2d");for(i=Array("flag","emoji4"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);</script> 
  <style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style>
  <link rel="stylesheet" id="crayon-css" href="https://codestoryedge.azureedge.net/developerblog/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta" type="text/css" media="all">
  <link rel="stylesheet" id="crayon-theme-github-css" href="https://www.microsoft.com/developerblog//wp-content/plugins/crayon-syntax-highlighter/themes/github/github.css?ver=_2.7.2_beta" type="text/css" media="all">
  <link rel="stylesheet" id="crayon-font-monaco-css" href="https://codestoryedge.azureedge.net/developerblog/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=_2.7.2_beta" type="text/css" media="all">
  <link rel="stylesheet" id="drawit-css-css" href="https://codestoryedge.azureedge.net/developerblog/wp-content/plugins/drawit/css/drawit.min.css?ver=1.1.3" type="text/css" media="all">
  <link rel="stylesheet" id="dpsp-frontend-style-css" href="https://codestoryedge.azureedge.net/developerblog/wp-content/plugins/social-pug/assets/css/style-frontend.css?ver=4.8.2" type="text/css" media="all">
  <link rel="stylesheet" id="gridbox-stylesheet-css" href="https://www.microsoft.com/developerblog//wp-content/themes/gridbox/style.css?ver=1.0.8" type="text/css" media="all">
  <style id="gridbox-stylesheet-inline-css" type="text/css">.site-description{position:absolute;clip:rect(1px, 1px, 1px, 1px)}</style>
  <link rel="stylesheet" id="genericons-css" href="https://www.microsoft.com/developerblog//wp-content/themes/gridbox/css/genericons/genericons.css?ver=3.4.1" type="text/css" media="all">
  <link rel="stylesheet" id="ms-default-font-css" href="https://codestoryedge.azureedge.net/developerblog/wp-content/themes/gridbox/ms/fonts/segoeui/segoeui.css" type="text/css" media="all">
  <link rel="stylesheet" id="themezee-related-posts-css" href="https://codestoryedge.azureedge.net/developerblog/wp-content/themes/gridbox/css/themezee-related-posts.css?ver=20160421" type="text/css" media="all"> 
  <script type="text/javascript" src="/developerblog/wp-includes/js/jquery/jquery.js?ver=1.12.4"></script> 
  <script type="text/javascript" src="/developerblog/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1"></script> 
  <script type="text/javascript">var CrayonSyntaxSettings={"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"\/developerblog\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};var CrayonSyntaxStrings={"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};</script> 
  <script type="text/javascript" src="https://www.microsoft.com/developerblog//wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta"></script> 
  <script type="text/javascript">var dpsp_ajax_url='/developerblog/wp-admin/admin-ajax.php';var dpsp_ajax_pull_post_share_counts_data={action:'dpsp_ajax_pull_post_share_counts',post_id:'4098'}</script> 
  <script type="text/javascript" src="https://www.microsoft.com/developerblog//wp-content/plugins/social-pug/assets/js/front-end.js?ver=4.8.2"></script> 
  <!--[if lt IE 9]> <script type='text/javascript' src='https://www.microsoft.com/developerblog//wp-content/themes/gridbox/js/html5shiv.min.js?ver=3.7.3'></script> <![endif]--> 
  <script type="text/javascript" src="https://www.microsoft.com/developerblog//wp-content/themes/gridbox/js/navigation.js?ver=20160719"></script> 
  <script type="text/javascript">var quicktagsL10n={"closeAllOpenTags":"Close all open tags","closeTags":"close tags","enterURL":"Enter the URL","enterImageURL":"Enter the URL of the image","enterImageDescription":"Enter a description of the image","textdirection":"text direction","toggleTextdirection":"Toggle Editor Text Direction","dfw":"Distraction-free writing mode","strong":"Bold","strongClose":"Close bold tag","em":"Italic","emClose":"Close italic tag","link":"Insert link","blockquote":"Blockquote","blockquoteClose":"Close blockquote tag","del":"Deleted text (strikethrough)","delClose":"Close deleted text tag","ins":"Inserted text","insClose":"Close inserted text tag","image":"Insert image","ul":"Bulleted list","ulClose":"Close bulleted list tag","ol":"Numbered list","olClose":"Close numbered list tag","li":"List item","liClose":"Close list item tag","code":"Code","codeClose":"Close code tag","more":"Insert Read More tag"};</script> 
  <script type="text/javascript" src="/developerblog/wp-includes/js/quicktags.min.js?ver=4.8.2"></script> 
  <script type="text/javascript">var drawitFE={"mediaupload":"\/developerblog\/wp-admin\/\/media-upload.php"};</script> 
  <script type="text/javascript" src="https://www.microsoft.com/developerblog//wp-content/plugins/drawit/js/qt-btn.js?ver=1.1.3"></script> 
  <link rel="https://api.w.org/" href="https://www.microsoft.com/developerblog/wp-json/">
  <link rel="EditURI" type="application/rsd+xml" title="RSD" href="/developerblog/xmlrpc.php?rsd">
  <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/developerblog/wp-includes/wlwmanifest.xml">
  <meta name="generator" content="WordPress 4.8.2">
  <link rel="shortlink" href="https://www.microsoft.com/developerblog/?p=4098">
  <link rel="alternate" type="application/json+oembed" href="https://www.microsoft.com/developerblog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.microsoft.com%2Fdeveloperblog%2F2017%2F06%2F30%2Fbot-to-human-handover-in-node-js%2F">
  <style type="text/css" data-source="Social Pug"></style>
  <meta name="twitter:card" content="summary">
  <meta property="og:url" content="https://www.microsoft.com/developerblog/2017/06/30/bot-to-human-handover-in-node-js/">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Bot to Human Handoff in Node.js">
  <meta property="og:description" content="When considering bots, its often important for organizations to have the ability to hand off a customer from a bot to a human agent seamlessly. We implemented an unopinionated e-2-e solution called Handoff for bot authors to implement a variety of scenarios, using the Microsoft Bot Framework Node.js SDK.">
  <meta property="og:image" content="https://www.microsoft.com/developerblog//wp-content/uploads/pexels-photo-111184-1024x683.jpg"> 
  <script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init','825717210926722');fbq('track','PageView');</script> 
  <noscript> &lt;img height="1" width="1" src="https://www.facebook.com/tr?id=825717210926722&amp;amp;ev=PageView &amp;amp;noscript=1"&gt; 
  </noscript>
  <link rel="stylesheet" href="/developerblog/wp-content/themes/gridbox/ms/fonts/segoeui/segoeui.css">
  <link rel="stylesheet" href="/developerblog/wp-content/themes/gridbox/ms/needsharebutton.min.css"> 
  <script>var trackOutboundLink=function(url){if(ga){ga('send','event','outbound','click',url,{'transport':'beacon','hitCallback':function(){document.location=url;}});}}</script> 
  <script src="/developerblog/wp-content/themes/gridbox/ms/needsharebutton.min.js"></script> 
  <script>function hasWKGoogleAnalyticsCookie(){return(new RegExp('wp_wk_ga_untrack_'+document.location.hostname)).test(document.cookie);}</script> 
  <script>if(!hasWKGoogleAnalyticsCookie()){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-84588747-3','auto');ga('send','pageview');}</script> 
  <style type="text/css" id="custom-background-css">body.custom-background{background-color:#f5f5f5}</style>
  <link rel="icon" href="https://www.microsoft.com/developerblog//wp-content/uploads/2017/01/Untitled-32x32.png" sizes="32x32">
  <link rel="icon" href="https://www.microsoft.com/developerblog//wp-content/uploads/2017/01/Untitled.png" sizes="192x192">
  <link rel="apple-touch-icon-precomposed" href="https://www.microsoft.com/developerblog//wp-content/uploads/2017/01/Untitled.png">
  <meta name="msapplication-TileImage" content="https://www.microsoft.com/developerblog//wp-content/uploads/2017/01/Untitled.png">
  <style type="text/css" id="wp-custom-css">input[type="checkbox"]{margin-right: .5em}.footer-wrap{background:#2f2f2f}.pagination
a{background:#2f2f2f}.more-link{background:#2f2f2f}body,button,input,select,textarea{font-family:'Segoe UI','Segoe UI Regular','Segoe WP','Lucida Grande','Arial',sans-serif}.archive-title,.page-title,.entry-title,.widget-title{font-family:'Segoe UI','Segoe UI Regular','Segoe WP','Lucida Grande','Arial',sans-serif;color:#505050}.entry-title a:link{font-family:'Segoe UI','Segoe UI Regular','Segoe WP','Lucida Grande','Arial',sans-serif;font-size:32px;font-weight:normal;line-height:41px;color:#505050}.comments-header .comments-title, .comments-header .comments-title, .comment-reply-title
span{font-family:'Segoe UI','Segoe UI Regular','Segoe WP','Lucida Grande','Arial',sans-serif}.entry-title a:link:hover{color:#777}.post-wrapper .type-post .entry-excerpt{font-size:14px;line-height:29px;color:#505050}div .entry-meta{margin:0.8em 0 0;color:#999;font-size:1rem}div .entry-meta a:link{color:#999}.entry-header,.entry-content{padding-left:1.5em;padding-right:1.5em;padding-bottom:1em}.more-link{display:none}#content{background-color:#f5f5f5}.type-post,.type-page,.type-attachment{background-color:white}.author-profile
.photo{margin-right:10px;border-radius:200px}.author-description{margin-bottom:10px}.author-spotlight div
h2{margin-top:1px;margin-bottom:1px}button,input[type="button"],input[type="reset"],input[type="submit"]{background-color:#1da5ed}.ms-entry-category{text-transform:uppercase;margin-top:2em;margin-bottom:2em;font-weight:500;font-size:0.8em}.ms-entry-category a:link, .ms-entry-category a:visited{color:#47a}.ms-entry-author{margin-left:0.5em;padding-top:0.5em;padding-bottom:0.5em}.ms-entry-author
a{margin:0.5em;display:block}.ms-entry-author
img{border-radius:24px;vertical-align:middle}.ms-entry-author-name{margin-left:0.5em}.header-main{padding:0;width:90%;max-width:1600px}#masthead{background-color:#1da5ed;font-size: .9em;height:38px}#main-navigation{margin:0;padding:0;height:38px;float:left}.main-navigation-menu
a{padding:0
1.5em 0 0;height:38px;line-height:38px}#menu-navsearch{background-color:#1da5ed;height:38px}.home .entry-title{float:left;clear:both}.home .entry-meta{float:left;clear:both}.ms-entry-share-container{float:right}.ms-entry-share{opacity: .7;transition: .5s ease;cursor:pointer}.ms-entry-share:hover{opacity:1}.need-share-button_dropdown-bottom-center{margin-top:0}.post-column{padding-bottom:2.5em}.post-column
.post{display:flex;flex-direction:column;height:100%}.post-column .entry-content{flex-grow:2;padding-bottom:0}.main-navigation-menu li.current-menu-item>a{text-decoration:none}.main-navigation-menu ul
a{padding:0
1em}.main-navigation-menu
ul{background-color:#1da5ed}#masthead .search-form{float:right;width:auto;min-width:300px;margin-top:5px;height:auto;margin-right:10px;border:1px
solid #fff}#masthead .search-field{border:0;display:inline-block;height:26px;background-color:#1da5ed;color:#fff;box-sizing:border-box;margin:0;width:300px;vertical-align:bottom}#masthead .search-field::-webkit-input-placeholder{color:#fff}#masthead .search-field:-ms-input-placeholder{color:#fff}#masthead .search-field::-ms-input-placeholder{color:#fff}#masthead .search-field::placeholder{color:#fff}#masthead .shell-icon-search{display:inline-block;width:1em;height:1em;vertical-align:middle;overflow:visible;position:relative;top:-2px}#masthead .search-submit{padding:0;width:26px;height:26px;display:inline-block;position:static;background-color:#1da5ed;vertical-align:baseline}#masthead .sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}.main-navigation-menu>.menu-item-has-children>a:after{line-height:1.7}.single-post div .entry-meta{float:left;clear:left;padding-bottom:1em}.single-post .entry-title{clear:both;float:left}.single-post .entry-content{clear:both}.ms-entry-meta-overlay{float:right;padding-top: .8em}.ms-entry-meta-share{opacity: .7;transition: .5s ease;cursor:pointer}.ms-entry-meta-share:hover{opacity:1}.ms-entry-meta-share-text{display:none;vertical-align:middle}.single-post .need-share-button
img{display:none}.single-post .need-share-button .need-share-button_dropdown{visibility:visible;-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);opacity:1}.single-post .need-share-button_dropdown-middle-left{top:200%}.single-post .entry-tags{margin-top:3em}.author .page-header{display:flex}.ms-author-profile-image{margin-right:10px;flex-basis:middle}span.ms-author-profile-image
img{border-radius:128px}@media only screen and (max-width: 30em){.ms-entry-meta-overlay{clear:left}.single-post .need-share-button_dropdown-middle-left{top:100%}}@media only screen and (max-width: 60em){#masthead{height:3.8em}.header-main{padding:0}#menu-navsearch{height:auto}#main-navigation{width:80%}#main-navigation-toggle{margin:0}.ms-entry-image{position:inherit}.ms-entry-image-overlay{position:relative;right:0;bottom:0;opacity:100;float:right;padding-right: .5em;text-align:right;transform:none;-ms-transform:none}#masthead .search-form{display:none}}</style>
  <!--[if lte IE 8]> <script src="https://assets.onestore.ms/cdnfiles/onestorerolling-1702-23000/shell/common/js/shell_ie8.js"></script> <![endif]--> 
  <script src="https://assets.onestore.ms/cdnfiles/onestorerolling-1702-23000/shell/generated/shellservice.v3.min.js"></script> 
  <script src="https://www.microsoft.com/uniblends/scripts/blender.js"></script> 
  <link href="https://assets.onestore.ms/cdnfiles/onestorerolling-1702-23000/shell/v3/scss/shell.min.css" rel="stylesheet" type="text/css">
  <!--[if lte IE 8]><link
href="https://assets.onestore.ms/cdnfiles/onestorerolling-1702-23000/shell/common/respond-proxy.html" id="respond-proxy" rel="respond-proxy"/>
<![endif]-->
 </head>
 <body class="post-template-default single single-post postid-4098 single-format-standard custom-background post-layout-three-columns post-layout-columns">
  <div class="ms-tophat" id="ms-tophat">
   <div id="shell-header" class="shell-header shell-responsive " ms.pgarea="header" role="banner" data-ckrate="0.005">
    <div class="shell-header-wrapper">
     <div class="shell-header-top" data-bi-area="HeaderL0" data-bi-view="L0V1">
      <div class="shell-header-brand" ms.cmpgrp="logo"> 
       <a id="srv_shellHeaderMicrosoftLogo" href="https://www.microsoft.com" ms.cmpnm="MicrosoftBrandLogo" ms.title="Microsoft" title="Microsoft" data-bi-name="BrandLogo" tabindex="10"> <img src="https://assets.onestore.ms/cdnfiles/external/uhf/long/9a49a7e9d8e881327e81b9eb43dabc01de70a9bb/images/microsoft-gray.png" alt="Microsoft"> </a>
      </div>
      <div class="shell-header-nav-wrapper" ms.cmpgrp="nav" role="navigation">
       <ul class="shell-header-nav" role="menubar" id="srv_shellHeaderNav" data-bi-area="L1" data-bi-view="Hovermenus">
        <li class="shell-header-user-mobile-container"></li>
        <li class="shell-header-dropdown  " data-navcontainer="shellmenu_35_NavContainer">
         <div id="shellmenu_35" class="shell-header-dropdown-label"> 
          <a id="Technologies-navigation" href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Technologies" data-bi-name="Technologies" data-bi-slot="1" tabindex="20"> Technologies </a>
         </div>
         <div class="shell-header-dropdown-content " aria-hidden="true" role="menu">
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Technologies; Windows">
           <dt id="shellmenu_36" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Windows" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Windows <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_37"> <a href="https://developer.microsoft.com/windows" class="shell-l3-list-item" ms.title="Apps" tabindex="20" data-bi-name="Windows_Apps"> Apps </a></li>
             <li id="shellmenu_38"> <a href="https://developer.microsoft.com/windows/iot" class="shell-l3-list-item" ms.title="Internet of Things" tabindex="20" data-bi-name="Windows_InternetofThings"> Internet of Things </a></li>
             <li id="shellmenu_39"> <a href="https://developer.microsoft.com/en-us/windows/mixed-reality" class="shell-l3-list-item" ms.title="Mixed Reality" tabindex="20" data-bi-name="Windows_Holographic"> Mixed Reality </a></li>
             <li id="shellmenu_40"> <a href="https://developer.microsoft.com/microsoft-edge" class="shell-l3-list-item" ms.title="Microsoft Edge" tabindex="20" data-bi-name="Windows_MicrosoftEdge"> Microsoft Edge </a></li>
             <li id="shellmenu_41"> <a href="https://developer.microsoft.com/windows/hardware" class="shell-l3-list-item" ms.title="Hardware " tabindex="20" data-bi-name="Windows_Hardware "> Hardware </a></li>
             <li id="shellmenu_42"> <a href="https://technet.microsoft.com/windows" class="shell-l3-list-item" ms.title="IT Center" tabindex="20" data-bi-name="Windows_WindowsTechCenter"> IT Center </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Technologies; Microsoft Azure ">
           <dt id="shellmenu_43" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Microsoft Azure " ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Microsoft Azure <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_44"> <a href="https://azure.microsoft.com/overview/what-is-azure/" class="shell-l3-list-item" ms.title="What is Azure " tabindex="20" data-bi-name="MicrosoftAzure_WhatisAzure"> What is Azure </a></li>
             <li id="shellmenu_45"> <a href="https://azure.microsoft.com/services/" class="shell-l3-list-item" ms.title="Products" tabindex="20" data-bi-name="MicrosoftAzure_Products"> Products </a></li>
             <li id="shellmenu_46"> <a href="https://azure.microsoft.com/solutions/?v=4" class="shell-l3-list-item" ms.title="Solutions" tabindex="20" data-bi-name="MicrosoftAzure_Solutions"> Solutions </a></li>
             <li id="shellmenu_47"> <a href="https://azure.microsoft.com/pricing/" class="shell-l3-list-item" ms.title="Pricing" tabindex="20" data-bi-name="MicrosoftAzure_Pricing"> Pricing </a></li>
             <li id="shellmenu_48"> <a href="https://azure.microsoft.com/free" class="shell-l3-list-item" ms.title="Create a free account" tabindex="20" data-bi-name="MicrosoftAzure_CreateaFreeAccount"> Create a free account </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Technologies; Visual Studio ">
           <dt id="shellmenu_49" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Visual Studio " ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Visual Studio <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_50"> <a href="https://www.visualstudio.com/ " class="shell-l3-list-item" ms.title="Visual Studio" tabindex="20" data-bi-name="MicrosoftVisualStudio_VisualStudio"> Visual Studio </a></li>
             <li id="shellmenu_51"> <a href="https://www.visualstudio.com/vs/ " class="shell-l3-list-item" ms.title="Visual Studio IDE" tabindex="20" data-bi-name="MicrosoftVisualStudio_VisualStudioIDE"> Visual Studio IDE </a></li>
             <li id="shellmenu_52"> <a href="https://www.visualstudio.com/team-services/ " class="shell-l3-list-item" ms.title="Visual Studio Team Services" tabindex="20" data-bi-name="MicrosoftVisualStudio_VisualStudioTeamServices"> Visual Studio Team Services </a></li>
             <li id="shellmenu_53"> <a href="https://code.visualstudio.com" class="shell-l3-list-item" ms.title="Visual Studio Code" tabindex="20" data-bi-name="MicrosoftVisualStudio_VisualStudioCode"> Visual Studio Code </a></li>
             <li id="shellmenu_54"> <a href="https://www.xamarin.com/" class="shell-l3-list-item" ms.title="Xamarin" tabindex="20" data-bi-name="MicrosoftVisualStudio_Xamarin"> Xamarin </a></li>
             <li id="shellmenu_55"> <a href="https://www.visualstudio.com/dev-essentials/ " class="shell-l3-list-item" ms.title="Visual Studio Dev Essentials" tabindex="20" data-bi-name="MicrosoftVisualStudio_VisualStudioDevEssentials"> Visual Studio Dev Essentials </a></li>
             <li id="shellmenu_56"> <a href="https://www.visualstudio.com/subscriptions/" class="shell-l3-list-item" ms.title="Subscriptions" tabindex="20" data-bi-name="MicrosoftVisualStudio_Subscriptions"> Subscriptions </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Technologies; Office">
           <dt id="shellmenu_57" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Office" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Office <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_58"> <a href="https://dev.office.com/" class="shell-l3-list-item" ms.title="Office Dev Center" tabindex="20" data-bi-name="Office_OfficeDevCenter"> Office Dev Center </a></li>
             <li id="shellmenu_59"> <a href="https://technet.microsoft.com/en-us/office/dn788774" class="shell-l3-list-item" ms.title="Office 365 for IT pros" tabindex="20" data-bi-name="Office_Office365forITpros"> Office 365 for IT pros </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Technologies; Microsoft Graph">
           <dt id="shellmenu_60" class="shell-header-dropdown-tab-label shell-header-L2menu-direct-link"> 
            <a href="https://Graph.microsoft.io/en-us/docs" ms.title="Microsoft Graph" tabindex="20" data-bi-name="Microsoft Graph">Microsoft Graph</a>
           </dt>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Technologies; Services ">
           <dt id="shellmenu_61" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Services " ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Services <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_62"> <a href="https://developer.microsoft.com/store" class="shell-l3-list-item" ms.title="Store" tabindex="20" data-bi-name="Services_OfficeDevCenter"> Store </a></li>
             <li id="shellmenu_63"> <a href="https://developer.microsoft.com/cortana" class="shell-l3-list-item" ms.title="Cortana" tabindex="20" data-bi-name="Services_Cortana"> Cortana </a></li>
             <li id="shellmenu_64"> <a href="https://bing.com/dev/dev-center" class="shell-l3-list-item" ms.title="Bing" tabindex="20" data-bi-name="Services_Bing"> Bing </a></li>
             <li id="shellmenu_65"> <a href="https://azure.microsoft.com/services/application-insights" class="shell-l3-list-item" ms.title="Application Insights" tabindex="20" data-bi-name="Services_ApplicationInsights"> Application Insights </a></li>
            </ul>
           </dd>
          </dl>
         </div></li>
        <li class="shell-header-dropdown  " data-navcontainer="shellmenu_66_NavContainer">
         <div id="shellmenu_66" class="shell-header-dropdown-label"> 
          <a id="Documentation-navigation" href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Documentation" data-bi-name="Documentation" data-bi-slot="2" tabindex="20"> Documentation </a>
         </div>
         <div class="shell-header-dropdown-content " aria-hidden="true" role="menu">
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Documentation; Microsoft Developer Network">
           <dt id="shellmenu_67" class="shell-header-dropdown-tab-label shell-header-L2menu-direct-link"> 
            <a href="https://msdn.microsoft.com" ms.title="Microsoft Developer Network" tabindex="20" data-bi-name="Learn_MicrosoftDeveloperNetwork">Microsoft Developer Network</a>
           </dt>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Documentation; TechNet">
           <dt id="shellmenu_68" class="shell-header-dropdown-tab-label shell-header-L2menu-direct-link"> 
            <a href="https://technet.microsoft.com" ms.title="TechNet" tabindex="20" data-bi-name="Learn_TechNet">TechNet</a>
           </dt>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Documentation; Platforms">
           <dt id="shellmenu_69" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Platforms" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Platforms <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_70"> <a href="https://azure.microsoft.com/en-us/documentation/" class="shell-l3-list-item" ms.title="Microsoft Azure" tabindex="20" data-bi-name="Build_DeveloperCenters_MicrosoftAzure"> Microsoft Azure </a></li>
             <li id="shellmenu_71"> <a href="https://Graph.microsoft.io/en-us/docs" class="shell-l3-list-item" ms.title="Microsoft Graph" tabindex="20" data-bi-name="Build_DeveloperCenters_MicrosoftGraph"> Microsoft Graph </a></li>
             <li id="shellmenu_72"> <a href="https://www.visualstudio.com/vs/getting-started/" class="shell-l3-list-item" ms.title="Visual Studio" tabindex="20" data-bi-name="Build_DeveloperCenters_VisualStudio"> Visual Studio </a></li>
             <li id="shellmenu_73"> <a href="https://www.visualstudio.com/docs/overview" class="shell-l3-list-item" ms.title="Visual Studio Team Services" tabindex="20" data-bi-name="Build_DeveloperCenters_VisualStudioTeamServices"> Visual Studio Team Services </a></li>
             <li id="shellmenu_74"> <a href="https://docs.microsoft.com/en-us/windows" class="shell-l3-list-item" ms.title="Windows" tabindex="20" data-bi-name="Build_DeveloperCenters_Windows"> Windows </a></li>
             <li id="shellmenu_75"> <a href="https://dev.office.com/docs" class="shell-l3-list-item" ms.title="Office" tabindex="20" data-bi-name="Build_DeveloperCenters_Office"> Office </a></li>
             <li id="shellmenu_76"> <a href="https://developer.microsoft.com/en-us/ " class="shell-l3-list-item" ms.title="All Developer Centers" tabindex="20" data-bi-name="Build_DeveloperCenters_AllDeveloperCenters"> All Developer Centers </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Documentation; IT TechCenters">
           <dt id="shellmenu_77" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="IT TechCenters" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> IT TechCenters <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_78"> <a href="https://technet.microsoft.com/windows" class="shell-l3-list-item" ms.title="Windows IT Center" tabindex="20" data-bi-name="TechCenter_WindowsTechCenter"> Windows IT Center </a></li>
             <li id="shellmenu_79"> <a href="https://technet.microsoft.com/en-us/office/dn788774" class="shell-l3-list-item" ms.title="Office 365 for IT Pros" tabindex="20" data-bi-name="TechCenter_Office365forITpros"> Office 365 for IT Pros </a></li>
             <li id="shellmenu_80"> <a href="https://technet.microsoft.com/en-us/bb421517.aspx?wt.svl=more_centers_link" class="shell-l3-list-item" ms.title="All IT TechCenters" tabindex="20" data-bi-name="TechCenter_AllTechcenters"> All IT TechCenters </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Documentation; Downloads">
           <dt id="shellmenu_81" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Downloads" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Downloads <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_82"> <a href="https://www.microsoft.com/en-us/download/developer-tools.aspx" class="shell-l3-list-item" ms.title="Microsoft Download Center" tabindex="20" data-bi-name="Build_Downloads_MicrosoftDownloadCenter"> Microsoft Download Center </a></li>
             <li id="shellmenu_83"> <a href="https://azure.microsoft.com/en-us/downloads/" class="shell-l3-list-item" ms.title="Microsoft Azure" tabindex="20" data-bi-name="Build_Downloads_Microsoft Azure"> Microsoft Azure </a></li>
             <li id="shellmenu_84"> <a href="https://www.visualstudio.com/downloads/" class="shell-l3-list-item" ms.title="Visual Studio" tabindex="20" data-bi-name="Build_Downloads_VisualStudio"> Visual Studio </a></li>
             <li id="shellmenu_85"> <a href="https://msdn.microsoft.com/en-us/microsoft-sdks-msdn" class="shell-l3-list-item" ms.title="SDKs" tabindex="20" data-bi-name="Build_Downloads_SDKS"> SDKs </a></li>
             <li id="shellmenu_86"> <a href="https://developer.microsoft.com/en-us/windows/downloads " class="shell-l3-list-item" ms.title="Windows" tabindex="20" data-bi-name="Build_Downloads_Windows"> Windows </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Documentation; Code samples">
           <dt id="shellmenu_87" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Code samples" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Code samples <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_88"> <a href="https://dev.office.com/code-samples" class="shell-l3-list-item" ms.title="Office" tabindex="20" data-bi-name="CodeSamples_Office"> Office </a></li>
             <li id="shellmenu_89"> <a href="https://graph.microsoft.io/en-us/code-samples-and-sdks" class="shell-l3-list-item" ms.title="Microsoft Graph" tabindex="20" data-bi-name="CodeSamples_MicrosoftGraph"> Microsoft Graph </a></li>
             <li id="shellmenu_90"> <a href="https://code.msdn.microsoft.com/" class="shell-l3-list-item" ms.title="MSDN" tabindex="20" data-bi-name="CodeSamples_MSDN"> MSDN </a></li>
             <li id="shellmenu_91"> <a href="https://azure.microsoft.com/en-us/resources/samples/" class="shell-l3-list-item" ms.title="Azure" tabindex="20" data-bi-name="CodeSamples_Azure"> Azure </a></li>
             <li id="shellmenu_92"> <a href="https://developer.microsoft.com/en-us/windows/samples" class="shell-l3-list-item" ms.title="Windows" tabindex="20" data-bi-name="CodeSamples_Windows"> Windows </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Documentation; PowerShell scripts">
           <dt id="shellmenu_93" class="shell-header-dropdown-tab-label shell-header-L2menu-direct-link"> 
            <a href="https://technet.microsoft.com/scriptcenter" ms.title="PowerShell scripts" tabindex="20" data-bi-name="documentation_powershell_scripts">PowerShell scripts</a>
           </dt>
          </dl>
         </div></li>
        <li class="shell-header-dropdown  " data-navcontainer="shellmenu_94_NavContainer">
         <div id="shellmenu_94" class="shell-header-dropdown-label"> 
          <a id="Resources-navigation" href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Resources" data-bi-name="Resources " data-bi-slot="3" tabindex="20"> Resources </a>
         </div>
         <div class="shell-header-dropdown-content " aria-hidden="true" role="menu">
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Resources; Blogs">
           <dt id="shellmenu_95" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Blogs" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Blogs <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_96"> <a href="https://azure.microsoft.com/en-us/blog/" class="shell-l3-list-item" ms.title="Microsoft Azure" tabindex="20" data-bi-name="Connect_Blogs_MicrosoftAzure"> Microsoft Azure </a></li>
             <li id="shellmenu_97"> <a href="https://blogs.msdn.microsoft.com/visualstudio/" class="shell-l3-list-item" ms.title="Visual Studio" tabindex="20" data-bi-name="Connect_Blogs_VisualStudio"> Visual Studio </a></li>
             <li id="shellmenu_98"> <a href="https://blogs.msdn.microsoft.com/visualstudioalm/" class="shell-l3-list-item" ms.title="Visual Studio Team Services " tabindex="20" data-bi-name="Connect_Blogs_VisualStudioTeamServices"> Visual Studio Team Services </a></li>
             <li id="shellmenu_99"> <a href="https://blogs.msdn.microsoft.com/developer-tools/" class="shell-l3-list-item" ms.title="Developer tools" tabindex="20" data-bi-name="Connect_Blogs_DevloperTools"> Developer tools </a></li>
             <li id="shellmenu_100"> <a href="https://dev.office.com/blogs" class="shell-l3-list-item" ms.title="Office Dev Blog" tabindex="20" data-bi-name="Connect_Blogs_OfficeDevBlog"> Office Dev Blog </a></li>
             <li id="shellmenu_101"> <a href="https://blogs.technet.microsoft.com/server-management/" class="shell-l3-list-item" ms.title="Server &amp; management" tabindex="20" data-bi-name="Connect_Blogs_ServerandManagement"> Server &amp; management </a></li>
             <li id="shellmenu_102"> <a href="https://blogs.windows.com/buildingapps/ " class="shell-l3-list-item" ms.title="Windows" tabindex="20" data-bi-name="Connect_Blogs_Windows"> Windows </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Resources; Community &amp; Forums">
           <dt id="shellmenu_103" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Community &amp; Forums" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Community &amp; Forums <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_104"> <a href="https://social.msdn.microsoft.com/Forums/en-US/home" class="shell-l3-list-item" ms.title="Developers" tabindex="20" data-bi-name="CommunityandForums_Developers"> Developers </a></li>
             <li id="shellmenu_105"> <a href="https://social.technet.microsoft.com/Forums/en-US/home" class="shell-l3-list-item" ms.title="TechNet" tabindex="20" data-bi-name="CommunityandForums_Technet"> TechNet </a></li>
             <li id="shellmenu_106"> <a href="https://techcommunity.microsoft.com/" class="shell-l3-list-item" ms.title="Microsoft Tech Community" tabindex="20" data-bi-name="CommunityandForums_MicrosoftTechCommunity"> Microsoft Tech Community </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Resources; Subscriptions">
           <dt id="shellmenu_107" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Subscriptions" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Subscriptions <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_108"> <a href="https://my.visualstudio.com/Benefits?wt.mc_id=o~msft~UHF&amp;campaign=o~msft~UHF" class="shell-l3-list-item" ms.title="Visual Studio (MSDN) subscriptions" tabindex="20" data-bi-name="Subscriptions_VisualStudioMSDNSubscriptions"> Visual Studio (MSDN) subscriptions </a></li>
             <li id="shellmenu_109"> <a href="https://www.itprocloudessentials.com/" class="shell-l3-list-item" ms.title="IT Pro Cloud Essentials" tabindex="20" data-bi-name="Subscriptions_ITProCloudEssentials"> IT Pro Cloud Essentials </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Resources; Training">
           <dt id="shellmenu_110" class="shell-header-dropdown-tab-label"> 
            <a href="javascript:void(0)" role="button" aria-haspopup="true" aria-expanded="false" ms.title="Training" ms.interactiontype="14" tabindex="20" data-bi-dnt=""> Training <i class="shell-icon-dropdown facing-right"></i> </a>
           </dt>
           <dd class="shell-header-dropdown-tab-content" data-col="0">
            <ul class="shell-header-dropdown-tab-list">
             <li id="shellmenu_111"> <a href="https://mva.microsoft.com/" class="shell-l3-list-item" ms.title="Microsoft Virtual Academy " tabindex="20" data-bi-name="Training_MicrosoftVirtualAcademy"> Microsoft Virtual Academy </a></li>
             <li id="shellmenu_112"> <a href="https://www.itprocareercenter.com/" class="shell-l3-list-item" ms.title="IT Pro Career Center" tabindex="20" data-bi-name="Training_ITProCareerCenter"> IT Pro Career Center </a></li>
            </ul>
           </dd>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Resources; TechNet Evaluation Center">
           <dt id="shellmenu_113" class="shell-header-dropdown-tab-label shell-header-L2menu-direct-link"> 
            <a href="https://www.microsoft.com/evalcenter/" ms.title="TechNet Evaluation Center" tabindex="20" data-bi-name="Resources_TechNetEvaluationCenter">TechNet Evaluation Center</a>
           </dt>
          </dl>
          <dl class="shell-header-dropdown-tab  " ms.cmpnm="Resources; Channel 9">
           <dt id="shellmenu_114" class="shell-header-dropdown-tab-label shell-header-L2menu-direct-link"> 
            <a href="https://channel9.msdn.com/" ms.title="Channel 9" tabindex="20" data-bi-name="Connect_Channel9">Channel 9</a>
           </dt>
          </dl>
         </div></li>
       </ul>
      </div>
      <div class="shell-header-nav-toggle " ms.cmpgrp="nav"> 
       <button class="shell-header-toggle-menu" ms.cmpnm="mobile global nav toggle button" ms.title="Toggle menu" title="Toggle Menu" type="button" data-bi-name="Toggle Menu" tabindex="55"> <i class="shell-icon-menu"></i> </button>
      </div>
      <ul class="shell-header-toggle" ms.cmpgrp="header actions">
       <li> <button class="shell-header-toggle-search" type="button" data-bi-name="Toggle Search Icon" ms.title="search toggle" title="Toggle Search" tabindex="45"> <i class="shell-icon-search"></i> </button></li>
      </ul>
      <div class="shell-header-actions" ms.cmpgrp="header actions">
       <form id="srv_shellHeaderSearchForm" class="shell-search" role="search" action="https://www.microsoft.com/en-us/search/result.aspx" method="GET" autocomplete="off" onsubmit=" return window.msCommonShell.onSearch(this) " ms.cmpnm="search">
        <div class="shell-search-wrapper"> 
         <label for="cli_shellHeaderSearchInput" class="sr-only">Search Microsoft</label> 
         <input id="cli_shellHeaderSearchInput" type="search" title="Search Microsoft.com" name="q" data-bi-dnt="" placeholder="Search Microsoft.com" maxlength="200" tabindex="30">
         <input type="hidden" name="form" data-bi-dnt="" value="MSHOME">
         <button type="submit" title="Search" data-bi-dnt="" tabindex="40"> <i class="shell-icon-search"></i> <span class="sr-only">Search</span> </button>
         <div id="cli_searchSuggestionsContainer" class="shell-search-dropdown-container">
          <div class="search-dropdown">
           <div class="dropdown-item">
            <ul id="cli_searchSuggestionsResults" data-bi-name="Search Suggestions" data-bi-source="UnifiedSearch" ms.cmpgrp="search suggestions"></ul>
           </div>
          </div>
         </div>
        </div>
       </form>
      </div>
     </div>
    </div>
   </div>
   <div class="fixed-global-nav-buffer"></div>
   <!--[if lt IE 9]><div
class="shell-category-header lt-ie9 cat-theme-gray" ms.pgarea="categoryheader">
<![endif]--> 
   <!--[if (gte IE 9)|!(IE)]><!-->
   <div class="shell-category-header cat-theme-gray" ms.pgarea="categoryheader"> 
    <!--<![endif]-->
    <div role="navigation" aria-label="Category level navigation" class="shell-category-nav" ms.cmpgrp="cat nav" data-bi-area="CategoryHeader-" data-bi-view="C0">
     <div class="c-nav-pagination c-nav-pagination-prev"> 
      <i class="shell-icon-dropdown facing-left"></i>
     </div>
     <ul class="shell-category-top-level shell-category-brand">
      <li class="c-logo-item"> <a id="shell-cat-header-logo" class="c-logo c-top-nav-link" href="https://www.microsoft.com/developerblog" title="" ms.title="" data-bi-name="Category logo" tabindex="70"> <span class="logo-text-label">Developer Blog</span> </a> <a id="shell-cat-header-logo-mobile" role="button" class="c-logo-mobile c-top-nav-link" href="https://www.microsoft.com/developerblog" ms.title="" ms.interactiontype="14" data-bi-name="Mobile category logo" tabindex="70"> <span class="logo-text-label">Developer Blog</span> </a></li>
     </ul>
     <div class="c-nav-pagination c-nav-pagination-next"> 
      <i class="shell-icon-dropdown facing-right"></i>
     </div>
    </div>
   </div>
   <div class="fixed-category-nav-buffer"></div> 
   <script type="text/javascript">var shellInitOptions={lcaDisclaimerEnabled:false,suggestedProductTitle:'Suggested products'};var meControlInitOptions={containerId:'meControl',enabled:false,headerHeight:48,custom:{chevHtml:'<i class="msame_chev_uhf shell-icon-dropdown"></i>'},mobileBreakpoints:{shortHeader:1084},rpData:{msaInfo:{signInUrl:'',signOutUrl:'',accountSettingsUrl:'https://account.microsoft.com/',switchUrl:'',meUrl:'https://login.live.com/me.srf?wa=wsignin1.0',isSupported:true},aadInfo:{},preferredIdp:'msa',},signInStr:'Sign in',signOutStr:'Sign out'};</script> 
  </div>
  <div id="page" class="hfeed site">
   <a class="skip-link screen-reader-text" href="#content">Skip to content</a>
   <div id="header-top" class="header-bar-wrap"></div>
   <header id="masthead" class="site-header clearfix" role="banner">
    <div class="header-main container clearfix">
     <nav id="main-navigation" class="primary-navigation navigation clearfix" role="navigation">
      <ul id="menu-navsearch" class="main-navigation-menu">
       <li id="menu-item-5143" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-5143"><a href="/developerblog/">Code Stories</a>
        <ul class="sub-menu">
         <li id="menu-item-5147" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5147"><a href="https://www.microsoft.com/developerblog/category/azure-app-services/">Azure App Services</a></li>
         <li id="menu-item-5146" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5146"><a href="https://www.microsoft.com/developerblog/category/big-data/">Big Data</a></li>
         <li id="menu-item-5151" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5151"><a href="https://www.microsoft.com/developerblog/category/blockchain/">Blockchain</a></li>
         <li id="menu-item-5148" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-5148"><a href="https://www.microsoft.com/developerblog/category/bots/">Bots</a></li>
         <li id="menu-item-5153" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5153"><a href="https://www.microsoft.com/developerblog/category/cognitive-services/">Cognitive Services</a></li>
         <li id="menu-item-5150" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5150"><a href="https://www.microsoft.com/developerblog/category/containers/">Containers</a></li>
         <li id="menu-item-5144" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5144"><a href="https://www.microsoft.com/developerblog/category/devops/">DevOps</a></li>
         <li id="menu-item-5149" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5149"><a href="https://www.microsoft.com/developerblog/category/frameworks/">Frameworks</a></li>
         <li id="menu-item-5152" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5152"><a href="https://www.microsoft.com/developerblog/category/iot/">Internet Of Things</a></li>
         <li id="menu-item-5145" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-5145"><a href="https://www.microsoft.com/developerblog/category/machine-learning/">Machine Learning</a></li>
        </ul></li>
       <li id="menu-item-5154" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5154"><a href="http://decodedshow.com">Decoded</a></li>
      </ul> 
     </nav>
     <form role="search" method="GET" class="search-form" action="https://www.microsoft.com/developerblog"> 
      <label> <span class="screen-reader-text">Search for:</span> <input type="search" class="search-field" placeholder="Search Code Stories" value="" name="s" title="Search for:"> </label> 
      <button type="submit" class="search-submit"> <i class="shell-icon-search"></i> <span class="screen-reader-text">Search</span> </button>
     </form>
    </div>
   </header>
   <div id="content" class="site-content container clearfix">
    <section id="primary" class="content-single content-area"> 
     <main id="main" class="site-main" role="main"> 
      <article id="post-4098" class="post-4098 post type-post status-publish format-standard has-post-thumbnail hentry category-bots tag-azure-application-insights tag-bot-framework-sdk tag-bots tag-microsoft-bot-framework-mbf tag-sentiment-analysis">
       <img width="780" height="520" src="https://www.microsoft.com/developerblog//wp-content/uploads/pexels-photo-111184-1024x683.jpg" class="attachment-large size-large wp-post-image" alt="" srcset="https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/pexels-photo-111184-1024x683.jpg 1024w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/pexels-photo-111184-450x300.jpg 450w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/pexels-photo-111184-300x200.jpg 300w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/pexels-photo-111184-768x512.jpg 768w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/pexels-photo-111184-480x320.jpg 480w" sizes="(max-width: 780px) 100vw, 780px"> 
       <header class="entry-header">
        <h1 class="entry-title">Bot to Human Handoff in Node.js</h1>
        <div class="entry-meta">
         <span class="meta-date"><a href="https://www.microsoft.com/developerblog/2017/06/30/bot-to-human-handover-in-node-js/" title="7:34 pm" rel="bookmark"><time class="entry-date published updated" datetime="2017-06-30T19:34:12+00:00">June 30, 2017</time></a></span>
        </div>
        <div class="ms-entry-meta-overlay" data-share-title="Bot to Human Handoff in Node.js " data-share-url="https://www.microsoft.com/developerblog/2017/06/30/bot-to-human-handover-in-node-js/" data-share-share-button-class="custom-button"> 
         <img alt="Share button" title="Share this article" class="custom-button ms-entry-meta-share" src="https://www.microsoft.com/developerblog//wp-content/themes/gridbox/images/share-32.png" width="32" height="32"> 
         <span class="ms-entry-meta-share-text">Share</span>
        </div> 
       </header>
       <div class="entry-content clearfix">
        <p>One common request from companies and organizations considering bots is the ability to hand off a customer from a bot to a human agent as seamlessly as possible. To solve this problem, we implemented an unopinionated e-2-e solution&nbsp;called <a href="https://github.com/palindromed/Bot-HandOff/tree/npm-handoff"><strong>Handoff</strong></a>, which enables bot authors to implement a wide variety of scenarios with minimal changes to the actual bot. We recently worked with a partner who wanted to use the <a href="https://github.com/CatalystCode/ibex-dashboard">Ibex dashboard</a> to display all the Handoff interactions.&nbsp;A scenario we see often is a is&nbsp;help&nbsp;desk application; although little changes are needed to implement Handoff in your bot, creating your own help centre application that works with Handoff would require a bit of work.</p>
        <p>This framework has been developed in TypeScript and Node.js, and a&nbsp;similar handoff scenario has also been developed in C# by Tomi Paananen. You can see his <a href="http://tomipaananen.azurewebsites.net/?p=1851">write-up of how the C# version works</a> and his <a href="https://github.com/tompaana/intermediator-bot-sample">Intermediator-Bot sample on GitHub</a>.</p>
        <p>This project, <a href="https://github.com/palindromed/Bot-HandOff/tree/npm-handoff">Bot-Handoff</a>, is open-sourced and available on GitHub. Contributions are always welcome!<span id="more-4098"></span></p>
        <h2><a name="how-it-works"></a>How It Works</h2>
        <p>This framework connects <strong>Customers</strong> and <strong>Agents</strong> through the <a href="https://dev.botframework.com">Microsoft Bot Framework</a>.</p>
        <p>The Handoff depends on a database of conversations, including a transcription of every message sent between the Customer and the bot, or between the Customer and the Agent.</p>
        <p>A Handoff conversation consists of:</p>
        <ul>
         <li>address information for this conversation with the Customer</li>
         <li>the current state of this conversation (Bot, Waiting, or Agent)</li>
         <li>the conversational transcript</li>
         <li>address information for the Agent, if the Agent is currently connected to this Customer&nbsp;(Handoff does not record conversational metadata for the Agent, except when they are connected to a Customer)</li>
        </ul>
        <p>Essentially, we have some middleware intercepting every message sent to and from the bot. If the message is from the bot, Customer, or an Agent who is speaking to a Customer, it transcribes the message before sending the message through.</p>
        <p>If the message is from the Customer and contains the text&nbsp;help me (a command that can be configured by the author of the bot) we update the state of the Customer from Bot to Waiting&nbsp;meaning the user now waits for an Agent.</p>
        <p>Once an Agent picks up the conversation, the state is changed from Waiting to Agent. In this state, any message sent from the Customer is intercepted by the middleware and routed to the Agent using the stored address information for the Agent that picked up the conversation, and vice versa.</p>
        <p>This code story will go into further detail about key aspects of this framework, including:</p>
        <ul>
         <li><a href="#middleware">Middleware Routing</a></li>
         <li><a href="#transcript">Transcripts and Logging</a></li>
         <li><a href="#commands">Commands</a></li>
         <li><a href="#mongodb">Storing State on MongoDB</a></li>
         <li><a href="#app-insights">Application Insights</a></li>
         <li><a href="#sentiment">Sentiment Analysis</a></li>
         <li><a href="#force-handoff">Force Handoff API</a></li>
         <li><a href="#npm">Using the npm package in your&nbsp;bot</a></li>
         <li><a href="#conclusion">Conclusion and resources</a></li>
        </ul>
        <p></p>
        <h2><a name="middleware"></a>Middleware Routing</h2>
        <p>The heart of Handoff is the message router. Using the conversational metadata above, each message from a Customer, Bot, or Agent is routed appropriately. It is implemented as Bot middleware, and can be combined with any other middleware your bot is already using.</p>
        <p><img class="aligncenter wp-image-4385 size-full" src="/developerblog/wp-content/uploads/drawit-diagram-5-1.png" alt="middleware process to transcribe message and connect Customer to Agent" width="587" height="826" srcset="https://www.microsoft.com/developerblog//wp-content/uploads/drawit-diagram-5-1.png 587w, https://www.microsoft.com/developerblog//wp-content/uploads/drawit-diagram-5-1-213x300.png 213w" sizes="(max-width: 587px) 100vw, 587px"></p>
        <p>The code snippet below shows the implementation of&nbsp; <span id="crayon-59d2f1f294630759023600" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">bot</span><span class="crayon-sy">.</span><span class="crayon-st">use</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span>&nbsp; which is how middleware is implemented in the Node.js Microsoft Bot Framework SDK. The middleware performs two key actions: first, it checks to see if what the user enters matches any of our commands. For example, if the user is an Agent and types <em>list,</em> it will list all of the current conversations with the bot. Next, the middleware routes the message:</p>
        <div id="crayon-59d2f1f294637068207056" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
bot.use(
    commandsMiddleware(handoff),
    handoff.routingMiddleware(),
)</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294637068207056-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294637068207056-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294637068207056-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294637068207056-4">
                4
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294637068207056-1">
                <span class="crayon-v">bot</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-st">use</span>
                <span class="crayon-sy">(</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294637068207056-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">commandsMiddleware</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">handoff</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294637068207056-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">handoff</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">routingMiddleware</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294637068207056-4">
                <span class="crayon-sy">)</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>If the activity&nbsp;is from the Customer or Agent, it will go through the <span id="crayon-59d2f1f294639596564139" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">botbuilder</span></span></span>&nbsp; method. We only want to transcribe activities of type <em>message</em> so only in that scenario do we call <span id="crayon-59d2f1f29463b144616282" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">routeMessage</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span>&nbsp;; otherwise, we just pass the activity&nbsp;through as usual.&nbsp;Activities from the bot go through the send method where we do something similar.</p>
        <p>Here we also check to make sure there are no entities in the message activity. If there is an entity, &nbsp;it means that the message is from the Agent acting as the bot. We dont want the message to send twice as it will already be routed through the <span id="crayon-59d2f1f29463c671115577" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">botbuilder</span></span></span>&nbsp; method. (When the Handoff is active, the Agent is speaking to the bot to speak to the Customer, and that same message is then routed as the bot.)</p>
        <div id="crayon-59d2f1f29463e500465780" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
public routingMiddleware() {
    return {
        botbuilder: (session: builder.Session, next: Function) =&gt; {
            // Pass incoming messages to routing method
            if (session.message.type === 'message') {
                this.routeMessage(session, next);
            } else {
                // allow messages of non 'message' type through 
                next();
            }
        },
        send: async (event: builder.IMessage, next: Function) =&gt; {
            // Messages sent from the bot do not need to be routed
            // Not all messages from the bot are type message, we only want to record the actual messages  
            if (event.type === 'message' &amp;&amp; !event.entities) {
                this.transcribeMessageFromBot(event as builder.IMessage, next);
            } else {
                //If not a message (text), just send to user without transcribing
                next();
            }
        }
    }
}</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-12">
                12
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-13">
                13
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-14">
                14
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-15">
                15
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-16">
                16
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-17">
                17
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-18">
                18
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-19">
                19
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-20">
                20
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-21">
                21
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29463e500465780-22">
                22
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29463e500465780-23">
                23
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-1">
                <span class="crayon-m">public</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">routingMiddleware</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">return</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">botbuilder</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">builder</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Session</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">next</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">Function</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-4">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-c">// Pass incoming messages to routing method</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-5">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">message</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">type</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">===</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'message'</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">routeMessage</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">next</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-7">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">else</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-8">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-c">// allow messages of non 'message' type through </span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-9">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">next</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-10">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-11">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-12">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">send</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">async</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">event</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">builder</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">IMessage</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">next</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">Function</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-13">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-c">// Messages sent from the bot do not need to be routed</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-14">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-c">// Not all messages from the bot are type message, we only want to record the actual messages&nbsp;&nbsp;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-15">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">event</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">type</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">===</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'message'</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">&amp;&amp;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">!</span>
                <span class="crayon-v">event</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">entities</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-16">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">transcribeMessageFromBot</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-e">event </span>
                <span class="crayon-st">as</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">builder</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">IMessage</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">next</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-17">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">else</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-18">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-c">//If not a message (text), just send to user without transcribing</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-19">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">next</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-20">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-21">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29463e500465780-22">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29463e500465780-23">
                <span class="crayon-sy">}</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>After getting a message activity from a Customer or Agent, we use <span id="crayon-59d2f1f29464a715835490" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">routeMessage</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span>&nbsp; to check who the user is.</p>
        <div id="crayon-59d2f1f29464b315614060" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
private routeMessage(session: builder.Session, next: Function) {
    if (this.isAgent(session)) {
        this.routeAgentMessage(session)
    } else {
        this.routeCustomerMessage(session, next);
    }
}</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f29464b315614060-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29464b315614060-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29464b315614060-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29464b315614060-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29464b315614060-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29464b315614060-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29464b315614060-7">
                7
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f29464b315614060-1">
                <span class="crayon-m">private</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">routeMessage</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">builder</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Session</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">next</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">Function</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29464b315614060-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">isAgent</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29464b315614060-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">routeAgentMessage</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-sy">)</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29464b315614060-4">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">else</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29464b315614060-5">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">routeCustomerMessage</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">next</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29464b315614060-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29464b315614060-7">
                <span class="crayon-sy">}</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p></p>
        <h4>Agent Recognition</h4>
        <p>Customers and Agents are both just users connected to bots, so Handoff needs a way to identify an Agent.&nbsp;We use a function of the form&nbsp; <span id="crayon-59d2f1f29464d699725447" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">isAgent</span><span class="crayon-sy">(</span><span class="crayon-v">session</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">Session</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-t">boolean</span></span></span>&nbsp; to determine if the user is an Agent, which can be customized by the author of the bot&nbsp;in the initial setup of the Handoff module. For example, in the snippet below, we determine that a user is an Agent if their username starts with <em>Agent.</em></p>
        <p> <span id="crayon-59d2f1f29464e400857780" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-m">const</span><span class="crayon-h"> </span><span class="crayon-v">isAgent</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">session</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-v">message</span><span class="crayon-sy">.</span><span class="crayon-v">user</span><span class="crayon-sy">.</span><span class="crayon-v">name</span><span class="crayon-sy">.</span><span class="crayon-e">startsWith</span><span class="crayon-sy">(</span><span class="crayon-s">"Agent"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></span></span></p>
        <p>This information is passed by the bot author&nbsp;in the initial setup&nbsp; <span id="crayon-59d2f1f294650255237937" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">handoff</span><span class="crayon-sy">.</span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-v">bot</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">app</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">isAgent</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-sy">{</span><span class="crayon-h"> </span><span class="crayon-sy">}</span><span class="crayon-sy">)</span></span></span>&nbsp;.</p>
        <p>There are multiple ways this could be set up:</p>
        <ul>
         <li>Create a hardcoded directory of channel-specific user IDs for Agents (e.g., Fred Doe on Facebook Messenger is one of our Agents)</li>
         <li>Create a WebChat-based call center app that specially encodes Agent user IDs (e.g., Agent001, Agent002), which is easy with WebChat</li>
         <li>Create a WebChat-based call center app that authenticates users and then passes auth tokens to the bot via the WebChat backchannel</li>
         <li>Use authbot to identify the user as an Agent via OAuth2 (e.g., This authenticated user is marked as an Agent in our employee database)</li>
        </ul>
        <h2><a name="transcript"></a>Transcripts and Logging</h2>
        <p>Once we know who the user is, several checks are made before sending the message through the bot. In the Agent routing method, we check to see if the Agent is in a conversation; this means checking if they are currently talking to a Customer. If not, we dont need further routing and we just pass the message through. Otherwise, if they are talking to a Customer, we route the message through the bot to the Customer they are in the conversation with.</p>
        <p><img class="aligncenter wp-image-4383" title="drawit diagram" src="/developerblog/wp-content/uploads/drawit-diagram-6.png" alt="" width="271" height="336" srcset="https://www.microsoft.com/developerblog//wp-content/uploads/drawit-diagram-6.png 271w, https://www.microsoft.com/developerblog//wp-content/uploads/drawit-diagram-6-242x300.png 242w" sizes="(max-width: 271px) 100vw, 271px"></p>
        <div id="crayon-59d2f1f294652438337554" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
const conversation = await this.getConversation({ AgentConversationId }, message.address);

// send text that Agent typed to the Customer they are in conversation with
this.bot.send(new builder.Message().address(conversation.Customer).text(message.text).addEntity({ "Agent": true }));</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294652438337554-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294652438337554-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294652438337554-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294652438337554-4">
                4
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294652438337554-1">
                <span class="crayon-m">const</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">await </span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">getConversation</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-i">AgentConversationId</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">message</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">address</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294652438337554-2">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294652438337554-3">
                <span class="crayon-c">// send text that Agent typed to the Customer they are in conversation with</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294652438337554-4">
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">bot</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">send</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-r">new</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">builder</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">Message</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">address</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Customer</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">text</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">message</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">text</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">addEntity</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"Agent"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">true</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>On the Customer side, we check their state. If they are taking to the bot, we just pass the message through. If they are waiting, we inform them they are being connected to an Agent. And finally, if they are in conversation with an Agent (and the Agent is in the conversation) we route the message through the bot to the Agent.</p>
        <p><img class="aligncenter wp-image-4384" title="drawit diagram" src="/developerblog/wp-content/uploads/drawit-diagram-7.png" alt="" width="350" height="540" srcset="https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/drawit-diagram-7.png 350w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/drawit-diagram-7-194x300.png 194w" sizes="(max-width: 350px) 100vw, 350px"></p>
        <div id="crayon-59d2f1f294654672251682" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
// this method will either return existing conversation or a newly created conversation if this is first time we've heard from Customer
const conversation = await this.getConversation({ CustomerConversationId: message.address.conversation.id }, message.address);

this.bot.send(new builder.Message().address(conversation.Agent).text(message.text));</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294654672251682-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294654672251682-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294654672251682-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294654672251682-4">
                4
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294654672251682-1">
                <span class="crayon-c">// this method will either return existing conversation or a newly created conversation if this is first time we've heard from Customer</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294654672251682-2">
                <span class="crayon-m">const</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">await </span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">getConversation</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">CustomerConversationId</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">message</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">address</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-i">id</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">message</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">address</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294654672251682-3">
                &nbsp;
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294654672251682-4">
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">bot</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">send</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-r">new</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">builder</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">Message</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">address</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Agent</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">text</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">message</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">text</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>For both scenarios, we update the conversations transcript array, using the conversation ID, so we have all the messages that have gone between the Customer and the bot, and the Customer and the Agent.</p>
        <div id="crayon-59d2f1f29466c451179744" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
conversation.transcript.push({
    timestamp: datetime,
    from: from,
    sentimentScore: sentimentScore,
    state: conversation.state,
    text
});</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f29466c451179744-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29466c451179744-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29466c451179744-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29466c451179744-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29466c451179744-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29466c451179744-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29466c451179744-7">
                7
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f29466c451179744-1">
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">transcript</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">push</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29466c451179744-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">timestamp</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">datetime</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29466c451179744-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">from</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">from</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29466c451179744-4">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">sentimentScore</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">sentimentScore</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29466c451179744-5">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">state</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">state</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29466c451179744-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-i">text</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29466c451179744-7">
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>The datetime variable used is of type&nbsp; <span id="crayon-59d2f1f294670661051357" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-r">new</span><span class="crayon-h"> </span><span class="crayon-e">Date</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">toISOString</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span>&nbsp;so that it matches the format returned from <a href="https://docs.botframework.com/en-us/node/builder/chat-reference/classes/_botbuilder_d_.message.html#localtimestamp"> <span id="crayon-59d2f1f294671434556692" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">localTimestamp</span></span></span></a>&nbsp;.&nbsp;Something worth noting is that <span id="crayon-59d2f1f294673952907508" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">localTimestamp</span></span></span>&nbsp;&nbsp;(a&nbsp;method&nbsp;returned with a message activity) is not provided when the message is coming from WebChat. The SDK recommends not using the <a href="https://docs.botframework.com/en-us/node/builder/chat-reference/classes/_botbuilder_d_.message.html#timestamp"> <span id="crayon-59d2f1f294674615329912" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">timestamp</span></span></span></a>&nbsp;&nbsp;value, &nbsp;so we put a check in place to use <span id="crayon-59d2f1f294675713572755" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">localTimestamp</span></span></span>&nbsp; where possible.</p>
        <div>
         <div id="crayon-59d2f1f294677539246010" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
          <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <span class="crayon-title"></span>
           <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
            <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
             <div class="crayon-button-icon"></div>
            </div>
            <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
             <div class="crayon-button-icon"></div>
            </div>
            <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
             <div class="crayon-button-icon"></div>
            </div>
            <div class="crayon-button crayon-expand-button" title="Expand Code">
             <div class="crayon-button-icon"></div>
            </div>
            <div class="crayon-button crayon-copy-button" title="Copy">
             <div class="crayon-button-icon"></div>
            </div>
            <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
             <div class="crayon-button-icon"></div>
            </div>
           </div>
          </div>
          <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
          <div class="crayon-plain-wrap">
           <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
datetime = message.localTimestamp ? message.localTimestamp : message.timestamp</textarea>
          </div>
          <div class="crayon-main" style="">
           <table class="crayon-table">
            <tbody>
             <tr class="crayon-row">
              <td class="crayon-nums " data-settings="show">
               <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
                <div class="crayon-num" data-line="crayon-59d2f1f294677539246010-1">
                 1
                </div>
               </div></td>
              <td class="crayon-code">
               <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
                <div class="crayon-line" id="crayon-59d2f1f294677539246010-1">
                 <span class="crayon-v">datetime</span>
                 <span class="crayon-h"> </span>
                 <span class="crayon-o">=</span>
                 <span class="crayon-h"> </span>
                 <span class="crayon-v">message</span>
                 <span class="crayon-sy">.</span>
                 <span class="crayon-i">localTimestamp</span>
                 <span class="crayon-h"> </span>
                 <span class="crayon-sy">?</span>
                 <span class="crayon-h"> </span>
                 <span class="crayon-v">message</span>
                 <span class="crayon-sy">.</span>
                 <span class="crayon-v">localTimestamp</span>
                 <span class="crayon-h"> </span>
                 <span class="crayon-o">:</span>
                 <span class="crayon-h"> </span>
                 <span class="crayon-v">message</span>
                 <span class="crayon-sy">.</span>
                 <span class="crayon-v">timestamp</span>
                </div>
               </div></td>
             </tr>
            </tbody>
           </table>
          </div>
         </div>
        </div>
        <h2><a name="commands"></a>Commands</h2>
        <p>As mentioned earlier, the middleware of the bot looks for commands in all the messages sent to the bot. There are several commands made available through the <a href="https://github.com/palindromed/Bot-HandOff/blob/npm-handoff/src/commands.ts"> <span id="crayon-59d2f1f294678063256897" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">commands</span><span class="crayon-sy">.</span><span class="crayon-v">ts</span></span></span></a>&nbsp; middleware feature.&nbsp;After checking to make sure the activity is of the message type, we check if this command is coming from&nbsp;the Agent or from the Customer in a similar fashion as <span id="crayon-59d2f1f29467a108519591" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">routeMessage</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span>&nbsp;using <span id="crayon-59d2f1f29467b704840528" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">isAgent</span></span></span>&nbsp;.</p>
        <p>On the <strong>Agent</strong> side, there are four&nbsp;commands available:</p>
        <table>
         <tbody>
          <tr>
           <th>Command</th>
           <th>Description</th>
          </tr>
          <tr>
           <td>options</td>
           <td>Displays all of the commands available to the Agent.</td>
          </tr>
          <tr>
           <td>list</td>
           <td>Lists all of the conversations with the bot, using the conversation data in MongoDB</td>
          </tr>
          <tr>
           <td>connect</td>
           <td>This is the main command that activates the Handoff, taking the Customer from Waiting (1) state to Agent (2) state. After this state change, all messages the Customer sends to the bot, and all messages the Agent sends to the bot, are routed using the address information sorted for that conversation.</td>
          </tr>
          <tr>
           <td>disconnect</td>
           <td>This command disconnects&nbsp;the Agent from the Customer, resetting the Customers state to Bot (0). If the bot author chooses, they can keep all of the conversation data by providing a <span id="crayon-59d2f1f29467d357752496" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">retainData</span></span></span>&nbsp; option/environment variable. Otherwise, if the user has spoken to an Agent and the Agent has disconnected, the conversation is deleted from the database.</td>
          </tr>
         </tbody>
        </table>
        <p>On the <strong>Customer</strong> side, there is only one command. The bot author can provide a custom keyword or phrase that a Customer can use to trigger the Handoff (the default is set to <em>help</em>) through an environment variable or the Handoff module initial setup options.</p>
        <p>Regex is used to make sure the text is an exact match:</p>
        <div id="crayon-59d2f1f29467f251863108" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
const customerStartHandoffCommandRegex = new RegExp("^" + indexExports._customerStartHandoffCommand + "$", "gi");</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f29467f251863108-1">
                1
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f29467f251863108-1">
                <span class="crayon-m">const</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">customerStartHandoffCommandRegex</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-r">new</span>
                <span class="crayon-h"> </span>
                <span class="crayon-r">RegExp</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">"^"</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">+</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">indexExports</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">_customerStartHandoffCommand</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">+</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"$"</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"gi"</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>If the text matches exactly, the users message is transcribed, and they are queued to speak to an agent, changing their state from 0 (Bot) to 1 (Waiting).</p>
        <h2><a name="mongodb"></a>Storing State on MongoDB</h2>
        <p>The&nbsp;conversation data, which consists of the items listed below, are all stored in a Mongo database:</p>
        <ul>
         <li>address information for this conversation with the Customer</li>
         <li>the current state of this conversation (Bot, Waiting, or Agent)</li>
         <li>the conversational transcript</li>
         <li>address information for the Agent, if the Agent is currently connected to this Customer&nbsp;(Handoff does not record conversational metadata for the Agent, except when they are connected to a Customer)</li>
        </ul>
        <p>The <a href="https://www.npmjs.com/package/mongoose">Mongoose npm module</a> was used to enable this feature; the bot author simply has to provide the&nbsp;MongoDB connection string as an option or environment variable. Another option is to use <a href="https://azure.microsoft.com/en-us/services/cosmos-db/">Azure Cosmos DB</a>&nbsp;which&nbsp;automatically indexes all data and allows you to use the&nbsp;MongoDB API. You can learn more from this blog post on&nbsp;<a href="https://docs.microsoft.com/en-us/azure/cosmos-db/connect-mongodb-account">how to connect a MongoDB application to CosmosDB</a>.</p>
        <p><a href="https://github.com/palindromed/Bot-HandOff/blob/npm-handoff/src/mongoose-provider.ts"> <span id="crayon-59d2f1f294681837615076" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">mongoose</span><span class="crayon-o">-</span><span class="crayon-v">provider</span><span class="crayon-sy">.</span><span class="crayon-v">ts</span></span></span></a>&nbsp; handles all of the database interactions, and is where all of the schemas are described and, through a series of promises, the conversation is created, deleted, and updated. &nbsp;For example:</p>
        <div id="crayon-59d2f1f294683474182865" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
export interface ConversationDocument extends Conversation, mongoose.Document { }

export const ConversationModel = mongoose.model&lt;ConversationDocument&gt;('Conversation', ConversationSchema)

private async updateConversation(conversation: Conversation): Promise&lt;boolean&gt; {
    return new Promise&lt;boolean&gt;((resolve, reject) =&gt; {
        ConversationModel.findByIdAndUpdate((conversation as any)._id, conversation).then((error) =&gt; {
            resolve(true)
        }).catch((error) =&gt; {
            console.log('Failed to update conversation');
            console.log(conversation as any);
            resolve(false);
        });
    });
}</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294683474182865-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294683474182865-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294683474182865-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294683474182865-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294683474182865-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294683474182865-12">
                12
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-13">
                13
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294683474182865-14">
                14
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294683474182865-15">
                15
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-1">
                <span class="crayon-e">export </span>
                <span class="crayon-t">interface</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">ConversationDocument </span>
                <span class="crayon-r">extends</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">Conversation</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">mongoose</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-i">Document</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294683474182865-2">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-3">
                <span class="crayon-e">export </span>
                <span class="crayon-m">const</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">ConversationModel</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">mongoose</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">model</span>
                <span class="crayon-o">&lt;</span>
                <span class="crayon-v">ConversationDocument</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">'Conversation'</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">ConversationSchema</span>
                <span class="crayon-sy">)</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294683474182865-4">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-5">
                <span class="crayon-m">private</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">async </span>
                <span class="crayon-e">updateConversation</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">Conversation</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">Promise</span>
                <span class="crayon-o">&lt;</span>
                <span class="crayon-t">boolean</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294683474182865-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">return</span>
                <span class="crayon-h"> </span>
                <span class="crayon-r">new</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">Promise</span>
                <span class="crayon-o">&lt;</span>
                <span class="crayon-t">boolean</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">resolve</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">reject</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-7">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">ConversationModel</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">findByIdAndUpdate</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-e">conversation </span>
                <span class="crayon-st">as</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">any</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">_id</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-st">then</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">error</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294683474182865-8">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">resolve</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-t">true</span>
                <span class="crayon-sy">)</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-9">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-st">catch</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">error</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294683474182865-10">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">console</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">log</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">'Failed to update conversation'</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-11">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">console</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">log</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-e">conversation </span>
                <span class="crayon-st">as</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">any</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294683474182865-12">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">resolve</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-t">false</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-13">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294683474182865-14">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294683474182865-15">
                <span class="crayon-sy">}</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p></p>
        <h2><a name="app-insights"></a>Application Insights</h2>
        <p>The need to record all the conversation details in <a href="https://azure.microsoft.com/en-us/services/application-insights/">Azure Application Insights</a> came from a hackfest we did with a partner. They wanted to use the<a href="https://github.com/CatalystCode/ibex-dashboard"> Ibex dashboard</a> to display all the Handoff interactions.</p>
        <p>We implemented Application Insights as an optional feature by only logging the data to Application Insights if they provide the Application Insights instrumentation key in the initial setup of the handoff module, or through an environment variable.</p>
        <p>We used the <a href="https://www.npmjs.com/package/applicationinsights">Application Insights npm module</a> to set up and start&nbsp;an Application Insights client. This client is then used to track an event under the title <em>Transcript</em>.</p>
        <div id="crayon-59d2f1f294685153676981" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
let appInsights = require('applicationinsights');

appInsights.setup(_appInsightsInstrumentationKey).start();
exports._appInsights = appInsights;</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294685153676981-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294685153676981-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294685153676981-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294685153676981-4">
                4
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294685153676981-1">
                <span class="crayon-e">let </span>
                <span class="crayon-v">appInsights</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">require</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">'applicationinsights'</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294685153676981-2">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294685153676981-3">
                <span class="crayon-v">appInsights</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">setup</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">_appInsightsInstrumentationKey</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">start</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294685153676981-4">
                <span class="crayon-v">exports</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">_appInsights</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">appInsights</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>The Application Insights logging happens in the <span id="crayon-59d2f1f294686216745064" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-e">addToTranscript</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></span></span>&nbsp;&nbsp;method. Two things worth noting here:</p>
        <ol>
         <li>You cant log embedded JSON&nbsp;objects in Application Insights, so we flatten the object to one item.</li>
         <li>We had to first stringify the object we got from MongoDB before parsing it so that functions from MongoDB dont get logged&nbsp; <span id="crayon-59d2f1f294688418081085" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">JSON</span><span class="crayon-sy">.</span><span class="crayon-e">parse</span><span class="crayon-sy">(</span><span class="crayon-v">JSON</span><span class="crayon-sy">.</span><span class="crayon-e">stringify</span><span class="crayon-sy">(</span><span class="crayon-t">OBJECT</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></span></span>.</li>
        </ol>
        <p></p>
        <div id="crayon-59d2f1f294689647857437" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
if (indexExports._appInsights) {   
    let latestTranscriptItem = conversation.transcript.length-1;
    let x = JSON.parse(JSON.stringify(conversation.transcript[latestTranscriptItem]));
    x['botId'] = conversation.Customer.bot.id;
    x['CustomerId'] = conversation.Customer.user.id;
    x['CustomerName'] = conversation.Customer.user.name;
    x['CustomerChannelId'] = conversation.Customer.channelId;
    x['CustomerConversationId'] = conversation.Customer.conversation.id;
    if (conversation.Agent) {
        x['AgentId'] = conversation.Agent.user.id;
        x['AgentName'] = conversation.Agent.user.name;
        x['AgentChannelId'] = conversation.Agent.channelId;
        x['AgentConversationId'] = conversation.Agent.conversation.id;
    }
    indexExports._appInsights.client.trackEvent("Transcript", x);    
}</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-12">
                12
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-13">
                13
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-14">
                14
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294689647857437-15">
                15
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294689647857437-16">
                16
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-1">
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">indexExports</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">_appInsights</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h">&nbsp;&nbsp; </span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-v">latestTranscriptItem</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">transcript</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">length</span>
                <span class="crayon-o">-</span>
                <span class="crayon-cn">1</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-i">let</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">x</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">JSON</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">parse</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">JSON</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">stringify</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">transcript</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-v">latestTranscriptItem</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-4">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'botId'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Customer</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">bot</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">id</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-5">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'CustomerId'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Customer</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">user</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">id</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'CustomerName'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Customer</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">user</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">name</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-7">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'CustomerChannelId'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Customer</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">channelId</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-8">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'CustomerConversationId'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Customer</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">id</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-9">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Agent</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-10">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'AgentId'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Agent</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">user</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">id</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-11">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'AgentName'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Agent</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">user</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">name</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-12">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'AgentChannelId'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Agent</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">channelId</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-13">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'AgentConversationId'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Agent</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">id</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-14">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294689647857437-15">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">indexExports</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">_appInsights</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">client</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">trackEvent</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">"Transcript"</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">x</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294689647857437-16">
                <span class="crayon-sy">}</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p></p>
        <h2><a name="sentiment"></a>Sentiment Analysis</h2>
        <p>We wanted to give bot authors the option to also log the sentiment score of messages from the Customer using <a href="https://azure.microsoft.com/en-us/services/cognitive-services/text-analytics/">Microsoft Cognitive Services Text Analytics</a>; this API returns a value between 0 and 1 where 1 is a very positive sentiment and 0 is a very negative sentiment. If the user is not the Customer, or they do not provided an API key, the default sentiment score is set to -1.</p>
        <div id="crayon-59d2f1f29468c604898939" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
let sentimentScore = -1;

...

if (from == "Customer") {
    if (indexExports._textAnalyticsKey) { 
        sentimentScore = await this.collectSentiment(text); 
    }
}

...

conversation.transcript.push({
    timestamp: datetime,
    from: from,
    sentimentScore: sentimentScore,
    state: conversation.state,
    text
});</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-12">
                12
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-13">
                13
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-14">
                14
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-15">
                15
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-16">
                16
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-17">
                17
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468c604898939-18">
                18
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468c604898939-19">
                19
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-1">
                <span class="crayon-e">let </span>
                <span class="crayon-v">sentimentScore</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">-</span>
                <span class="crayon-cn">1</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-2">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-3">
                <span class="crayon-sy">.</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-sy">.</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-4">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-5">
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">from</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">==</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"Customer"</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">indexExports</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">_textAnalyticsKey</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-7">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">sentimentScore</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">await </span>
                <span class="crayon-r">this</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">collectSentiment</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">text</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
                <span class="crayon-h"> </span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-8">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-9">
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-10">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-11">
                <span class="crayon-sy">.</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-sy">.</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-12">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-13">
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">transcript</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">push</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-14">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">timestamp</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">datetime</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-15">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">from</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">from</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-16">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">sentimentScore</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">sentimentScore</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-17">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">state</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">conversation</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">state</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468c604898939-18">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-i">text</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468c604898939-19">
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>We get the sentiment score by sending the users text to the Text Analytics API.</p>
        <div id="crayon-59d2f1f29468d957927424" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
private async collectSentiment(text: string): Promise&lt;number&gt; {
    if (text == null || text == '') return;
    let _sentimentUrl = 'https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/sentiment';
    let _sentimentId = 'bot-analytics';
    let _sentimentKey = indexExports._textAnalyticsKey;

    let options = {
        url: _sentimentUrl,
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Ocp-Apim-Subscription-Key': _sentimentKey
        },
        json: true,
        body: {
            "documents": [
                {
                    "language": "en",
                    "id": _sentimentId,
                    "text": text
                }
            ]
        }
    };

    return new Promise&lt;number&gt;(function (resolve, reject) {
        request(options, (error, response, body) =&gt; {
            if (error) { reject(error); }
            let result: any = _.find(body.documents, { id: _sentimentId }) || {};
            let score = result.score || null;
            resolve(score);
        });
    });
}</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-12">
                12
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-13">
                13
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-14">
                14
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-15">
                15
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-16">
                16
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-17">
                17
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-18">
                18
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-19">
                19
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-20">
                20
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-21">
                21
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-22">
                22
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-23">
                23
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-24">
                24
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-25">
                25
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-26">
                26
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-27">
                27
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-28">
                28
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-29">
                29
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-30">
                30
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-31">
                31
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-32">
                32
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f29468d957927424-33">
                33
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f29468d957927424-34">
                34
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-1">
                <span class="crayon-m">private</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">async </span>
                <span class="crayon-e">collectSentiment</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">text</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">string</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">Promise</span>
                <span class="crayon-o">&lt;</span>
                <span class="crayon-e">number</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">text</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">==</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">null</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">||</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">text</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">==</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">''</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">return</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-e ">_sentimentUrl</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/sentiment'</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-4">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-e ">_sentimentId</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'bot-analytics'</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-5">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-v">_sentimentKey</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">indexExports</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">_textAnalyticsKey</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-6">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-7">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-v">options</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-8">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">url</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">_sentimentUrl</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-9">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">method</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'POST'</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-10">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">headers</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-11">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-s">'Content-Type'</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'application/json'</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-12">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-s">'Ocp-Apim-Subscription-Key'</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-i">_sentimentKey</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-13">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-14">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">json</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">true</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-15">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">body</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-16">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-s">"documents"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">[</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-17">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-18">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-s">"language"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"en"</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-19">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-s">"id"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">_sentimentId</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-20">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-s">"text"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-i">text</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-21">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-22">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">]</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-23">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-24">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-25">
                &nbsp;
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-26">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">return</span>
                <span class="crayon-h"> </span>
                <span class="crayon-r">new</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">Promise</span>
                <span class="crayon-o">&lt;</span>
                <span class="crayon-v">number</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-t">function</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">resolve</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">reject</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-27">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">request</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">options</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">error</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">response</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">body</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-28">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">error</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">reject</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">error</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-29">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-v">result</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">any</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">_</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">find</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">body</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">documents</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">id</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-i">_sentimentId</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">||</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-30">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-v">score</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">result</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">score</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">||</span>
                <span class="crayon-h"> </span>
                <span class="crayon-t">null</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-31">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">resolve</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">score</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-32">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f29468d957927424-33">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f29468d957927424-34">
                <span class="crayon-sy">}</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p></p>
        <h2><a name="force-handoff"></a>Force Handoff via API</h2>
        <p>To provide additional means of controlling and customizing the Handoff experience, an endpoint ( <span id="crayon-59d2f1f294690888935708" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">POST</span></span></span>) is available to queue a Customer to speak to an Agent using the Customers conversation ID. &nbsp;This API useful for a partner who wanted to use their own system to view all current conversations happening with a bot, and trigger the handoff manually with a button click, for any given conversation.</p>
        <div id="crayon-59d2f1f294691087279740" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
app.post('/api/conversations', async (req, res) =&gt; {
    const authHeader = req.headers['authorization'];
    if (authHeader) {
        if (authHeader === 'Bearer ' + _directLineSecret) {
            if (await handoff.queueCustomerForAgent({ customerConversationId: req.body.conversationId })) {
                res.status(200).send({ "code": 200, "message": "OK" });
            } else {
                res.status(400).send({ "code": 400, "message": "Can't find conversation ID" });
            }
        }
    } else {
        res.status(401).send({ "code": 401, "message": "Not Authorized" });
    }
});</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294691087279740-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294691087279740-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294691087279740-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294691087279740-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294691087279740-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294691087279740-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294691087279740-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294691087279740-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294691087279740-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294691087279740-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294691087279740-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294691087279740-12">
                12
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294691087279740-13">
                13
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294691087279740-14">
                14
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294691087279740-1">
                <span class="crayon-v">app</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">post</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">'/api/conversations'</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">async</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">req</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">res</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294691087279740-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-m">const</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">authHeader</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">req</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">headers</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'authorization'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294691087279740-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">authHeader</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294691087279740-4">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">authHeader</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">===</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'Bearer '</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">+</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">_directLineSecret</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294691087279740-5">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-e">await </span>
                <span class="crayon-v">handoff</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">queueCustomerForAgent</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">customerConversationId</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">req</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">body</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-i">conversationId</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294691087279740-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">res</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">status</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-cn">200</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">send</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"code"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-cn">200</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"message"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"OK"</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294691087279740-7">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">else</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294691087279740-8">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">res</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">status</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-cn">400</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">send</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"code"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-cn">400</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"message"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"Can't find conversation ID"</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294691087279740-9">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294691087279740-10">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294691087279740-11">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">else</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294691087279740-12">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">res</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">status</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-cn">401</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">send</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">{</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"code"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-cn">401</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"message"</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">"Not Authorized"</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294691087279740-13">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294691087279740-14">
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>You can use the <span id="crayon-59d2f1f294693303110538" class="crayon-syntax crayon-syntax-inline  crayon-theme-github crayon-theme-github-inline crayon-font-monaco" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important;"><span class="crayon-pre crayon-code" style="font-size: 12px !important; line-height: 15px !important;font-size: 12px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><span class="crayon-v">GET</span></span></span>&nbsp;endpoint to retrieve a list of all current conversations:</p>
        <div id="crayon-59d2f1f294694927435469" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
app.get('/api/conversations', async (req, res) =&gt; {
    const authHeader = req.headers['authorization'];
    console.log(authHeader);
    console.log(req.headers);
    if (authHeader) {
        if (authHeader === 'Bearer ' + _directLineSecret) {
            let conversations = await mongooseProvider.getCurrentConversations()
            res.status(200).send(conversations);
        }
    }
    res.status(401).send('Not Authorized');
});</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294694927435469-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294694927435469-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294694927435469-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294694927435469-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294694927435469-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294694927435469-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294694927435469-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294694927435469-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294694927435469-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294694927435469-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294694927435469-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294694927435469-12">
                12
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294694927435469-1">
                <span class="crayon-v">app</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">get</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">'/api/conversations'</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">async</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">req</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">res</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294694927435469-2">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-m">const</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">authHeader</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">req</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">headers</span>
                <span class="crayon-sy">[</span>
                <span class="crayon-s">'authorization'</span>
                <span class="crayon-sy">]</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294694927435469-3">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">console</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">log</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">authHeader</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294694927435469-4">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">console</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">log</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">req</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">headers</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294694927435469-5">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">authHeader</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294694927435469-6">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-st">if</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">authHeader</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">===</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'Bearer '</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">+</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">_directLineSecret</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294694927435469-7">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-e">let </span>
                <span class="crayon-v">conversations</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">await </span>
                <span class="crayon-v">mongooseProvider</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">getCurrentConversations</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-sy">)</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294694927435469-8">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">res</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">status</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-cn">200</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">send</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">conversations</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294694927435469-9">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294694927435469-10">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-sy">}</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294694927435469-11">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">res</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">status</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-cn">401</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">send</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">'Not Authorized'</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294694927435469-12">
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>The images below show a third party application took advantage of the Application Insights logs and this API:</p>
        <p><img class="aligncenter wp-image-4369 size-large" src="/developerblog/wp-content/uploads/Screen-Shot-2017-06-29-at-10.56.31-AM-1024x705.png" alt="" width="780" height="537" srcset="https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/Screen-Shot-2017-06-29-at-10.56.31-AM-1024x705.png 1024w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/Screen-Shot-2017-06-29-at-10.56.31-AM-300x207.png 300w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/Screen-Shot-2017-06-29-at-10.56.31-AM-768x529.png 768w, https://codestoryedge.azureedge.net/developerblog/wp-content/uploads/Screen-Shot-2017-06-29-at-10.56.31-AM.png 1226w" sizes="(max-width: 780px) 100vw, 780px"></p>
        <p><img class="aligncenter wp-image-4370 size-large" src="/developerblog/wp-content/uploads/handoff-page-1024x621.png" alt="" width="780" height="473" srcset="https://www.microsoft.com/developerblog//wp-content/uploads/handoff-page-1024x621.png 1024w, https://www.microsoft.com/developerblog//wp-content/uploads/handoff-page-300x182.png 300w, https://www.microsoft.com/developerblog//wp-content/uploads/handoff-page-768x466.png 768w, https://www.microsoft.com/developerblog//wp-content/uploads/handoff-page.png 1356w" sizes="(max-width: 780px) 100vw, 780px"></p>
        <h2><a name="npm"></a>Using the npm package</h2>
        <p>To make this framework easy to use, we packaged it up and made it available through npm under the name <a href="https://www.npmjs.com/package/botbuilder-handoff">botbuilder-handoff</a>. &nbsp;Below is an example of how you can use the framework in a normal bot:</p>
        <div id="crayon-59d2f1f294696274790021" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
         <div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
          <span class="crayon-title"></span>
          <div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;">
           <div class="crayon-button crayon-nums-button" title="Toggle Line Numbers">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-plain-button" title="Toggle Plain Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-expand-button" title="Expand Code">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-copy-button" title="Copy">
            <div class="crayon-button-icon"></div>
           </div>
           <div class="crayon-button crayon-popup-button" title="Open Code In New Window">
            <div class="crayon-button-icon"></div>
           </div>
           <span class="crayon-language">JavaScript</span>
          </div>
         </div>
         <div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
         <div class="crayon-plain-wrap">
          <textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import * as builder from 'botbuilder';
import * as handoff from 'botbuilder-handoff';

//=========================================================
// Handoff Setup
//=========================================================

// Replace this function with custom login/verification for agents
const isAgent = (session: builder.Session) =&gt; session.message.user.name.startsWith("Agent");

/**
    bot: builder.UniversalBot
    app: express ( e.g. const app = express(); )
    isAgent: function to determine when agent is talking to the bot
    options: { }
**/
handoff.setup(bot, app, isAgent, {
    mongodbProvider: process.env.MONGODB_PROVIDER,
    directlineSecret: process.env.MICROSOFT_DIRECTLINE_SECRET,
    textAnalyticsKey: process.env.CG_SENTIMENT_KEY,
    appInsightsInstrumentationKey: process.env.APPINSIGHTS_INSTRUMENTATIONKEY,
    retainData: process.env.RETAIN_DATA,
    customerStartHandoffCommand: process.env.CUSTOMER_START_HANDOFF_COMMAND
});</textarea>
         </div>
         <div class="crayon-main" style="">
          <table class="crayon-table">
           <tbody>
            <tr class="crayon-row">
             <td class="crayon-nums " data-settings="show">
              <div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;">
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-1">
                1
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-2">
                2
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-3">
                3
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-4">
                4
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-5">
                5
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-6">
                6
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-7">
                7
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-8">
                8
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-9">
                9
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-10">
                10
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-11">
                11
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-12">
                12
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-13">
                13
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-14">
                14
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-15">
                15
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-16">
                16
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-17">
                17
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-18">
                18
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-19">
                19
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-20">
                20
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-21">
                21
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-22">
                22
               </div>
               <div class="crayon-num" data-line="crayon-59d2f1f294696274790021-23">
                23
               </div>
               <div class="crayon-num crayon-striped-num" data-line="crayon-59d2f1f294696274790021-24">
                24
               </div>
              </div></td>
             <td class="crayon-code">
              <div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;">
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-1">
                <span class="crayon-v">import</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">*</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">as</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">builder </span>
                <span class="crayon-i">from</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'botbuilder'</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-2">
                <span class="crayon-v">import</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">*</span>
                <span class="crayon-h"> </span>
                <span class="crayon-st">as</span>
                <span class="crayon-h"> </span>
                <span class="crayon-e">handoff </span>
                <span class="crayon-i">from</span>
                <span class="crayon-h"> </span>
                <span class="crayon-s">'botbuilder-handoff'</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-3">
                &nbsp;
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-4">
                <span class="crayon-c">//=========================================================</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-5">
                <span class="crayon-c">// Handoff Setup</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-6">
                <span class="crayon-c">//=========================================================</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-7">
                &nbsp;
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-8">
                <span class="crayon-c">// Replace this function with custom login/verification for agents</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-9">
                <span class="crayon-m">const</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">isAgent</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">session</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">builder</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">Session</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-h"> </span>
                <span class="crayon-o">=</span>
                <span class="crayon-o">&gt;</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">session</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">message</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">user</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">name</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">startsWith</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-s">"Agent"</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-10">
                &nbsp;
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-11">
                <span class="crayon-c">/**</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-12">
                <span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;bot: builder.UniversalBot</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-13">
                <span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;app: express ( e.g. const app = express(); )</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-14">
                <span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;isAgent: function to determine when agent is talking to the bot</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-15">
                <span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;options: { }</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-16">
                <span class="crayon-c">**/</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-17">
                <span class="crayon-v">handoff</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-e">setup</span>
                <span class="crayon-sy">(</span>
                <span class="crayon-v">bot</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">app</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">isAgent</span>
                <span class="crayon-sy">,</span>
                <span class="crayon-h"> </span>
                <span class="crayon-sy">{</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-18">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">mongodbProvider</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">process</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">env</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">MONGODB_PROVIDER</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-19">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">directlineSecret</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">process</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">env</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">MICROSOFT_DIRECTLINE_SECRET</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-20">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">textAnalyticsKey</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">process</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">env</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">CG_SENTIMENT_KEY</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-21">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">appInsightsInstrumentationKey</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">process</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">env</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">APPINSIGHTS_INSTRUMENTATIONKEY</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-22">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">retainData</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">process</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">env</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">RETAIN_DATA</span>
                <span class="crayon-sy">,</span>
               </div>
               <div class="crayon-line" id="crayon-59d2f1f294696274790021-23">
                <span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span class="crayon-v">customerStartHandoffCommand</span>
                <span class="crayon-o">:</span>
                <span class="crayon-h"> </span>
                <span class="crayon-v">process</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">env</span>
                <span class="crayon-sy">.</span>
                <span class="crayon-v">CUSTOMER_START_HANDOFF</span>
                <span class="crayon-sy">_</span>COMMAND
               </div>
               <div class="crayon-line crayon-striped-line" id="crayon-59d2f1f294696274790021-24">
                <span class="crayon-sy">}</span>
                <span class="crayon-sy">)</span>
                <span class="crayon-sy">;</span>
               </div>
              </div></td>
            </tr>
           </tbody>
          </table>
         </div>
        </div>
        <p>The <a href="https://www.npmjs.com/package/botbuilder-handoff">README</a> for this project explains every&nbsp;option in detail.</p>
        <h2><a name="conclusion"></a> Conclusion</h2>
        <p>This framework enables anyone developing a bot using the Node.js Bot Framework SDK to integrate&nbsp;bot to human handoff feature. The added functionality of Application Insights and the sentiment score provide bot authors with more data about interactions with their bot. This data can then be used to customize the bot-to-human handoff experience and analyze the overall customer experience with their bot and agents.</p>
        <p>This project is open sourced and available on <a href="https://github.com/palindromed/Bot-HandOff/tree/npm-handoff">Github:Bot-Handoff</a>.&nbsp;We continue to add major new features, but it is in a usable state now.&nbsp;Contributions to this project are always welcome!</p>
        <h3>Resources</h3>
        <ul>
         <li><a href="https://github.com/palindromed/Bot-HandOff/tree/npm-handoff">Bot-Handoff source code</a></li>
         <li><a href="https://www.npmjs.com/package/botbuilder-handoff">botbuilder-handoff npm&nbsp;module</a></li>
         <li><a href="https://github.com/CatalystCode/ibex-dashboard">Ibex Dashboard</a></li>
         <li><a href="https://dev.botframework.com">Microsoft Bot Framework</a></li>
        </ul>
       </div>
       <footer class="entry-footer">
        <div class="ms-entry-footer-share-container" data-share-title="Bot to Human Handoff in Node.js " data-share-url="https://www.microsoft.com/developerblog/2017/06/30/bot-to-human-handover-in-node-js/" data-share-share-button-class="custom-button"> 
         <img alt="Share button" title="Share this article" class="custom-button ms-entry-footer-share" src="https://www.microsoft.com/developerblog//wp-content/themes/gridbox/images/share-32.png" width="32" height="32"> 
         <span class="ms-entry-meta-share-text">Share</span>
        </div>
        <div class="entry-tags clearfix"> 
         <span class="meta-tags"> <a href="https://www.microsoft.com/developerblog/tag/azure-application-insights/" rel="tag">Azure Application Insights</a><a href="https://www.microsoft.com/developerblog/tag/bot-framework-sdk/" rel="tag">Bot Framework SDK</a><a href="https://www.microsoft.com/developerblog/tag/bots/" rel="tag">bots</a><a href="https://www.microsoft.com/developerblog/tag/microsoft-bot-framework-mbf/" rel="tag">Microsoft Bot Framework (MBF)</a><a href="https://www.microsoft.com/developerblog/tag/sentiment-analysis/" rel="tag">sentiment analysis</a> </span>
        </div> 
       </footer>
      </article>
      <div id="comments" class="comments-area">
       <div id="respond" class="comment-respond">
        <h3 id="reply-title" class="comment-reply-title"><span>Leave a Reply</span> <small><a rel="nofollow" id="cancel-comment-reply-link" href="/developerblog/2017/06/30/bot-to-human-handover-in-node-js/#respond" style="display:none;">Cancel reply</a></small></h3>
        <form action="/developerblog/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate>
         <p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p>
         <p class="comment-form-comment"><label for="comment">Comment</label><textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" aria-required="true" required></textarea></p>
         <p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" aria-required="true" required></p>
         <p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" aria-required="true" required></p>
         <p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200"></p>
         <p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment"> <input type="hidden" name="comment_post_ID" value="4098" id="comment_post_ID"> <input type="hidden" name="comment_parent" id="comment_parent" value="0"></p>
         <p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="215d3bc6c1"></p>
         <p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="41"></p>
        </form>
       </div>
      </div> 
     </main> 
    </section> 
    <section id="secondary" class="sidebar widget-area clearfix" role="complementary">
     <div class="author-spotlight">
      <div class="author-profile">
       <a href="https://www.microsoft.com/developerblog/author/lilian/"><img width="96" height="96" src="https://www.microsoft.com/developerblog//wp-content/uploads/lilian-96x96.jpg" class="avatar avatar-96 photo" alt="" srcset="https://www.microsoft.com/developerblog//wp-content/uploads/lilian-96x96.jpg 96w, https://www.microsoft.com/developerblog//wp-content/uploads/lilian-32x32.jpg 32w, https://www.microsoft.com/developerblog//wp-content/uploads/lilian-50x50.jpg 50w, https://www.microsoft.com/developerblog//wp-content/uploads/lilian-64x64.jpg 64w, https://www.microsoft.com/developerblog//wp-content/uploads/lilian-128x128.jpg 128w, https://www.microsoft.com/developerblog//wp-content/uploads/lilian.jpg 722w" sizes="(max-width: 96px) 100vw, 96px"><h2>Lilian Kasem</h2></a>
       <div class="author-description">
        Software Engineer at Microsoft. Proud member of Hufflepuff. Passionate about technology.
       </div>
      </div>
     </div>
     <div id="social-icons" style="height:30px;margin-bottom:40px;margin-top:5px;">
      <a style="margin-right: 2px;" href="http://liliankasem.com" target="_blank" title="Homepage" onclick="trackOutboundLink('http://liliankasem.com'); return false;"><img width="32px" height="32px" src="https://www.microsoft.com/developerblog//wp-content/plugins/author-profile/images/home.png" title="Homepage" alt="Homepage"></a>
      <a style="margin-right: 2px;" href="http://twitter.com/liliankasem" target="_blank" title="Twitter" onclick="trackOutboundLink('http://twitter.com/liliankasem'); return false;"><img width="32px" height="32px" src="https://codestoryedge.azureedge.net/developerblog/wp-content/plugins/author-profile/images/twitter.png" title="Twitter" alt="Twitter"></a>
      <a style="margin-right: 2px;" href="https://www.linkedin.com/in/liliankasem/" target="_blank" title="LinkedIn" onclick="trackOutboundLink('https://www.linkedin.com/in/liliankasem/'); return false;"><img width="32px" height="32px" src="https://codestoryedge.azureedge.net/developerblog/wp-content/plugins/author-profile/images/linkedin.png" title="LinkedIn" alt="LinkedIn"></a>
     </div>
     <div class="author-spotlight">
      <div class="author-profile">
       <a href="https://www.microsoft.com/developerblog/author/hannah-krager/"><img width="96" height="96" src="https://www.microsoft.com/developerblog//wp-content/uploads/2015-08-29-20.05.22-96x96.jpg" class="avatar avatar-96 photo" alt="" srcset="https://www.microsoft.com/developerblog//wp-content/uploads/2015-08-29-20.05.22-96x96.jpg 96w, https://www.microsoft.com/developerblog//wp-content/uploads/2015-08-29-20.05.22-32x32.jpg 32w, https://www.microsoft.com/developerblog//wp-content/uploads/2015-08-29-20.05.22-50x50.jpg 50w, https://www.microsoft.com/developerblog//wp-content/uploads/2015-08-29-20.05.22-64x64.jpg 64w, https://www.microsoft.com/developerblog//wp-content/uploads/2015-08-29-20.05.22-128x128.jpg 128w" sizes="(max-width: 96px) 100vw, 96px"><h2>Hannah Krager</h2></a>
       <div class="author-description">
        Software Engineer at Microsoft. Pythonista and Whovian
       </div>
      </div>
     </div>
     <div id="social-icons" style="display:none;"></div>
     <aside id="search-2" class="widget widget_search clearfix">
      <form role="search" method="get" class="search-form" action="https://www.microsoft.com/developerblog/"> 
       <label> <span class="screen-reader-text">Search for:</span> <input type="search" class="search-field" placeholder="Search " value="" name="s" title="Search for:"> </label> 
       <button type="submit" class="search-submit"> <span class="genericon-search"></span> <span class="screen-reader-text">Search</span> </button>
      </form> 
     </aside>
     <aside id="categories-2" class="widget widget_categories clearfix">
      <div class="widget-header">
       <h3 class="widget-title">Categories</h3>
      </div>
      <ul>
       <li class="cat-item cat-item-346"><a href="https://www.microsoft.com/developerblog/category/azure-app-services/">Azure App Services</a></li>
       <li class="cat-item cat-item-349"><a href="https://www.microsoft.com/developerblog/category/big-data/">Big Data</a></li>
       <li class="cat-item cat-item-350"><a href="https://www.microsoft.com/developerblog/category/blockchain/">Blockchain</a></li>
       <li class="cat-item cat-item-347"><a href="https://www.microsoft.com/developerblog/category/bots/">Bots</a></li>
       <li class="cat-item cat-item-644"><a href="https://www.microsoft.com/developerblog/category/cognitive-services/">Cognitive Services</a></li>
       <li class="cat-item cat-item-656"><a href="https://www.microsoft.com/developerblog/category/containers/">Containers</a></li>
       <li class="cat-item cat-item-373"><a href="https://www.microsoft.com/developerblog/category/devops/">DevOps</a></li>
       <li class="cat-item cat-item-351"><a href="https://www.microsoft.com/developerblog/category/frameworks/">Frameworks</a></li>
       <li class="cat-item cat-item-626"><a href="https://www.microsoft.com/developerblog/category/iot/">Internet Of Things</a></li>
       <li class="cat-item cat-item-348"><a href="https://www.microsoft.com/developerblog/category/machine-learning/">Machine Learning</a></li>
      </ul> 
     </aside> 
    </section>
   </div>
   <div id="footer" class="footer-wrap"> 
    <footer id="colophon" class="site-footer container clearfix" role="contentinfo">
     <div id="footer-text" class="site-info"> 
      <span class="credit-link"></span>
     </div> 
    </footer>
   </div>
  </div> 
  <script src="/developerblog/wp-content/themes/gridbox/ms/init-share.js"></script>
  <script type="text/javascript" src="https://www.microsoft.com/developerblog//wp-content/plugins/akismet/_inc/form.js?ver=3.3.2"></script> 
  <link rel="stylesheet" id="hljstheme-css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css?ver=0.6.2" type="text/css" media="all"> 
  <script type="text/javascript" src="https://www.microsoft.com/developerblog//wp-content/plugins/drawit/js/drawit-iframe.js?ver=1.1.3"></script> 
  <script type="text/javascript" src="/developerblog/wp-includes/js/comment-reply.min.js?ver=4.8.2"></script> 
  <script type="text/javascript" src="/developerblog/wp-includes/js/wp-embed.min.js?ver=4.8.2"></script> 
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js?ver=0.6.2"></script> 
  <style>pre.hljs{padding:5px}pre.hljs
code{}</style> 
  <script type="text/javascript">(function($,window){var init_fn_flag=false;var init_fn=(function(){if(init_fn_flag)
return;init_fn_flag=true;hljs.configure({"tabReplace":"    "});$('pre code').each(function(i,block){hljs.highlightBlock(block);});$('pre:not(:has(code))').each(function(i,block){var class_desc=$(block).attr("class")||"";var reg_mat=class_desc.match(/lang\s*:\s*([\w\d]+)/i);var code_content=$("<code class='hljs'></code>").html($(block).removeAttr('class').html());if(reg_mat&&reg_mat.length>=2){code_content.addClass(reg_mat[1]);}
$(block).empty().append(code_content);hljs.highlightBlock(block);});});$(document).ready(init_fn);$(window).on("load",init_fn);})(jQuery,window);</script> 
  <div class="ms-footer">
   <div class="shell-footer" ms.pgarea="uhffooter" data-bi-area="Footer" data-bi-view="5xLinks">
    <div class="shell-footer-wrapper">
     <div class="shell-footer-menugroups" ms.cmpgrp="footer nav">
      <div class="sfm-group" ms.cmpnm="Popular">
       <div class="grp-title">
         Popular
        <i class="shell-icon-dropdown"></i>
       </div>
       <ul>
        <li> <a href="https://developer.microsoft.com/en-us/windows" ms.title="Windows Dev Center" data-bi-name="Popular_WindowsDevCenter" data-bi-slot="1" data-bi-source="Compass"> Windows Dev Center </a></li>
        <li> <a href="https://azure.microsoft.com/" ms.title="Microsoft Azure" data-bi-name="Popular_MicrosoftAzure" data-bi-slot="2" data-bi-source="Compass"> Microsoft Azure </a></li>
        <li> <a href="https://www.visualstudio.com/" ms.title="Microsoft Visual Studio " data-bi-name="Popular_MicrosoftVisualStudio" data-bi-slot="3" data-bi-source="Compass"> Microsoft Visual Studio </a></li>
        <li> <a href="https://dev.office.com/" ms.title="Office Dev Center" data-bi-name="Popular_OfficeDevCenter" data-bi-slot="4" data-bi-source="Compass"> Office Dev Center </a></li>
        <li> <a href="https://www.asp.net/" ms.title="ASP.NET" data-bi-name="Popular_asp.net " data-bi-slot="5" data-bi-source="Compass"> ASP.NET </a></li>
        <li> <a href="https://www.iis.net/" ms.title="IIS.NET" data-bi-name="Popular_IIS.net" data-bi-slot="6" data-bi-source="Compass"> IIS.NET </a></li>
       </ul>
      </div>
      <div class="sfm-group" ms.cmpnm="LearningResources">
       <div class="grp-title">
         Learning Resources 
        <i class="shell-icon-dropdown"></i>
       </div>
       <ul>
        <li> <a href="https://channel9.msdn.com/" ms.title="Channel 9" data-bi-name="LearningResources_Channel9" data-bi-slot="1" data-bi-source="Compass"> Channel 9 </a></li>
        <li> <a href="https://developer.microsoft.com/en-us/windows/develop/app-development-video" ms.title="Windows development videos" data-bi-name="LearningResources_WindowsDevelopmentVideos" data-bi-slot="2" data-bi-source="Compass"> Windows development videos </a></li>
        <li> <a href="https://mva.microsoft.com/" ms.title="Microsoft Virtual Academy " data-bi-name="LearningResources_MicrosoftVirtualAcademy" data-bi-slot="3" data-bi-source="Compass"> Microsoft Virtual Academy </a></li>
       </ul>
      </div>
      <div class="sfm-group" ms.cmpnm="Programs">
       <div class="grp-title">
         Programs 
        <i class="shell-icon-dropdown"></i>
       </div>
       <ul>
        <li> <a href="https://developer.microsoft.com/en-us/store/register" ms.title="Microsoft developer program" data-bi-name="Programs_AppDeveloperAgreement" data-bi-slot="1" data-bi-source="Compass"> Microsoft developer program </a></li>
        <li> <a href="https://insider.windows.com/" ms.title="Windows Insider program" data-bi-name="Programs_WindowsInsiderProgram" data-bi-slot="2" data-bi-source="Compass"> Windows Insider program </a></li>
        <li> <a href="http://www.microsoftaffiliates.com/" ms.title="Microsoft Affiliate program " data-bi-name="Programs_MicrosoftAffliateProgram" data-bi-slot="3" data-bi-source="Compass"> Microsoft Affiliate program </a></li>
        <li> <a href="https://www.microsoft.com/bizspark" ms.title="BizSpark (for startups) " data-bi-name="Programs_BizSparkforStartups" data-bi-slot="4" data-bi-source="Compass"> BizSpark (for startups) </a></li>
        <li> <a href="https://msdn.microsoft.com/en-us/imagine/imagine-home" ms.title="Microsoft Imagine" data-bi-name="Programs_MicrosoftImagineforStudents" data-bi-slot="5" data-bi-source="Compass"> Microsoft Imagine </a></li>
       </ul>
      </div>
      <div class="sfm-group" ms.cmpnm="ForITPros">
       <div class="grp-title">
         For IT Pros 
        <i class="shell-icon-dropdown"></i>
       </div>
       <ul>
        <li> <a href="https://powerbi.microsoft.com/en-us" ms.title="Microsoft Power BI" data-bi-name="ForITPros_MicrosoftPowerBI" data-bi-slot="1" data-bi-source="Compass"> Microsoft Power BI </a></li>
        <li> <a href="https://www.microsoft.com/en-us/server-cloud/products/sql-server/overview.aspx" ms.title="Microsoft SQL Server " data-bi-name="ForITPros_MicrosoftSQLServer" data-bi-slot="2" data-bi-source="Compass"> Microsoft SQL Server </a></li>
        <li> <a href="https://www.microsoft.com/en-us/server-cloud/internet-of-things/overview.aspx" ms.title="Internet of Things " data-bi-name="ForITPros_InternetofThings" data-bi-slot="3" data-bi-source="Compass"> Internet of Things </a></li>
        <li> <a href="https://www.microsoft.com/en-us/server-cloud/operations-management-suite/overview.aspx" ms.title="Operations Management Suite " data-bi-name="ForITPros_OperationsManagementSuite" data-bi-slot="4" data-bi-source="Compass"> Operations Management Suite </a></li>
       </ul>
      </div>
      <div class="sfm-group" ms.cmpnm="Values">
       <div class="grp-title">
         Values 
        <i class="shell-icon-dropdown"></i>
       </div>
       <ul>
        <li> <a href="https://www.microsoft.com/en-us/diversity/" ms.title="Diversity and inclusion" data-bi-name="Values_DiversityandInclusion" data-bi-slot="1" data-bi-source="Compass"> Diversity and inclusion </a></li>
        <li> <a href="https://www.microsoft.com/en-us/accessibility/home" ms.title="Accessibility" data-bi-name="Values_Accessility" data-bi-slot="2" data-bi-source="Compass"> Accessibility </a></li>
        <li> <a href="https://www.microsoft.com/en-us/education" ms.title="Microsoft in education" data-bi-name="Values_MicrosoftinEducation" data-bi-slot="3" data-bi-source="Compass"> Microsoft in education </a></li>
        <li> <a href="https://www.microsoft.com/about/philanthropies" ms.title="Microsoft philanthropies" data-bi-name="Values_CorporateCitizenship" data-bi-slot="4" data-bi-source="Compass"> Microsoft philanthropies </a></li>
        <li> <a href="https://www.microsoft.com/about/csr" ms.title="Corporate social responsibility" data-bi-name="Values_CorporateSocialResponsibility" data-bi-slot="5" data-bi-source="Compass"> Corporate social responsibility </a></li>
        <li> <a href="https://privacy.microsoft.com/en-us" ms.title="Privacy at Microsoft" data-bi-name="Values_PrivacyatMicrosoft" data-bi-slot="6" data-bi-source="Compass"> Privacy at Microsoft </a></li>
       </ul>
      </div>
      <div class="sfm-group" ms.cmpnm="Company">
       <div class="grp-title">
         Company 
        <i class="shell-icon-dropdown"></i>
       </div>
       <ul>
        <li> <a href="https://careers.microsoft.com/" ms.title="Careers" data-bi-name="Company_Careers" data-bi-slot="1" data-bi-source="Compass"> Careers </a></li>
        <li> <a href="https://www.microsoft.com/en-us/about" ms.title="About Microsoft" data-bi-name="Company_AboutMicrosoft" data-bi-slot="2" data-bi-source="Compass"> About Microsoft </a></li>
        <li> <a href="https://news.microsoft.com/" ms.title="Company news" data-bi-name="Company_CompanyNews" data-bi-slot="3" data-bi-source="Compass"> Company news </a></li>
        <li> <a href="https://www.microsoft.com/investor/default.aspx" ms.title="Investors" data-bi-name="Company_Investors" data-bi-slot="4" data-bi-source="Compass"> Investors </a></li>
        <li> <a href="https://microsoft.com/research" ms.title="Research" data-bi-name="Company_Research" data-bi-slot="5" data-bi-source="Compass"> Research </a></li>
        <li> <a href="https://www.microsoft.com/en-us/sitemap.aspx" ms.title="Site map" data-bi-name="Company_SiteMap" data-bi-slot="6" data-bi-source="Compass"> Site map </a></li>
       </ul>
      </div>
     </div>
     <div class="shell-footer-lang" ms.cmpgrp="loc picker" ms.cmpnm="loc picker">
      <ul>
       <li> <i class="shell-icon-globe"></i></li>
       <li> <a id="locale-picker-link" ms.title="English (United States)" href="http://www.microsoft.com/en-us/locale.aspx" data-bi-name="LocalePicker"> English (United States)? </a></li>
      </ul>
     </div>
     <div class="shell-footer-copyright" ms.cmpgrp="corp links" ms.cmpnm="corp" role="contentinfo">
      <ul>
       <li> <a id="shellmenu_0" href="http://go.microsoft.com/?linkid=2028325" ms.title="Contact us" class="ctl_footerNavLink" data-bi-name="Footer_ContactUs" data-bi-slot="1"> Contact us </a></li>
       <li> <a id="shellmenu_1" href="http://go.microsoft.com/fwlink/?LinkId=248681" ms.title="Privacy and cookies " class="ctl_footerNavLink" data-bi-name="Footer_PrivacyandCookies" data-bi-slot="2"> Privacy and cookies </a></li>
       <li> <a id="shellmenu_2" href="http://go.microsoft.com/fwlink/?LinkID=530144" ms.title="Terms of use" class="ctl_footerNavLink" data-bi-name="Footer_TermsOfUse" data-bi-slot="3"> Terms of use </a></li>
       <li> <a id="shellmenu_3" href="https://www.microsoft.com/trademarks" ms.title="Trademarks" class="ctl_footerNavLink" data-bi-name="Footer_Trademarks" data-bi-slot="4"> Trademarks </a></li>
       <li> <a id="shellmenu_4" href="http://choice.microsoft.com" ms.title="About our ads" class="ctl_footerNavLink" data-bi-name="Footer_AboutourAds" data-bi-slot="5"> About our ads </a></li>
       <li class="ctl_footerCopyright"> © 2017 Microsoft</li>
      </ul>
     </div>
    </div>
   </div>
  </div> 
  <!--
*** This site runs WP Super Minify plugin v1.5.1 - http://wordpress.org/plugins/wp-super-minify ***
*** Total size saved: 11.624% | Size before compression: 269997 bytes | Size after compression: 238612 bytes. ***
--> 
  <!-- Dynamic page generated in 0.122 seconds. --> 
  <!-- Cached page generated by WP-Super-Cache on 2017-10-02 19:12:02 --> 
  <!-- Compression = gzip -->
 </body>
</html>