<!doctype html>
<html lang="en">
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1"> 
  <link rel="icon" href="//www.ibm.com/favicon.ico"> 
  <link rel="canonical" href="http://www.ibm.com/developerworks/library/se-add-google-recaptcha-bluemix-node.js-application/index.html"> 
  <meta name="geo.country" content="ZZ"> 
  <meta name="dcterms.rights" content="© Copyright&nbsp;IBM Corporation&nbsp;2016"> 
  <meta name="dcterms.date" content="2016-03-03"> 
  <meta name="description" content="Some attacks rely on creating a large number of disposable accounts automatically. In this article, you learn how to use the Google reCAPTCHA service to require human intervention to ensure that there is a human in the loop."> 
  <meta name="keywords" content="security, authentication, node.js, reCaptcha, facebook, google, tttsecca"> 
  <meta name="robots" content="index,follow"> 
  <title>Add Google reCAPTCHA to your Bluemix Node.js application</title> 
  <script> 
    digitalData = {
        "page":{
            "category":{
                "primaryCategory":"SOFDCSECZZ"
            },
            "pageInfo":{
                "effectiveDate":"2016-03-03",
                "language":"en",
                "publishDate":"2016-03-03",
                "publisher":"IBM Corporation",
                "version":"v18",
                "ibm":{ 
                    "contentDelivery":"IBM developerWorks template",
                    "contentProducer":"IBM developerWorks",
                    "country":"ZZ",
                    "owner":"developerWorks Content/Raleigh/IBM",
                    "subject":"SWI00",
                    "type":"CT316",
                    "topic":"Bluemix",
                    "topicId":"1237",
                    "contentArea":"security",
                    "contentAreaId":"16",
                    "contentType":"article",
                    "contentId":"1027836",
                },
                "keywords":"security, authentication, node.js, reCaptcha, facebook, google, tttsecca",
                "description":"Some attacks rely on creating a large number of disposable accounts automatically. In this article, you learn how to use the Google reCAPTCHA service to require human intervention to ensure that there is a human in the loop."
            }
        }
    };
    window._analytics = {
        "segment_key":'HU3dbkAG5wE0F1IkRf9S1RexlAqo3jby'
    };
</script> 
  <meta content="player" name="twitter:card"> 
  <meta name="twitter:site" content="@developerworks"> 
  <meta property="og:title" content="Add Google reCAPTCHA to your Bluemix Node.js application"> 
  <meta property="og:description" content="Ensure humans are in the loop and avoid denial of service attacks"> 
  <meta property="og:image" content="http://www.ibm.com/developerworks/library/se-add-google-recaptcha-bluemix-node.js-application/csp0553-thumnail-940x330.png"> 
  <meta name="twitter:player" content="https://www.youtube.com/embed/n_g3LRURfu0"> 
  <meta content="435" name="twitter:player:width"> 
  <meta content="251" name="twitter:player:height"> 
  <!-- Segment meta tag --> 
  <meta name="segment" property="(developerWorks)" productTitle="developerWorks" value="Security English (developerWorks)"> 
  <!-- SITE MON : START (DO NOT DELETE) --> 
  <!-- developerWorks monitoring token --> 
  <!-- SITE MON : END (DO NOT DELETE) --> 
  <!-- HEADER_SCRIPTS_AND_CSS_INCLUDE --> 
  <!-- <script src="//cdn.optimizely.com/js/5399420604.js"></script> --> 
  <!-- BEGIN: Use this section to set page specific variables for the Page Tag --> 
  <script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=-&ibmCmaId=1027836&ibmContentAreas=security";</script> 
  <!--END --> 
  <script src="//1.www.s81c.com/common/stats/ida_stats.js"></script> 
  <link href="//1.www.s81c.com/common/v18/css/www.css" rel="stylesheet"> 
  <link href="//1.www.s81c.com/common/v18/css/syntaxhighlighter.css" rel="stylesheet"> 
  <script src="//1.www.s81c.com/common/v18/js/www.js"></script> 
  <script src="//1.www.s81c.com/common/v18/js/syntaxhighlighter.js"></script> 
  <link href="//1.www.s81c.com/common/v18/css/tables.css" rel="stylesheet"> 
  <script src="//1.www.s81c.com/common/v18/js/tables.js"></script> 
  <!--  Masthead/footer  --> 
  <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/dw-mf-v18.css?v=092117" rel="stylesheet"> 
  <!-- <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/alt-signedin-ux.css" rel="stylesheet" /> --> 
  <!--[if lt IE 9]>
    <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/dw-mf-ie8fix.css?v=022216" rel="stylesheet" />
<![endif]--> 
  <link href="//dw1.s81c.com/developerworks/css/v18/dw-article.css?v=073117" rel="stylesheet"> 
  <script src="//dw1.s81c.com/developerworks/js/v18/dw-auth-properties.js?v=041017"></script> 
  <script src="//dw1.s81c.com/developerworks/js/v18/dw-auth.js?v=062717"></script> 
  <script src="//dw1.s81c.com/developerworks/js/dw-mf/v18/dw-mf.js?v=110316"></script> 
  <script src="//dw1.s81c.com/developerworks/js/v18/dw-include.js"></script> 
  <script src="//dw1.s81c.com/developerworks/js/v18/dw-article.js?v=051817"></script> 
  <script src="//dw1.s81c.com/developerworks/js/v18/dw-auto-links.js?v=091217"></script> 
  <script src="//www.ibm.com/software/info/js/tactic.js"></script> 
  <script src="//www.ibm.com/software/info/js/tacticbindlinks.js"></script> 
  <!-- Segment --> 
  <script src="//console.ng.bluemix.net/analytics/build/bluemix-analytics.min.js"></script> 
  <!-- 
<PageMap>
    <DataObject type="document">
        <Attribute name="topic">Bluemix</Attribute>
        <Attribute name="topicId">1237</Attribute>
        <Attribute name="contentArea">security</Attribute>
        <Attribute name="contentAreaId">16</Attribute>
        <Attribute name="abstract">Some attacks rely on creating a large number of disposable accounts
            automatically. In this article, you learn how to use the Google reCAPTCHA
            service to require human intervention to ensure that there is a human in the
            loop.</Attribute>
        <Attribute name="pub.date">2016-03-03</Attribute>
        <Attribute name="contentType">article</Attribute>
    </DataObject>
</PageMap>
--> 
 </head> 
 <body id="ibm-com" class="ibm-type dw-js-disabled"> 
  <div id="ibm-top" class="ibm-landing-page"> 
   <!-- MASTHEAD_BEGIN --> 
   <div id="ibm-masthead" role="banner" aria-label="IBM"> 
    <div id="ibm-mast-options"> 
     <ul role="toolbar" aria-labelledby="ibm-masthead"> 
      <li id="ibm-geo" role="presentation"><a href="http://www.ibm.com/planetwide/select/selector.html" role="button" aria-label="United States selected - Choose a country">United States</a></li> 
     </ul> 
    </div> 
    <div id="ibm-universal-nav"> 
     <nav role="navigation" aria-label="IBM"> 
      <div id="ibm-home">
       <a href="http://www.ibm.com/us/en/">IBM®</a>
      </div> 
      <ul id="ibm-menu-links" role="toolbar" aria-label="Site map"> 
       <li><a href="http://www.ibm.com/sitemap/us/en/">Site map</a></li> 
      </ul> 
     </nav> 
     <div id="ibm-search-module" role="search" aria-labelledby="ibm-masthead"> 
      <form id="ibm-search-form" action="https://www.ibm.com/Search/" method="get"> 
       <p> <label for="q">IBM</label> <input type="text" maxlength="100" value="" placeholder="Search" name="q" id="q" aria-label="Search developerWorks"> <input type="hidden" value="18" name="v"> <input type="hidden" value="utf" name="en"> <input type="hidden" value="en" name="lang"> <input type="hidden" value="us" name="cc"> <input type="hidden" name="sn" value="dw"> <input type="hidden" name="dws" value="dw"> <input type="hidden" name="hpp" value="20"> <input type="submit" id="ibm-search" class="ibm-btn-search" value="Submit"> </p> 
      </form> 
     </div> 
    </div> 
   </div>
   <!-- MASTHEAD_END --> 
   <!-- LAYOUT --> 
   <div id="ibm-content-wrapper"> 
    <!-- LEADSPACE_BEGIN --> 
    <header role="banner" aria-labelledby="ibm-pagetitle-h1"> 
     <!-- MASTHEAD_SITENAV_BEGIN --> 
     <div class="ibm-sitenav-menu-container"> 
      <div class="ibm-sitenav-menu-name"> 
       <a href="//www.ibm.com/developerworks/"> <img width="186" height="24" alt="developerWorks®" src="//dw1.s81c.com/developerworks/i/mf/dw-mf-wordmark.svg"> </a> 
      </div> 
      <div class="ibm-sitenav-menu-list"> 
       <ul role="menubar"> 
        <li class="dw-navpage-learn ibm-haschildlist" role="presentation"> <span role="menuitem"><a href="//www.ibm.com/developerworks/learn/">Learn</a></span> 
         <ul role="menu" aria-label="Learn" id="dw-mega-learn"> 
          <li role="presentation"> 
           <div class="ibm-columns"> 
            <div class="ibm-col-5-3 dw-mega-main"> 
             <h2>Learn with our tutorials and training</h2> 
             <p class="dw-mega-main-p">developerWorks provides tutorials, articles and other technical resources to help you grow your development skills on a wide variety of topics and products. Learn about a specific product or take a course and get certified. So, what do you want to learn about?</p> 
             <p class="ibm-button-link"> <a href="//www.ibm.com/developerworks/learn/" class="ibm-btn-pri">Choose a topic</a> </p> 
            </div> 
            <div class="ibm-col-5-1 dw-mega-nav"> 
             <h3>Featured topics</h3> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-mobile.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//www.ibm.com/developerworks/learn/mobile">Mobile development</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-bigdata.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//www.ibm.com/developerworks/learn/analytics">Big data</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-cognitive.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//www.ibm.com/developerworks/learn/cognitive">Cognitive computing</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-cloud.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//www.ibm.com/developerworks/learn/cloud">Cloud</a> 
              </div> 
             </div> 
            </div> 
            <div class="ibm-col-5-1 dw-mega-nav"> 
             <h3>Featured destinations</h3> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-swift.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/swift/?lnk=hm">Swift @ IBM</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-open.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/open/?lnk=hm">developerWorks Open</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-arch.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/architecture/?lnk=hm">Architecture center</a> 
              </div> 
             </div> 
            </div> 
           </div> </li> 
         </ul> </li> 
        <li role="presentation" class="dw-navpage-develop ibm-haschildlist"> <span role="menuitem"><a href="//www.ibm.com/developerworks/develop/">Develop</a></span> 
         <ul role="menu" aria-label="Develop" id="dw-mega-develop"> 
          <li role="presentation"> 
           <div class="ibm-columns"> 
            <div class="ibm-col-5-3 dw-mega-main"> 
             <h2>Develop with our trials &amp; downloads</h2> 
             <p class="dw-mega-main-p">Start developing with product trials, free downloads, and IBM Bluemix services. Sort by topic or product name and find everything we have to offer.</p> 
             <p class="ibm-button-link"> <a href="//www.ibm.com/developerworks/develop/" class="ibm-btn-pri">View all downloads &amp; trials</a> </p> 
            </div> 
            <div class="ibm-col-5-1 dw-mega-nav"> 
             <h3>Featured products</h3> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-bluemix.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/sso/bmregistration">Bluemix</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-websphere.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//www.ibm.com/developerworks/downloads/ws/was/">WebSphere Application Server</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-db2express.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//www.ibm.com/developerworks/downloads/im/db2express/">DB2 Express C</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-mobile.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//mobilefirstplatform.ibmcloud.com/">MobileFirst Platform Foundation</a> 
              </div> 
             </div> 
            </div> 
            <div class="ibm-col-5-1 dw-mega-nav"> 
             <h3>Featured destinations</h3> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-swift.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/swift/?lnk=hm">Swift @ IBM</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-open.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/open/?lnk=hm">developerWorks Open</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-arch.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/architecture/?lnk=hm">Architecture center</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-api-dest.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/api/">API Explorer</a> 
              </div> 
             </div> 
            </div> 
           </div> </li> 
         </ul> </li> 
        <li role="presentation" class="dw-navpage-connect ibm-haschildlist"> <span role="menuitem"><a href="//www.ibm.com/developerworks/connect/">Connect</a></span> 
         <ul role="menu" aria-label="Connect" id="dw-mega-connect"> 
          <li role="presentation"> 
           <div class="ibm-columns"> 
            <div class="ibm-col-5-3 dw-mega-main"> 
             <h2>Find a community and connect</h2> 
             <p class="dw-mega-main-p">Learn from the experts and share with other developers in one of our dev centers. Ask questions and get answers with dW answers. Search for local events in your area. All in developerWorks communities.</p> 
             <p class="ibm-button-link"> <a href="//www.ibm.com/developerworks/connect/" class="ibm-btn-pri">View communities</a> </p> 
            </div> 
            <div class="ibm-col-5-1 dw-mega-nav"> 
             <h3>Featured Developer Centers</h3> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-jazz-dev.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//jazz.net/">Jazz.net</a> 
              </div> 
             </div> 
             <!--<div class="dw-mega-nav-item">
                                        <div class="dw-mega-nav-img">
                                            <img width="30" height="30" alt=""
                                                src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-cloud-dev.png">
                                        </div>
                                        <div class="dw-mega-nav-link">
                                            <a href="//developer.ibm.com/cloud-analytics/">IBM Cloud Analytics DEV</a>
                                        </div>
                                    </div>--> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-bluemix-dev.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/bluemix/">Bluemix</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-api-dev.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/api/">API Explorer</a> 
              </div> 
             </div> 
            </div> 
            <div class="ibm-col-5-1 dw-mega-nav"> 
             <h3>Featured destinations</h3> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-swift.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/swift/?lnk=hm">Swift @ IBM</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-open.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/open/?lnk=hm">developerWorks Open</a> 
              </div> 
             </div> 
             <div class="dw-mega-nav-item"> 
              <div class="dw-mega-nav-img"> 
               <img width="30" height="30" alt="" src="//dw1.s81c.com/developerworks/i/v18/mega/dw-mplist-arch.png"> 
              </div> 
              <div class="dw-mega-nav-link"> 
               <a href="//developer.ibm.com/architecture/?lnk=hm">Architecture center</a> 
              </div> 
             </div> 
            </div> 
           </div> </li> 
         </ul> </li> 
        <!-- dW featured --> 
        <!-- <li role="presentation" class="dw-navpage-devcenter"><strong>Subheading</strong></li> --> 
        <li role="presentation" class="dw-navpage-devcenter"><a role="menuitem" href="//www.ibm.com/developerworks/learn/cognitive/">Cognitive</a></li> 
        <li role="presentation" class="dw-navpage-devcenter"><a role="menuitem" href="//www.ibm.com/developerworks/learn/cloud/">Cloud</a></li> 
        <li role="presentation" class="dw-navpage-devcenter"><a role="menuitem" href="//www.ibm.com/developerworks/learn/analytics/">Data</a></li> 
        <li role="presentation" class="dw-navpage-devcenter"><a role="menuitem" href="//www.ibm.com/developerworks/learn/iot/">Internet of Things</a></li> 
        <li role="presentation" class="dw-navpage-devcenter"><a role="menuitem" href="//www.ibm.com/developerworks/learn/java/">Java</a></li> 
        <li role="presentation" class="dw-navpage-devcenter"><a role="menuitem" href="//www.ibm.com/developerworks/learn/">All topics</a></li> 
       </ul> 
      </div> 
     </div> 
     <!-- MASTHEAD_SITENAV_END --> 
     <!-- NAVIGATION_TRAIL_BEGIN --> 
     <div id="ibm-leadspace-head" class="ibm-alternate"> 
      <div id="ibm-leadspace-body"> 
       <nav aria-label="Breadcrumb" role="navigation"> 
        <ul id="dw-navigation-trail" itemscope itemtype="http://schema.org/BreadcrumbList">
         <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" href="http://www.ibm.com/developerworks/learn/"><span itemprop="name">Learn</span></a>
          <meta itemprop="position" content="1"></li>
         <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a itemprop="item" href="http://www.ibm.com/developerworks/security/"><span itemprop="name">Security</span></a>
          <meta itemprop="position" content="2"></li>
        </ul> 
       </nav> 
      </div> 
     </div> 
     <!-- NAVIGATION_TRAIL_END --> 
    </header> 
    <!-- LEADSPACE_END --> 
    <!-- MAIN_CONTENT_BEGIN --> 
    <main role="main" aria-labelledby="ibm-pagetitle-h1"> 
     <div id="ibm-pcon"> 
      <!-- BEGIN_IBM-CONTENT --> 
      <div id="ibm-content"> 
       <!-- BEGIN_IBM-CONTENT-BODY --> 
       <div id="ibm-content-body"> 
        <!-- BEGIN_IBM-CONTENT-MAIN --> 
        <div id="ibm-content-main" class="dw-article"> 
         <!-- BEGIN_INTERIOR-COLUMNS --> 
         <div class="ibm-columns dw-article-toc"> 
          <!-- LEFT_6_2_CONTENT_COLUMN_BEGIN --> 
          <div id="dw-article-toc-container" class="ibm-col-6-2"> 
           <div id="dw-article-toc-body"> 
            <h2>Contents</h2>
            <div class="ibm-alternate-rule">
             <hr>
            </div>
            <ul role="directory" aria-label="Table of contents" class="ibm-plain-list">
             <li><a href="#ibm-pagetitle-h1">Introduction</a></li>
             <li><a href="#12Whatyoullneedtobuildyourapplicationoutline">What you'll need to build your application</a></li>
             <li><a href="#13WhyusereCAPTCHAoutline">Why use reCAPTCHA?</a></li>
             <li><a href="#14HowtousereCAPTCHAoutline">How to use reCAPTCHA</a></li>
             <li><a href="#15CombinereCAPTCHAwiththeBluemixsinglesign-onserviceoutline">Combine reCAPTCHA with the Bluemix single sign-on service</a></li>
             <li><a href="#16Conclusionoutline">Conclusion</a></li>
             <li><a href="#artdownload">Downloadable resources</a></li>
             <li><a href="#artrelatedtopics">Related topics</a></li>
             <li><a href="#icomments">Comments</a></li>
            </ul> 
           </div> 
          </div> 
          <!-- LEFT_6_2_CONTENT_COLUMN_END --> 
          <!-- CENTER_6_4_CONTENT_COLUMN_BEGIN --> 
          <div class="ibm-col-6-4"> 
           <h1 id="ibm-pagetitle-h1" class="ibm-h1">Add Google reCAPTCHA to your Bluemix Node.js application</h1>
           <p class="dw-article-subhead">Ensure humans are in the loop and avoid denial of service attacks</p> 
           <!-- Article Top Bar --> 
           <div class="ibm-columns dw-article-topbar"> 
            <!-- Author and article info. --> 
            <div class="ibm-col-6-2 ibm-col-medium-6-4 dw-article-metadata"> 
             <div class="dw-article-avatar">
              <img width="42" height="42" src="//www.ibm.com/developerworks/i/p-opomerantz60.jpg" alt="Photo of Ori Pomerantz">
             </div>
             <div class="dw-article-authordate">
              <span class="dw-article-author"><a href="https://plus.google.com/104255303979859623360/about">Ori Pomerantz</a></span>
              <br>
              <span class="dw-article-pubdate">Published on March 03, 2016</span>
             </div> 
            </div> 
            <!-- Social --> 
            <div class="ibm-col-6-2 ibm-col-medium-6-4 ibm-col-small-6-2 dw-article-social"> 
             <!-- Sharing links --> 
             <div id="dw-article-share-inline"> 
              <div class="dw-article-sharelink-inline"> 
               <div class="ibm-sharethispage"></div> 
              </div> 
             </div> 
             <!-- Number of comments and link to comments --> 
             <div id="dw-article-cmts"> 
              <div class="dw-article-cmtslink"> 
               <a onclick="tocLink('#icomments')" href="#icomments" role="link" tabindex="0" aria-label="Comments"> <img src="//dw1.s81c.com/developerworks/i/v18/article/dw-article-cmt-icon.png" width="29" height="29" alt="Comments"> </a> 
              </div> 
              <div class="dw-article-cmtslink"> 
               <a onclick="tocLink('#icomments')" href="#icomments" role="link" tabindex="0"> 
                <div id="nCmts"></div> </a> 
              </div> 
             </div> 
            </div> 
           </div> 
           <!-- Article Body --> 
           <div itemscope="video" itemtype="http://schema.org/VideoObject">
            <meta itemprop="thumbnailURL" content="csp0553-thumnail-940x330.png">
            <meta itemprop="description" content="For more in-depth information about the subject, watch this video: Add Google reCAPTCHA to your Bluemix Node.js
                    application.">
            <meta itemprop="name" content="Add Google reCAPTCHA to your Bluemix Node.js application">
            <meta itemprop="contentURL" content="https://www.youtube.com/watch?v=n_g3LRURfu0">
            <meta itemprop="uploadDate" content="2016-03-03">
            <meta itemprop="duration" content="PTvideo_length_placeholder_minutesMvideo_length_placeholder_secondsS">
            <div data-widget="videoplayer" data-videodisplay="inline" data-videoid="n_g3LRURfu0" data-videotype="youtube" data-customplaceholder="true" data-showvideotitle="true" data-titledisplaytype="overlay" data-videotitleoverride="Add Google reCAPTCHA to your Bluemix Node.js application" data-showimageplaybutton="true">
             <a href="https://www.youtube.com/watch?v=n_g3LRURfu0"><img class="ibm-resize" src="csp0553-thumnail-940x330.png" height="330" width="940"></a>
            </div>
            <div class="dw-article-video-transcript">
             <a href="transcript.txt">Transcript</a>
            </div>
           </div> 
           <p>In this article, you learn how to access the Google reCAPTCHA service from your Bluemix® Node.js application. Doing so allows you to ensure that the user of the application is human and not just an automated system. This requirement prevents many attacks that rely on sending numerous requests from such a system.</p>
           <h2 id="12Whatyoullneedtobuildyourapplicationoutline" class="ibm-h2">What you'll need to build your application</h2>
           <div class="dw-article-sidebar ibm-background-cool-white-20">
            <h5>Learn more. Develop more. Connect more.</h5>
            <p> Subscribe to <a href="https://www.ibm.com/marketplace/cloud/developer-program/us/en-us?cm_sp=dwpremium-_-se-use-active-directory-authentication-authorization-node.js-bluemix-application-_-article">developerWorks Premium</a> to read "Web Security," "Web Development with MongoDB and Node.js," and "Write Modern Web Apps with the MEAN Stack: Mongo, Express, AngularJS, and Node.js" from our custom Safari Books Online library.</p>
           </div>
           <ul class="ibm-bullet-list">
            <li>A Bluemix account (Register for your <a href="http://www.bluemix.net">free trial account</a> or <a href="http://www.bluemix.net" class="bluemix-home">log in to Bluemix</a> if you already have an account).</li>
            <li>A Facebook account.</li>
            <li>A Google account.</li>
            <li>Knowledge of HTML and JavaScript.</li>
            <li>Knowledge of the MEAN application stack (at least Node.js and Express). (If you are not familiar with MEAN, you can get started with "<a href="http://www.ibm.com/developerworks/library/?sort_by=&amp;show_abstract=true&amp;show_all=&amp;search_flag=&amp;contentarea_by=All+Zones&amp;search_by=Build+a+self-posting+Facebook+app&amp;product_by=-1&amp;topic_by=-1&amp;industry_by=-1&amp;type_by=All+Types&amp;ibm-search=Search">Build a self-posting Facebook application with Bluemix and the MEAN stack</a>," a three-part article on IBM developerWorks®.)</li>
            <li>A development environment that can upload a Node.js application to Bluemix, such as <a href="http://www.eclipse.org/">Eclipse.</a></li>
           </ul>
           <p class="ibm-btn-row ibm-padding-bottom-r1"><a href="http://recaptcha.mybluemix.net/" class="ibm-btn-pri dw-article-btn-pri">Run the app</a><a href="https://hub.jazz.net/project/cspowers/recaptcha/overview" class="ibm-btn-sec dw-article-btn-sec">Get the code</a></p>
           <div class="ibm-pull-quote ibm-h3">
            <blockquote>
             <p><em class="dw-pullquote"><span class="dw-pullquote-open"></span>Some attacks use automated systems to generate large numbers of requests. In this article, you learn how to use the Google reCAPTCHA service to ensure there is a human in the loop.<span class="dw-pullquote-close"></span></em></p>
            </blockquote>
           </div>
           <h2 id="13WhyusereCAPTCHAoutline" class="ibm-h2">Why use reCAPTCHA?</h2>
           <p>There are a number of attacks that rely on getting the targeted system to respond to a large number of requests. Writing a program to issue such requests is relatively simple and cheap. However, with reCAPTCHA (or any other CAPTCHA variant), requests have to include the solution for a problem that is very easy for humans, but very difficult for computers. This turns automated attacks that are very cheap into attacks that require a large amount of boring, expensive, human interaction.</p>
           <h3 id="1.3.1.Spam|outline" class="ibm-h3">Spam</h3>
           <p>Any service that allows users to interact with each other can be used to send annoying advertising, also known as spam. Most administrators respond to accusations of spamming by deleting the offending account. From the spammer's perspective, one solution is to create a huge number of disposable accounts.</p>
           <p>If account registration requires human interaction, however, creating those disposable accounts is a lot harder and more expensive. This typically leads spammers to look for easier victims.</p>
           <h3 id="1.3.2.Denialofserviceattacks|outline" class="ibm-h3">Denial of service attacks</h3>
           <p>Denial of service attacks can be petty vandalism. They can also be part of a more serious attack, when used to force people to achieve their work through a different system that is less secure. Most denial of service attacks are based on simply sending out a huge number of requests and overwhelming the system. This is unlikely to happen with Bluemix's infrastructure, but a large number of requests could increase the cost of the application.</p>
           <p>But if making a request requires a human being, sending a huge number of nonsense requests is no longer economically feasible.</p>
           <h3 id="1.3.3.Passwordenumeration|outline" class="ibm-h3">Password enumeration</h3>
           <p>One way to break passwords is to try all possible values in order of likelihood (start with dictionary words, continue with dictionary words that have "o" replaced by zero, and so on). A common solution is to block further attempts after a number of wrong passwords are entered, but this gives attackers an easy denial of service attack against accounts. They can always get accounts locked by entering a small number of passwords.</p>
           <p>By requiring a human in the loop, either immediately or after a certain number of failed password attempts, you make password enumeration too cumbersome to be worth doing.</p>
           <h2 id="14HowtousereCAPTCHAoutline" class="ibm-h2">How to use reCAPTCHA</h2>
           <p>To use reCAPTCHA, you need to activate it on Google's website and then modify your program to call it.</p>
           <h3 id="1.4.1.ConfigurationontheGoogleside|outline" class="ibm-h3">Configuration on the Google side</h3>
           <p>Register your application with Google's reCAPTCHA service at <a href="https://www.google.com/recaptcha/admin#list">https://www.google.com/recaptcha/admin#list</a>. To avoid problems, register your full domain name. For example, for my application I registered <code>recaptcha.mybluemix.net</code>.</p>
           <p>Google provides you with two keys: a site key to use in your HTML, and a that is used for your application on the server to communicate with Google.</p>
           <h3 id="1.4.2.Configurationontheclientside|outline" class="ibm-h3">Configuration on the client side</h3>
           <p>To show the user the reCAPTCHA prompt within a form, follow these steps:</p>
           <ol type="1">
            <li>Somewhere in the HEAD tag of the HTML, call the Google reCAPTCHA script.<span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">&lt;script src='https://www.google.com/recaptcha/api.js'&gt;&lt;/script&gt;</pre></span></li>
            <li>Identify the form to protect, the one that should be submitted only by humans. Add the definition below at the bottom of that form by using the site key you got from Google.</li>
           </ol>
           <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">	&lt;div class="g-recaptcha" data-sitekey="--- your site key goes here --"&gt;&lt;/div&gt;</pre></span>
           <p>To see an example, go to <a href="http://recaptcha.mybluemix.net/index.html">http://recaptcha.mybluemix.net/index.html</a> and view the source.</p>
           <h3 id="1.4.3.Configurationontheserverside|outline" class="ibm-h3">Configuration on the server side</h3>
           <p>To use reCAPTCHA, follow these steps to modify the application running on the server (app.js): </p>
           <ol type="1">
            <li>Add the body-parser and https packages to package.json as dependencies. You need the first to read the results of a POST form, and the second to send a request to Google's servers to interpret the result.</li>
            <li>Add the following lines to apply the body parser package:<span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">// Use body-parser to receive POST form requests and JSON
var bodyParser = require("body-parser");
app.use(bodyParser.urlencoded({extended:true}));</pre></span></li>
            <li>Add code that sends an HTTPS request to Google, as explained in the article "<a href="http://www.ibm.com/developerworks/library/se-manage-security-alerts-ibm-devops-trackplan/index.html">Manage security alerts with IBM DevOps Track &amp; Plan</a>."
             <ol class="ibm-alpha-list" type="a">
              <li>Create a variable to use the HTTPS package.</li>
              <li>Issue a request to Google's servers in the handler for the form. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">		// An attempt to log on
		app.post("/login", function(req, res) {
		.
		.
		.
		
		  var httpsReq = https.request(  &lt;&lt;URL goes here &gt;&gt;,
			function(httpsRes) {
		.
		.
		.
		
		  });
		 
		  httpsReq.on("error", function(err) {
		  	res.send("Error: " + JSON.stringify(err));
		  });
		  
		  httpsReq.end();
		});</pre></span></li>
             </ol></li>
            <li>When sending the request, add two query parameters to the URL: <code>secret</code>, which contains the secret key, and <code>response</code>, which contains the value returned by the reCAPTCHA code in the browser. That value is provided in the body for a POST. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">	  var httpsReq = https.request("https://www.google.com/recaptcha/api/siteverify" +
	  	"?secret=&lt;&lt;your secret goes here&gt;&gt;" +
		"&amp;response=" + req.body["g-recaptcha-response"],</pre></span></li>
            <li>The response might come in multiple chunks, so you need to gather them until the response is done. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">var googleResponse = "";
	.
	.
	.
	  	httpsRes.on("data", function (chunk) {
			googleResponse += chunk;
  		});</pre></span></li>
            <li>The response is a JSON object. You can use <code>JSON.parse()</code> to parse it. The parameter that tells you if the user is known to be human is <code>success</code>. It is a Boolean. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">		httpsRes.on("end", function() {
		  var human = JSON.parse(googleResponse).success;
		  res.send(human);
		 });</pre></span></li>
           </ol>
           <p>To check that the reCAPTCHA service works as expected, submit once and see that the result is true. Then wait a few seconds and reload, confirming the form resubmission. Reusing the <code>g-recaptcha-response</code> value is something that happens when requests come from an automated system. A programmer trying to attack the application could manually create a valid value once, and then program the attack to send that value automatically with every submission. To prevent such an attack, the response from Google to a previously used value is false.</p>
           <h2 id="15CombinereCAPTCHAwiththeBluemixsinglesign-onserviceoutline" class="ibm-h2">Combine reCAPTCHA with the Bluemix single sign-on service</h2>
           <p>Bluemix has a single sign-on service. For a specific application, we might want to use this service, but we do not trust all identity sources equally. We are afraid that some identity sources are susceptible to automated attacks, and therefore we want to require a reCAPTCHA when they are used. But we do not want to do it for the identity sources we trust.</p>
           <h3 id="1.5.1.Configurethesinglesign-onservice|outline" class="ibm-h3">Configure the single sign-on service</h3>
           <p>These are the steps to configure the single sign-on service:</p>
           <ol type="1">
            <li>In the Bluemix dashboard, click <strong>USE SERVICES OR APIS</strong>.</li>
            <li>Select <strong>Security &gt; Single Sign On</strong>.</li>
            <li>Click <strong>CREATE</strong>.</li>
            <li>Specify a name. For my application, I chose <code>recaptcha-sso</code>.</li>
            <li>If you get an error, ignore it. Just go back to the dashboard and click on the service.</li>
            <li>Click <strong>SETUP</strong>.</li>
            <li>You are presented with a list of identity sources. For the purposes of this article, configure two of them: Facebook and Google+.</li>
           </ol>
           <h4 id="1.5.1.1.Facebook|outline" class="ibm-h4">Facebook</h4>
           <ol start="8" type="1">
            <li>Click the Facebook tile.</li>
            <li>Copy the OAUTH redirect URI. It looks similar to:<br><code>https://recaptcha-sso-aj5bgntzl9-ck11.iam.ibmcloud.com/idaas/mtfim/sps/idaas/login/facebook/callback</code></li>
            <li>Log in to Facebook.</li>
            <li>Go to the <a href="https://developers.facebook.com/">Facebook developer page</a> and click <strong>My Apps &gt; Add a New App</strong>.</li>
            <li>Click <strong>Website</strong>.</li>
            <li>Name the application and click <strong>Create New Facebook App ID</strong>.</li>
            <li>Select a category and click <strong>Create App ID</strong>.</li>
            <li>Click <strong>Skip Quickstart</strong>.</li>
            <li>Click <strong>Settings</strong>.</li>
            <li>Click <strong>Add Platform</strong>.</li>
            <li>Click <strong>Website</strong>.</li>
            <li>Type the URL for your application.<img src="app_id.png" class="ibm-downsize" alt="Screen capture showing app URL" height="437" width="641"><p class="ibm-ind-link"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show('N101BC');return false;" href="#N101BC">View image at full size</a></p>
             <div class="ibm-common-overlay ibm-overlay-alt-three" data-widget="overlay" id="N101BC">
              <img alt="Screen capture showing app URL" src="app_id.png" width="641">
             </div></li>
            <li>Click the <strong>Advanced</strong> tab.</li>
            <li>Paste the OAUTH redirect URI in the Valid OAuth redirect URIs field.</li>
            <li>Click <strong>Save Changes</strong>.</li>
            <li>Click the <strong>Basic</strong> tab.</li>
            <li>Copy the App ID and App Secret from Facebook into Bluemix. You will need to click <strong>Show</strong> to see the app secret.</li>
            <li>Click <strong>Save</strong>.</li>
            <li>Click <strong>Verify</strong> and then <strong>Click here</strong>.</li>
            <li>In Facebook, click <strong>Okay</strong>.</li>
            <li>When you see a message that the login was successful, return to Bluemix and click <strong>Done</strong>.</li>
           </ol>
           <h4 id="1.5.1.2.Google+|outline" class="ibm-h4">Google +</h4>
           <ol start="29" type="1">
            <li>Click the Google + tile.</li>
            <li>Copy the OAUTH redirect URI. It looks similar to:<br><code>https://recaptcha-sso-aj5bgntzl9-ck11.iam.ibmcloud.com/idaas/mtfim/sps/idaas/login/google/callback</code></li>
            <li>Click <strong>Click here</strong>. You are redirected to the <a href="https://console.developers.google.com/home/dashboard">Google Developers Console</a>.</li>
            <li>In the Google Developers Console, click <strong>Enable and manage APIs</strong>. <img src="google_console.png" class="ibm-downsize" alt="Screen capture showing Google console" height="398" width="629"><p class="ibm-ind-link"><a class="ibm-popup-link" onclick="IBMCore.common.widget.overlay.show('N1020D');return false;" href="#N1020D">View image at full size</a></p>
             <div class="ibm-common-overlay ibm-overlay-alt-three" data-widget="overlay" id="N1020D">
              <img alt="Screen capture showing Google console" src="google_console.png" width="629">
             </div></li>
            <li>Click <strong>Google+ API</strong>.</li>
            <li>Click <strong>Enable API</strong>.</li>
            <li>Click <strong>Go to Credentials</strong>.</li>
            <li>Select to call the API from a <strong>Web server</strong>.</li>
            <li>Select <strong>User data</strong> and click <strong>What credentials do I need?</strong>.</li>
            <li>Type the authorized redirect URI you got, and click <strong>Create client ID</strong>.</li>
            <li>Type a name for your application and click <strong>Continue</strong>.</li>
            <li>Download client_id.json. Copy the client ID and client secret and paste them into Bluemix.</li>
            <li>Click <strong>Save</strong>.</li>
           </ol>
           <h3 id="1.5.2.Usetheidentityserviceintheapplication|outline" class="ibm-h3">Use the identity service in the application</h3>
           <p>To use the identity service, follow these steps:</p>
           <ol type="1">
            <li>Return to your application.</li>
            <li>Click the <strong>BIND A SERVICE OR API</strong> tile.</li>
            <li>Select the single sign-on service and click <strong>ADD</strong>.</li>
            <li>Click <strong>Restage</strong>.</li>
            <li>Open the service again, and click the new <strong>INTEGRATE</strong> tab.</li>
            <li>Type a callback URL. The URL for your application followed by <code>/sso</code> is a reasonable choice.<br><code>https://recaptcha.mybluemix.net/sso</code></li>
            <li>Click <strong>Save</strong> and then <strong>OK</strong>.</li>
            <li>In package.json, add these dependencies: <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">"dependencies": {
    .
    .
    .
    "passport": "*",
    "cookie-parser": "*",
    "express-session": "*",
	    "passport-idaas-openidconnect": "*"
	}</pre></span></li>
            <li>Add these lines to app.js, after the code that defined the app and appEnv variables: <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">var passport = require('passport');
var cookieParser = require('cookie-parser');
var session = require('express-session');

app.use(cookieParser());
app.use(session({resave: 'true', saveUninitialized: 'true' , secret: 'keyboard cat'}));
app.use(passport.initialize());
app.use(passport.session());

passport.serializeUser(function(user, done) {
   done(null, user);
});

passport.deserializeUser(function(obj, done) {
   done(null, obj);
});         

// VCAP_SERVICES contains all the credentials of services bound to
// this application. For details of its content, please refer to
// the document or sample of each service.  
var services = JSON.parse(process.env.VCAP_SERVICES || "{}");
var ssoConfig = services.SingleSignOn[0];
var client_id = ssoConfig.credentials.clientId;
var client_secret = ssoConfig.credentials.secret;
var authorization_url = ssoConfig.credentials.authorizationEndpointUrl;
var token_url = ssoConfig.credentials.tokenEndpointUrl;
var issuer_id = ssoConfig.credentials.issuerIdentifier;
var callback_url = appEnv.url + "/sso";        

var OpenIDConnectStrategy = require('passport-idaas-openidconnect').IDaaSOIDCStrategy;
var Strategy = new OpenIDConnectStrategy({
                 authorizationURL : authorization_url,
                 tokenURL : token_url,
                 clientID : client_id,
                 scope: 'openid',
                 response_type: 'code',
                 clientSecret : client_secret,
                 callbackURL : callback_url,
                 skipUserProfile: true,
                 issuer: issuer_id},
	function(iss, sub, profile, accessToken, refreshToken, params, done)  {
	         	process.nextTick(function() {
		profile.accessToken = accessToken;
		profile.refreshToken = refreshToken;
		done(null, profile);
         	})
});

passport.use(Strategy);
app.get('/sso-login', passport.authenticate('openidconnect', {}));</pre></span></li>
            <li>Add the code to require authentication using the <code>ensureAuthenticated()</code> function as middleware. In this application, I chose to put all the URLs that require authentication under <code>/auth</code>. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">function ensureAuthenticated(req, res, next) {
	if(!req.isAuthenticated()) {
	          	req.session.originalUrl = req.originalUrl;
		res.redirect('/sso-login');
	} else {
		return next();
	}
}

app.use("/auth/*", ensureAuthenticated);</pre></span></li>
            <li>Run the application.</li>
            <li>Try to access an authenticated path such as <code>/auth/test</code> to log in. Notice that you can log in, but then you are redirected to <code>/sso</code> on your application, which does not have a handler yet.</li>
           </ol>
           <h3 id="1.5.3.Readidentityattributes|outline" class="ibm-h3">Read identity attributes</h3>
           <ol type="1">
            <li>Create a handler for <code>/sso</code>. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">app.get('/sso',function(req,res,next) {               
             var redirect_url = req.session.originalUrl;                
             passport.authenticate('openidconnect', {
                     successRedirect: redirect_url,                                
                     failureRedirect: '/failure',                        
          })(req,res,next);
        });</pre></span></li>
            <li>Create a handler for failure to log in. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">app.get('/failure', function(req, res) {
             res.send('login failed');
});</pre></span></li>
            <li>Create a path under <code>/auth</code> that displays the user information. Session information, such as the user identity, is available at req.session. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">app.get('/auth/whoami', function(req, res) {
	res.send(JSON.stringify(req.session));
});</pre></span><br>To see the user information handler in the sample application, click <a href="https://recaptcha.mybluemix.net/auth/whoami">here</a>.<br><em>Note:</em> In a production application you would delete the <code>/auth/whoami</code> handler to avoid disclosing information. I kept it in the article's application for demonstration purposes. </li>
            <li>Use a JSON-to-HTML translator, such as <a href="http://json.bloople.net/">http://json.bloople.net/</a>, to interpret the result. These are the most important fields: 
             <ul class="ibm-bullet-list">
              <li><code>passport.user.id</code>: A unique user identifier</li>
              <li><code>passport.user._json.realmName</code>: The source of the user</li>
              <li><code>passport.user._json.displayName</code>: The user's name</li>
             </ul></li>
           </ol>
           <h3 id="1.5.4.SendthereCAPTCHAonlywhenrequired|outline" class="ibm-h3">Send the reCAPTCHA only when required</h3>
           <p>Finally, create a welcome page. I find it easiest to have pages that are mostly static and provide all the specific parameters in a separate JavaScript "file."</p>
           <ol type="1">
            <li>Modify the <code>ensureAuthenticated</code> handler to redirect to a different page if the user is authenticated, but the <code>realmName</code> is www.facebook.com (meaning that you require reCAPTCHA) and <code>recaptcha</code> is not true. The new lines are 6 through 10. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">function ensureAuthenticated(req, res, next) {
	if(!req.isAuthenticated()) {
	    req.session.originalUrl = req.originalUrl;
		res.redirect('/login-sso');
	} else {
		if ((req.session.passport.user._json.realmName === "www.facebook.com") &amp;&amp;
			!req.session.recaptcha) {
			res.session.orginalUrl = req.originalUrl;
			res.redirect("/get-recaptcha.html");			
		} else
			return next();
	}
}</pre></span></li>
            <li>Create a get-recaptcha.html file that asks only for a reCAPTCHA. In the reCAPTCHA div, use the <code>data-callback</code> attribute to call a function when Google decides the user is a human being. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">    &lt;form action="recaptcha-res" id="recap" role="form" method="post" class="form-inline"&gt;
		&lt;div class="g-recaptcha"
			data-sitekey="6LccjhcTAAAAAG-BsW-f0v9P91oWiin2sZHfxSaK"
			data-callback="verified"
		&gt;
		&lt;/div&gt;
    &lt;/form&gt;</pre></span><br>The called function submits the form, sending the reCAPTCHA result to the server.<span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">&lt;script&gt;
    var verified = function() {
	document.getElementById("recap").submit();
    };
&lt;/script&gt;</pre></span></li>
            <li>Create a handler for the reCAPTCHA result. This handler is very similar to the one shown earlier, except that it redirects to the original URL and sets a session variable so that reCAPTCHA won't be required again during this session. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">  		httpsRes.on("end", function() {
  			var human = JSON.parse(googleResponse).success;
  			if (human) {
  				// Set the reCAPTCHA value to true
  				req.session.recaptcha = true;
  				
  				// Redirect to where the user wanted to go
  				res.redirect(req.session.originalUrl);
  			}  				
  		});</pre></span></li>
           </ol>
           <h3 id="1.5.5.Servetheauthenticatedpartoftheapplication|outline" class="ibm-h3">Serve the authenticated part of the application</h3>
           <ol type="1">
            <li>Create in your application a new directory, for example <code>/auth</code>, for static files that require authentication.</li>
            <li>Add a line after the line that calls <code>ensureAuthenticated()</code> to serve the static files that require authentication. The new line is line 3. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">// Serve files that require authentication, only if authenticated
app.use("/auth/*", ensureAuthenticated);
app.use("/auth", express.static(__dirname + '/auth'));</pre></span></li>
            <li>Create a handler for /auth/session.js that returns the session data that might be useful in the browser. <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">app.get("/auth/session.js", function(req, res) {
	res.send("// User data\n" +
		"var displayName = '" + req.session.passport.user._json.displayName + "';\n" +
		"var realmName = '" + req.session.passport.user._json.realmName + "';\n"
	);
});</pre></span></li>
            <li>Use the script in your HTML files as needed. For example: <span class="dw-code-nohighlight"><pre data-widget="syntaxhighlighter" class="brush: js; html-script: true; gutter: true;">    &lt;script src="session.js"&gt;&lt;/script&gt;

    
	&lt;script&gt;
	var myApp = angular.module("myApp", []);
	var scope;
		

	myApp.controller("myCtrl", function($scope) {
		// Make the scope available outside the controller, which is very useful for
		// debugging
  		scope = $scope;
  		
  		// Provide the session parameters in the scope
  		$scope.displayName = displayName;
  		$scope.realmName = realmName;
  	});
    
    &lt;/script&gt;
    
  &lt;/head&gt;

  &lt;body&gt;
  
  	&lt;h2&gt;Hello {{displayName}}&lt;/h2&gt;
  	From {{realmName}}    

  &lt;/body&gt;</pre></span></li>
           </ol>
           <h2 id="16Conclusionoutline" class="ibm-h2">Conclusion</h2>
           <p>You should now be able to use reCAPTCHA in your Bluemix Node.js applications, with or without the Bluemix single sign-on service. Note that before releasing an application using the single sign-on service to production, you have to do a few more steps:</p>
           <ol type="1">
            <li>Change <code>keyboard cat</code> to a different string that would actually be secret.</li>
            <li>Require the use of HTTPS, as explained in Step 5 of "<a href="http://www.ibm.com/developerworks/web/library/se-bluemix-self-posting-app-mean-stack-part1/index.html">Build a self-posting Facebook application with Bluemix and the MEAN stack, Part 1</a>".</li>
            <li>Store session information somewhere better than memory, in case you have multiple instances that use them and to avoid memory leaks.</li>
           </ol>
           <!--CMA ID: 1027836-->
           <!--Site ID: 1-->
           <!--XSLT stylesheet used to transform this file: dw-document-html-8.0.xsl--> 
           <!-- Article Resources --> 
           <div class="ibm-alternate-rule">
            <hr>
           </div>
           <h4 id="artdownload" class="ibm-h4">Downloadable resources</h4>
           <ul class="ibm-link-list">
            <li><a class="ibm-pdf-link" href="se-add-google-recaptcha-bluemix-node.js-application-pdf.pdf">PDF of this content</a></li>
           </ul>
           <div class="ibm-alternate-rule">
            <hr>
           </div>
           <h4 id="artrelatedtopics" class="ibm-h4">Related topics</h4>
           <ul class="ibm-plain-list">
            <li><a href="http://www.ibm.com/developerworks/topics/sdk">The SDK for Node.js runtime </a></li>
            <li><a href="http://www.ibm.com/developerworks/topics/single sign on service">The Single Sign On service</a></li>
            <li><a href="https://www.google.com/recaptcha/intro/index.html">reCAPTCHA</a></li>
            <li><a href="https://developers.facebook.com/">Facebook developer page</a></li>
            <li><a href="https://console.developers.google.com/home/dashboard">Google Developers Console</a></li>
           </ul> 
           <!-- Commenting --> 
           <!-- INLINE_COMMENTS_BEGIN: --> 
           <div class="ibm-alternate-rule">
            <hr>
           </div> 
           <div id="dw-article-cmts-top" class="ibm-columns"> 
            <div class="ibm-col-6-2"> 
             <h4 id="icomments" class="ibm-h4">Comments</h4> 
             <div id="dw-article-cmts-login"> 
              <p><a onclick="window.location=userLinks[0].url;" tabindex="0" role="link">Sign in</a> or <a onclick="window.location=userLinks[1].url;" tabindex="0" role="link">register</a> to add and subscribe to comments.</p> 
             </div> 
            </div> 
            <div class="ibm-col-6-2" id="dw-notify"> 
             <input type="checkbox" value="1" name="comment_notification" id="comment_notification" disabled> 
             <label for="comment_notification">Subscribe me to comment notifications</label> 
            </div> 
           </div> 
           <div class="dw-article-cmts-container"> 
            <div class="ibm-no-print" id="dw-icomments-container"> 
            </div> 
           </div> 
           <!-- INLINE_COMMENTS_END --> 
           <!-- CENTER_6_4_CONTENT_COLUMN_END --> 
          </div> 
         </div> 
         <!--Rating_Meta_BEGIN-->
         <div class="metavalue">
          static.content.url=http://www.ibm.com/developerworks/js/artrating/
         </div>
         <div class="metavalue">
          SITE_ID=1
         </div>
         <div class="metavalue">
          Zone=Security
         </div>
         <div class="metavalue">
          ArticleID=1027836
         </div>
         <div class="metavalue">
          ArticleTitle=Add Google reCAPTCHA to your Bluemix Node.js application
         </div>
         <div class="metavalue">
          publish-date=03032016
         </div>
         <script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script>
         <!--Rating_Meta_END--> 
        </div> 
        <!-- END_IBM-CONTENT-MAIN --> 
       </div> 
       <!-- END_IBM-CONTENT-BODY --> 
      </div> 
      <!-- END_IBM-CONTENT --> 
     </div> 
     <!-- END_IBM-PCON --> 
    </main> 
    <!-- MAIN_CONTENT_END --> 
    <!-- END_CONTENT-WRAPPER --> 
   </div> 
   <!-- FOOTER_BEGIN --> 
   <footer role="contentinfo" aria-label="IBM developerWorks"> 
    <div id="dw-footer-module" class="dw-footer-home"> 
     <section aria-label="Resources" role="contentinfo"> 
      <div class="ibm-columns"> 
       <div class="ibm-col-6-1 dw-footer-col-1"> 
        <ul> 
         <li class="dw-footer-heading" aria-label="developerWorks">developerWorks</li> 
         <li><a href="//www.ibm.com/developerworks/aboutdw/">About</a></li> 
         <li><a href="//www.ibm.com/developerworks/feedback">Help</a></li> 
         <li class="dw-footer-newline"><a href="//www.ibm.com/developerworks/ideas">Submit content</a></li> 
         <li class="dw-footer-newline"><a href="//www.ibm.com/developerworks/secure/report/">Report abuse</a></li> 
         <li class="dw-footer-newline"><a href="//www.ibm.com/developerworks/community/terms/thirdparty/">Third-party notice</a></li> 
        </ul> 
        <ul> 
         <li class="dw-footer-heading" aria-label="Community">Community</li> 
         <li class="dw-footer-newline"><a href="//www.ibm.com/developerworks/rfe/">Product feedback</a></li> 
         <li class="dw-footer-newline"><a href="//www.ibm.com/developerworks/connect/">Developer Centers</a></li> 
        </ul> 
        <ul> 
         <li class="dw-footer-heading dw-follow-us" aria-label="Follow us">Follow us</li> 
        </ul> 
        <p class="dw-footer-social"> <a href="//twitter.com/developerWorks"> <img width="28" height="27" alt="Twitter" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-twitter.png"> </a> </p> 
        <p class="dw-footer-social-right"> <a href="//www.facebook.com/developerworks"> <img width="28" height="27" alt="Facebook" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-facebook.png"> </a> </p> 
        <br> 
        <p class="dw-footer-social"> <a href="//www.linkedin.com/groups/IBM-developerWorks-8137234"> <img width="28" height="27" alt="LinkedIn" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-linkedin.png"> </a> </p> 
        <p class="dw-footer-social-right"> <a href="//www.youtube.com/user/developerworks"> <img width="28" height="27" alt="YouTube" src="//dw1.s81c.com/developerworks/i/mf/dw-footer-icon-youtube.png"> </a> </p> 
       </div> 
       <div class="ibm-col-6-1 dw-footer-col-2"> 
        <ul> 
         <li class="dw-footer-heading" aria-label="Join">Join</li> 
         <li><a href="//developer.ibm.com/academic/">Faculty</a></li> 
         <li><a href="//developer.ibm.com/students/">Students</a></li> 
         <li><a href="//developer.ibm.com/startups/">Startups</a></li> 
         <li class="dw-footer-newline"><a href="//www.ibm.com/isv/">Business Partners</a></li> 
        </ul> 
        <ul class="dw-footer-lang" aria-label="Select a language"> 
         <li class="dw-footer-heading">Select a language</li> 
         <li><a href="//www.ibm.com/developerworks/">English</a></li> 
         <li><a href="//www.ibm.com/developerworks/cn/" lang="zh">??</a></li> 
         <li><a href="//www.ibm.com/developerworks/jp/" lang="ja">???</a></li> 
         <li><a href="//www.ibm.com/developerworks/ru/" lang="ru">???????</a></li> 
         <li class="dw-footer-newline"><a href="//www.ibm.com/developerworks/br/" lang="pt">Português (Brasil)</a></li> 
         <li><a href="//www.ibm.com/developerworks/ssa/" lang="es">Español</a></li> 
         <li><a href="//developer.ibm.com/kr/" lang="kr">??</a></li> 
        </ul> 
       </div> 
       <div class="ibm-col-6-1 dw-footer-col-3"> 
       </div> 
       <div class="ibm-col-6-1 dw-footer-col-4"> 
        <ul class="dw-footer-categories"> 
         <li class="dw-footer-category"> <a href="//www.ibm.com/developerworks/learn/">Tutorials &amp; training</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/accelerate/">Demos &amp; sample code</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/answers">Q&amp;A forums</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/dwblog/">dW Blog</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/events/">Events</a> </li> 
        </ul> 
       </div> 
       <div class="ibm-col-6-1 dw-footer-col-5"> 
        <ul class="dw-footer-categories"> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/courses/">Courses</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/open/">Open source projects</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/tv/">Videos</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/recipes/">Recipes</a> </li> 
        </ul> 
       </div> 
       <div class="ibm-col-6-1 dw-footer-col-6"> 
        <ul class="dw-footer-categories"> 
         <li class="dw-footer-category"> <a href="//www.ibm.com/developerworks/develop/">Downloads</a> </li> 
         <li class="dw-footer-category"> <a href="//developer.ibm.com/api/">APIs</a> </li> 
         <li class="dw-footer-category"> <a href="//www.ibm.com/developerworks/newsletter/">Newsletters</a> </li> 
         <li class="dw-footer-category"> <a href="//www.ibm.com/developerworks/feeds/">Feeds</a> </li> 
        </ul> 
       </div> 
      </div> 
     </section> 
    </div> 
    <div id="dw-footer" class="ibm-padding-normal ibm-alternate"> 
     <div class="ibm-columns"> 
      <div class="ibm-col-1-1"> 
       <div class="dw-footer-corporate-links"> 
        <ul> 
         <li><a href="//www.ibm.com/developerworks/aboutdw/contacts.html">Contact</a></li> 
         <li><a href="//www.ibm.com/privacy/us/en/">Privacy</a></li> 
         <li><a href="//www.ibm.com/developerworks/community/terms/use/">Terms of use</a></li> 
         <li><a href="//www.ibm.com/accessibility/us/en/">Accessibility</a></li> 
         <li class="ibm-feedbacklink"><a href="#">Feedback</a></li> 
         <li id="ibm-truste-cp"><a onclick="truste.eu.clickListener();return false;" href="#">Cookie Preferences</a></li> 
        </ul> 
       </div> 
       <div id="ibm-footer-locale-selector"></div> 
      </div> 
     </div> 
    </div> 
   </footer> 
   <!-- FOOTER_END --> 
   <!-- END_IBM-TOP --> 
  </div> 
  <!-- SCRIPTS_INCLUDE_BEGIN --> 
  <!-- Styles --> 
  <link rel="stylesheet" type="text/css" href="/developerworks/maverick/css/plugin/comments/jquery-comments.css"> 
  <link rel="stylesheet" href="/developerworks/maverick/fonts/awesome-4.5.0/css/font-awesome.min.css"> 
  <!-- Libraries --> 
  <script type="text/javascript" src="/developerworks/maverick/js/plugin/comments/jquery-comments.min.js"></script> 
  <script type="text/javascript" src="/developerworks/maverick/js/plugin/formatter/moment-with-locales.js"></script> 
  <script type="text/javascript" src="/developerworks/maverick/js/ContentComments.js"></script> 
  <script type="text/javascript" src="/developerworks/js/v18/ContentCommentsFormatter.js"></script> 
  <script type="text/javascript" language="JavaScript">

	IBMCore.common.module.masthead.subscribe("ready", "customjs", setupCommentsPlugin).runAsap(setupCommentsPlugin);

	function setupCommentsPlugin(){
		//debugger;
			//alert(userLinks);
			var commentsInitInfo = {
				contentId : $("div[class=metavalue]:contains('ArticleID=')").text().split("=")[1],
				siteId :  $("div[class=metavalue]:contains('SITE_ID=')").text().split("=")[1],
				pluginDivId : '#dw-icomments-container',
				notifyElementId : "#comment_notification",
				loginMessageDivId : "#dw-article-cmts-login",
				totalCommentsDivId : "#nCmts"
			};				
								
			ContentComments.Setup(commentsInitInfo);
	}
</script> 
  <script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-41146412-3','auto');ga('require','linkid','linkid.js');var dcdate="2016-03-03";var cmaid="1027836";ga('set','dimension1',dcdate);ga('set','dimension2',cmaid);var dw_canonical="http://www.ibm.com/developerworks/library/se-add-google-recaptcha-bluemix-node.js-application/index.html";dw_canonical=dw_canonical.substring(dw_canonical.indexOf(".ibm.com")+8);ga('send','pageview',{'page':dw_canonical,'dimension1':dcdate,'dimension2':cmaid});var trkOBL=function(url,id){id=id.split("-");var cat="v18 article";var act="Bluemix";if(id[2]=="dwpremium")act="Premium";if(id[2]=="dwopen")act="dWOpen";if(id[2]=="devops")act="Devops";act=act+' '+id[3];if(id[4]){var label=id[4];if(label=="btn")label="button";if(label=="txt")label="text link";if(label=="bnr")label="banner";if(label=="tl")label="tile";if(label=="regbar")label="registration bar";if(label=="vp")label="video promotion"}var ab=0;if(id[5]){if(id[5]=="ABa")ab=1;if(id[5]=="ABb")ab=2;if(id[5]=="ABc")ab=3;if(id[5]=="ABd")ab=4;if(id[5]=="ABe")ab=5;if(id[5]=="ABf")ab=6;if(id[5]=="ABg")ab=7;if(id[5]=="ABh")ab=8}ga('send','event',cat,act,label,ab,{'page':dw_canonical,'hitCallback':function(){document.location=url}})}</script>
  <!-- Piwik --> 
  <script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(["setDomains", ["*.www.ibm.com/developerworks","*.www.ibm.com/developerworks"]]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
    var u="//developer.ibm.com/piwik/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 7]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
</script> 
  <noscript>
   <p><img src="//developer.ibm.com/piwik/piwik.php?idsite=7" style="border:0;" alt=""></p>
  </noscript> 
  <!-- End Piwik Code -->
  <!-- Hotjar Tracking Code for ibm.com --> 
  <script>
    (function(h,o,t,j,a,r){
    h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
    h._hjSettings={hjid:42920,hjsv:5};
    a=o.getElementsByTagName('head')[0];
    r=o.createElement('script');r.async=1;
    r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
    a.appendChild(r);
    })(window,document,'//static.hotjar.com/c/hotjar-','.js?sv=');
</script> 
  <!-- SCRIPTS_INCLUDE_END -->   
 </body>
</html>