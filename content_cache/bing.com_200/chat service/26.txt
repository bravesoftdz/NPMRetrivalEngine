<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="en">
 <head> 
  <link rel="shortcut icon" href="http://introcs.cs.princeton.edu/favicon.ico"> 
  <link rel="stylesheet" href="http://introcs.cs.princeton.edu/java.css" type="text/css"> 
  <title>ChatClient.java</title> 
  <meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1"> 
  <meta NAME="AUTHOR" CONTENT="Robert Sedgewick and Kevin Wayne"> 
  <meta NAME="DESCRIPTION" CONTENT="ChatClient code in Java"> 
  <meta NAME="TITLE" CONTENT="ChatClient code in Java"> 
  <meta NAME="KEYWORDS" CONTENT="ChatClient,java,programming,computer science,algorithm,program,code"> 
  <meta NAME="ROBOTS" CONTENT="INDEX,FOLLOW"> 
 </head> 
 <body> 
  <center>
   <h1>ChatClient.java</h1>
  </center>
  <p><br> Below is the syntax highlighted version of <a href="ChatClient.java">ChatClient.java</a> from <a href="http://introcs.cs.princeton.edu/java/84network">§8.4 Operating Systems</a>. </p>
  <p><br> 
   <!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite --> </p>
  <pre><tt><span class="comment">/******************************************************************************</span>
<span class="comment"> * Compilation: javac ChatClient.java</span>
<span class="comment"> * Execution: java ChatClient name host</span>
<span class="comment"> * Dependencies: In.java Out.java</span>
<span class="comment"> *</span>
<span class="comment"> * Connects to host server on port 4444, enables an interactive</span>
<span class="comment"> * chat client.</span>
<span class="comment"> * </span>
<span class="comment"> * % java ChatClient alice localhost</span>
<span class="comment"> *</span>
<span class="comment"> * % java ChatClient bob localhost</span>
<span class="comment"> * </span>
<span class="comment"> ******************************************************************************/</span>


<span class="preproc">import</span><span class="normal"> java</span><span class="symbol">.</span><span class="normal">awt</span><span class="symbol">.*;</span>
<span class="preproc">import</span><span class="normal"> java</span><span class="symbol">.</span><span class="normal">awt</span><span class="symbol">.</span><span class="normal">event</span><span class="symbol">.*;</span>
<span class="preproc">import</span><span class="normal"> javax</span><span class="symbol">.</span><span class="normal">swing</span><span class="symbol">.</span><span class="normal">JFrame</span><span class="symbol">;</span>
<span class="preproc">import</span><span class="normal"> javax</span><span class="symbol">.</span><span class="normal">swing</span><span class="symbol">.</span><span class="normal">JScrollPane</span><span class="symbol">;</span>
<span class="preproc">import</span><span class="normal"> javax</span><span class="symbol">.</span><span class="normal">swing</span><span class="symbol">.</span><span class="normal">JTextArea</span><span class="symbol">;</span>
<span class="preproc">import</span><span class="normal"> javax</span><span class="symbol">.</span><span class="normal">swing</span><span class="symbol">.</span><span class="normal">JTextField</span><span class="symbol">;</span>
<span class="preproc">import</span><span class="normal"> java</span><span class="symbol">.</span><span class="normal">net</span><span class="symbol">.</span><span class="normal">Socket</span><span class="symbol">;</span>

<span class="keyword">public</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">ChatClient</span><span class="normal"> </span><span class="keyword">extends</span><span class="normal"> JFrame </span><span class="usertype">implements</span><span class="normal"> ActionListener </span><span class="cbracket">{</span>

<span class="normal"> </span><span class="keyword">private</span><span class="normal"> </span><span class="usertype">String</span><span class="normal"> screenName</span><span class="symbol">;</span>

<span class="normal"> </span><span class="comment">// GUI stuff</span>
<span class="normal"> </span><span class="keyword">private</span><span class="normal"> </span><span class="usertype">JTextArea</span><span class="normal"> enteredText </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">JTextArea</span><span class="symbol">(</span><span class="number">10</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">);</span>
<span class="normal"> </span><span class="keyword">private</span><span class="normal"> </span><span class="usertype">JTextField</span><span class="normal"> typedText </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">JTextField</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">);</span>

<span class="normal"> </span><span class="comment">// socket for connection to chat server</span>
<span class="normal"> </span><span class="keyword">private</span><span class="normal"> </span><span class="usertype">Socket</span><span class="normal"> socket</span><span class="symbol">;</span>

<span class="normal"> </span><span class="comment">// for writing to and reading from the server</span>
<span class="normal"> </span><span class="keyword">private</span><span class="normal"> </span><span class="usertype">Out</span><span class="normal"> out</span><span class="symbol">;</span>
<span class="normal"> </span><span class="keyword">private</span><span class="normal"> </span><span class="usertype">In</span><span class="normal"> in</span><span class="symbol">;</span>

<span class="normal"> </span><span class="keyword">public</span><span class="normal"> </span><span class="function">ChatClient</span><span class="symbol">(</span><span class="usertype">String</span><span class="normal"> screenName</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">String</span><span class="normal"> hostName</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal"> </span><span class="comment">// connect to server</span>
<span class="normal"> </span><span class="keyword">try</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal"> socket </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Socket</span><span class="symbol">(</span><span class="normal">hostName</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4444</span><span class="symbol">);</span>
<span class="normal"> out </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Out</span><span class="symbol">(</span><span class="normal">socket</span><span class="symbol">);</span>
<span class="normal"> in </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">In</span><span class="symbol">(</span><span class="normal">socket</span><span class="symbol">);</span>
<span class="normal"> </span><span class="cbracket">}</span>
<span class="normal"> </span><span class="keyword">catch</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">Exception</span><span class="normal"> ex</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> ex</span><span class="symbol">.</span><span class="function">printStackTrace</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal"> </span><span class="keyword">this</span><span class="symbol">.</span><span class="normal">screenName </span><span class="symbol">=</span><span class="normal"> screenName</span><span class="symbol">;</span>

<span class="normal"> </span><span class="comment">// close output stream - this will cause listen() to stop and exit</span>
<span class="normal"> </span><span class="function">addWindowListener</span><span class="symbol">(</span>
<span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">WindowAdapter</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal"> </span><span class="keyword">public</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">windowClosing</span><span class="symbol">(</span><span class="usertype">WindowEvent</span><span class="normal"> e</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal"> out</span><span class="symbol">.</span><span class="function">close</span><span class="symbol">();</span>
<span class="comment">// in.close();</span>
<span class="comment">// try { socket.close(); }</span>
<span class="comment">// catch (Exception ioe) { ioe.printStackTrace(); }</span>
<span class="normal"> </span><span class="cbracket">}</span>
<span class="normal"> </span><span class="cbracket">}</span>
<span class="normal"> </span><span class="symbol">);</span>


<span class="normal"> </span><span class="comment">// create GUI stuff</span>
<span class="normal"> enteredText</span><span class="symbol">.</span><span class="function">setEditable</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal"> enteredText</span><span class="symbol">.</span><span class="function">setBackground</span><span class="symbol">(</span><span class="normal">Color</span><span class="symbol">.</span><span class="normal">LIGHT_GRAY</span><span class="symbol">);</span>
<span class="normal"> typedText</span><span class="symbol">.</span><span class="function">addActionListener</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">);</span>

<span class="normal"> </span><span class="usertype">Container</span><span class="normal"> content </span><span class="symbol">=</span><span class="normal"> </span><span class="function">getContentPane</span><span class="symbol">();</span>
<span class="normal"> content</span><span class="symbol">.</span><span class="function">add</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">JScrollPane</span><span class="symbol">(</span><span class="normal">enteredText</span><span class="symbol">),</span><span class="normal"> BorderLayout</span><span class="symbol">.</span><span class="normal">CENTER</span><span class="symbol">);</span>
<span class="normal"> content</span><span class="symbol">.</span><span class="function">add</span><span class="symbol">(</span><span class="normal">typedText</span><span class="symbol">,</span><span class="normal"> BorderLayout</span><span class="symbol">.</span><span class="normal">SOUTH</span><span class="symbol">);</span>


<span class="normal"> </span><span class="comment">// display the window, with focus on typing box</span>
<span class="normal"> </span><span class="function">setTitle</span><span class="symbol">(</span><span class="string">"Chat Client 1.0: ["</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> screenName </span><span class="symbol">+</span><span class="normal"> </span><span class="string">"]"</span><span class="symbol">);</span>
<span class="normal"> </span><span class="function">setDefaultCloseOperation</span><span class="symbol">(</span><span class="normal">JFrame</span><span class="symbol">.</span><span class="normal">EXIT_ON_CLOSE</span><span class="symbol">);</span>
<span class="normal"> </span><span class="function">pack</span><span class="symbol">();</span>
<span class="normal"> typedText</span><span class="symbol">.</span><span class="function">requestFocusInWindow</span><span class="symbol">();</span>
<span class="normal"> </span><span class="function">setVisible</span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">);</span>

<span class="normal"> </span><span class="cbracket">}</span>

<span class="normal"> </span><span class="comment">// process TextField after user hits Enter</span>
<span class="normal"> </span><span class="keyword">public</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">actionPerformed</span><span class="symbol">(</span><span class="usertype">ActionEvent</span><span class="normal"> e</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal"> out</span><span class="symbol">.</span><span class="function">println</span><span class="symbol">(</span><span class="string">"["</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> screenName </span><span class="symbol">+</span><span class="normal"> </span><span class="string">"]: "</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> typedText</span><span class="symbol">.</span><span class="function">getText</span><span class="symbol">());</span>
<span class="normal"> typedText</span><span class="symbol">.</span><span class="function">setText</span><span class="symbol">(</span><span class="string">""</span><span class="symbol">);</span>
<span class="normal"> typedText</span><span class="symbol">.</span><span class="function">requestFocusInWindow</span><span class="symbol">();</span>
<span class="normal"> </span><span class="cbracket">}</span>

<span class="normal"> </span><span class="comment">// listen to socket and print everything that server broadcasts</span>
<span class="normal"> </span><span class="keyword">public</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">listen</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal"> </span><span class="usertype">String</span><span class="normal"> s</span><span class="symbol">;</span>
<span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">s </span><span class="symbol">=</span><span class="normal"> in</span><span class="symbol">.</span><span class="function">readLine</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="keyword">null</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal"> enteredText</span><span class="symbol">.</span><span class="function">insert</span><span class="symbol">(</span><span class="normal">s </span><span class="symbol">+</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal"> enteredText</span><span class="symbol">.</span><span class="function">getText</span><span class="symbol">().</span><span class="function">length</span><span class="symbol">());</span>
<span class="normal"> enteredText</span><span class="symbol">.</span><span class="function">setCaretPosition</span><span class="symbol">(</span><span class="normal">enteredText</span><span class="symbol">.</span><span class="function">getText</span><span class="symbol">().</span><span class="function">length</span><span class="symbol">());</span>
<span class="normal"> </span><span class="cbracket">}</span>
<span class="normal"> out</span><span class="symbol">.</span><span class="function">close</span><span class="symbol">();</span>
<span class="normal"> in</span><span class="symbol">.</span><span class="function">close</span><span class="symbol">();</span>
<span class="normal"> </span><span class="keyword">try</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> socket</span><span class="symbol">.</span><span class="function">close</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal"> </span><span class="keyword">catch</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">Exception</span><span class="normal"> e</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> e</span><span class="symbol">.</span><span class="function">printStackTrace</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal"> System</span><span class="symbol">.</span><span class="normal">err</span><span class="symbol">.</span><span class="function">println</span><span class="symbol">(</span><span class="string">"Closed client socket"</span><span class="symbol">);</span>
<span class="normal"> </span><span class="cbracket">}</span>

<span class="normal"> </span><span class="keyword">public</span><span class="normal"> </span><span class="keyword">static</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">main</span><span class="symbol">(</span><span class="normal">String</span><span class="symbol">[]</span><span class="normal"> args</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal"> </span><span class="usertype">ChatClient</span><span class="normal"> client </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">ChatClient</span><span class="symbol">(</span><span class="normal">args</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> args</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal"> client</span><span class="symbol">.</span><span class="function">listen</span><span class="symbol">();</span>
<span class="normal"> </span><span class="cbracket">}</span>
<span class="cbracket">}</span>
</tt></pre> 
  <script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script> 
  <script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-10811519-1");
pageTracker._trackPageview();
} catch(err) {}</script>  
  <p><br></p>
  <address><small> Copyright © 20002011, Robert Sedgewick and Kevin Wayne. <br>Last updated: Tue Aug 30 09:58:33 EDT 2016. </small></address>  
 </body>
</html>