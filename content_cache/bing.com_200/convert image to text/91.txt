<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"> 
  <title>Javascript example to position text on an image at the mouse coordinates.</title> 
  <meta name="Title" content="Javascript example to position text on an image at the mouse coordinates."> 
  <meta name="Description" content="How to use Javascript to position text at the coordinates of the mouse when it is clicked on an image."> 
  <meta name="Keywords" content="javascript, mouse, coordinates, image, browser, click"> 
  <link href="../../css/new.css" rel="stylesheet" type="text/css"> 
  <style type="text/css">

div.redimage {
  float: left;
}
.redimage img {
  margin-left: 60px;
  margin-top: 10px;
}
.redimage p {
  margin-left: 50px;
  padding-top: 5px;
  font-weight: bold;
}

.blocktext {
  float: left;
  margin-top: 130px;
  padding-left: 20px;
}

.blocktext p {
  font-weight: bold;
}

</style> 
  <script type="text/javascript">
<!--

function FindPosition(oElement)
{
  if( typeof( oElement.offsetParent ) != "undefined" )
  {
    for( var posX = 0, posY = 0; oElement; oElement = oElement.offsetParent )
    {
      posX += oElement.offsetLeft;
      posY += oElement.offsetTop;
    }
    return [ posX, posY ];
  }
  else
  {
    return [ oElement.x, oElement.y ];
  }
}
 
function GetCoordinates(e)
{
 var PosX = 0;
 var PosY = 0;
 var ImgPos;
 ImgPos = FindPosition(myImg);
 if (!e) var e = window.event;
 if (e.pageX || e.pageY)
 {
  PosX = e.pageX;
  PosY = e.pageY;
 }
 else if (e.clientX || e.clientY)
   {
    PosX = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
    PosY = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
 }
 PosX = PosX - ImgPos[0];
 PosY = PosY - ImgPos[1];
 myImg.src = "mousetext.asp?x=" + PosX + "&y=" + PosY + "&imagetext=" + encodeURI(document.form1.imagetext.value);
}

//-->
</script> 
  <!--
<meta property="og:title" content="Positioning text on an image with Javascript."/>
<meta property="og:type" content="article"/>
<meta property="og:url" content="http://www.chestysoft.com/imagefile/javascript/position-text.asp"/>
<meta property="og:site_name" content="Chestysoft"/>
<meta property="fb:admins" content="100000438143055"/>
<meta property="og:image" content="http://www.chestysoft.com/images/logo-small.gif" />
--> 
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25142049-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script> 
 </head> 
 <body> 
  <div id="page"> 
   <div id="banner"> 
    <img src="../../images/logo.gif" class="logo" alt="Javascript code to position text on an image at the mouse coordinates"> 
    <img src="../../images/bannerspac.gif" alt=""> 
    <ul id="bannerlinks"> 
     <li><a href="../default.asp" title="csImageFile product page">csImageFile</a></li> 
     <li><a href="../../default.asp" title="Chestysoft Home Page">Home</a></li> 
     <li><a href="../../faq.asp" title="Frequently asked questions for Chestysoft products">FAQ</a></li> 
     <li><a href="../../sitemap.asp" title="Navigate to any page in the site">Site Map</a></li> 
    </ul> 
   </div> 
   <h1 class="title">Using Javascript to place text on an image</h1> 
   <p>This examples follows on from the <a href="get-coordinates.asp" class="link1" title="Javascript to find mouse coordinates on an image">mouse coordinates</a> example which showed the Javascript code used in the browser to find the position of the mouse on an image. Instead of displaying the mouse coordinates, they are sent to an ASP script which uses csImageFile to generate an image. The coordinates are passed in the query string as well as the text from the input box.</p> 
   <div class="redimage"> 
    <img src="mousetext.asp" width="400" height="300" alt="" id="myImgId">
    <p>Click on the image to place the text.</p> 
   </div> 
   <div class="blocktext"> 
    <form name="form1" action=""> 
     <p>Enter text: <input type="text" name="imagetext" id="imagetext" value="Some text"></p> 
    </form> 
   </div> 
   <script type="text/javascript">
<!--
var myImg = document.getElementById("myImgId");
myImg.onmousedown = GetCoordinates; 
//-->
</script> 
   <div class="vspace clearboth"></div> 
   <div class="linebreak"></div> 
   <h2>The Javascript code</h2> 
   <p>The Javascript code in the page header is similar to the <a href="get-coordinates.asp" class="link1" title="Javascript to find mouse coordinates on an image">previous example</a>. The FindPosition function is used to find the position of the image tag, and the GetCoordinates function then finds the coordinates of the mouse when it is clicked on the image. The following line sends the coordinates to the ASP script and the resulting image is displayed. The Javascript function encodeURI is used to encode spaces and any extended characters that use UTF-8 encoding (characters with accents).</p> 
   <div class="code"> 
    <p>myImg.src = "mousetext.asp?x=" + PosX + "&amp;y=" + PosY + "&amp;imagetext=" +<br> &nbsp;&nbsp;encodeURI(document.form1.imagetext.value);</p> 
   </div> 
   <p>The input box is in a form called <span class="mono">form1</span> and is named <span class="mono">imagetext</span>. The image tag has an id of <span class="mono">myImgId</span>.</p> 
   <div class="code"> 
    <p>&lt;img id="myImgId" alt="" src="red.gif" width="400" height="300" /&gt;</p> 
   </div> 
   <div class="linebreak"></div> 
   <h2>The ASP script that creates the image and the text</h2> 
   <p>This script uses the csImageFile component to create an image. It reads the query string to get the coordinates and text and uses the csImageFile <em>Text</em> method to draw the text at those coordinates. The image is streamed to the browser as a GIF.</p> 
   <div class="code"> 
    <p>Set Image = Server.CreateObject("csImageFile.Manage")<br> Image.NewImage 400, 300, "FF0000"</p> 
    <p>Image.TextOpaque = false<br> Image.TextSize = 18</p> 
    <p>X = CInt(Request.Querystring("x"))<br> Y = CInt(Request.Querystring("y"))<br> Text = Image.DecodeUTF8(Request.Querystring("ImageText"))<br> If X &lt;&gt; 0 Then<br> &nbsp;&nbsp;Image.Text X, Y, Text<br> End If</p> 
    <p>Response.ContentType = "image/gif"<br> Response.BinaryWrite Image.GIFData</p> 
   </div> 
   <p>Some properties are set to control the text appearance. The image is created new, but it could just as easily be loaded from a file on the server. The <em>DecodeUTF8</em> method is used to reverse the encoding of the Javascript <em>encodeURI</em> function. The image is not saved after displaying.</p> 
   <p>This technique can be adapted to save the image, or position other features. We have a downloadable example that <a href="get-rectangle.asp" class="link1" title="Downloadable code to draw a rectangle at the mouse coordinates">selects two pairs of coordinates</a> and draws a rectangle on the image.</p> 
   <div class="linebreak"></div> 
   <div class="recommend"> 
    <script src="http://connect.facebook.net/en_US/all.js#xfbml=1" type="text/javascript"></script> 
    <script type="text/javascript">
//<![CDATA[
document.write('<fb:like show_faces="false" width="450" url="http://www.chestysoft.com/imagefile/javascript/position-text.asp" action="recommend" layout="button_count"></fb:like>');
//]]>
</script> 
   </div> 
   <div class="smallvspace"></div> 
   <div class="navbar"> 
    <ul class="navlinks"> 
     <li><a href="../default.asp">csImageFile</a></li> 
     <li><a href="../manual.htm">Online Manual</a></li> 
     <li><a href="../download.asp">Trial Download</a></li> 
     <li><a href="../../default.asp">Chestysoft Home</a></li> 
    </ul> 
   </div> 
  </div> 
  <p class="copyright">© Chestysoft, 2017.</p> 
  <!-- Google Code for Remarketing Tag --> 
  <script type="text/javascript">
/* <![CDATA[ */
var google_conversion_id = 1072647179;
var google_custom_params = window.google_tag_params;
var google_remarketing_only = true;
/* ]]> */
</script> 
  <script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script> 
  <noscript> 
   <div style="display:inline;"> 
    <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/1072647179/?value=0&amp;guid=ON&amp;script=0"> 
   </div> 
  </noscript>  
 </body>
</html>