<!-- #BeginEditable "templ" -->
<!-- #EndEditable -->
<html>
 <!-- #BeginTemplate "/Templates/Content.dwt" -->
 <head> 
  <script language="JavaScript">
var _bhtg_acctid='servlets';
var bhawkplt_start = new Date().getTime();
document.write(unescape("%3cscript src='" + (document.location.protocol == 'https:' ? 'https:' : 'http:')
 + "//lib.browserhawk.com/bhtg/bhanalytics.js?acct=" + _bhtg_acctid + "'%3e %3c/script%3e"));
</script> 
  <!-- #BeginEditable "doctitle" --> 
  <title>Servlets.com | Filter code with Servlet 2.3</title> 
  <!-- #EndEditable --> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
  <link rel="stylesheet" type="text/css" href="../Templates/style.css"> 
 </head> 
 <body bgcolor="#FFFFFF" background="../images/background.gif" text="#000000" link="#003333" alink="#669999" vlink="#333333" marginwidth="0" marginheight="0" leftmargin="0" topmargin="0"> 
  <!-- begin top banner --> 
  <table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#006699"> 
   <tbody>
    <tr> 
     <td colspan="3" bgcolor="#006699"><img src="../images/trans.gif" width="1" height="5" hspace="0" vspace="0" border="0" alt=" "></td> 
    </tr> 
    <tr> 
     <td width="950" height="90" bgcolor="#000000"><img src="../images/servlets_logo_rnd-90short.jpg" width="220" height="90" hspace="0" vspace="0" border="0" alt="Servlets.com" style="padding: 0px 5px 0px 0px;"></td> 
     <td height="90" align="left" valign="middle" bgcolor="#000000"> 
      <!-- This tag should be placed in the art/top_468x60 category/subcategory in the 468x60 size space  --> 
      <!--
      <IFRAME SRC="http://ad.doubleclick.net/adi/servlets.ds/art;pos=top_art;sz=728x90;ord=89475156401592110?" name="frame1" width="728" height="90" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no"> 
      <SCRIPT language="JavaScript1.1" SRC="http://ad.doubleclick.net/adj/servlets.ds/art;abr=!ie;pos=top_art;sz=728x90;ord=89475156401592110?">
</SCRIPT>
      <NOSCRIPT> <A HREF="http://ad.doubleclick.net/jump/servlets.ds/art;abr=!ie;pos=top_art;sz=728x90;ord=89475156401592110?"><IMG SRC="http://ad.doubleclick.net/ad/servlets.ds/art;abr=!ie;pos=top_art;sz=728x90;ord=89475156401592110?" border=0 height="90" width="728"></A> 
      </NOSCRIPT> </IFRAME> 
	  --> 
      <!-- End of adMonitor v3.0 rich content tags --> </td> 
     <td bgcolor="#006699"><img src="../images/trans.gif" width="5" height="1" hspace="0" vspace="0" border="0" alt=" "></td> 
    </tr> 
    <tr> 
     <td colspan="3" bgcolor="#006699"><img src="../images/trans.gif" width="1" height="5" hspace="0" vspace="0" border="0" alt=" "></td> 
    </tr> 
    <!-- start textbar --> 
    <!--
<tr>
<td colspan="3">
<IFRAME SRC="http://ad.doubleclick.net/adi/servlets.ds/home;pos=textbar_art;sz=630x21;ord=91917237122038410?" name="frame1" width="630" height="21" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no" HSPACE=5>
<SCRIPT language="JavaScript1.1" SRC="http://ad.doubleclick.net/adj/servlets.ds/home;abr=!ie;pos=textbar_art;sz=630x21;ord=91917237122038410?">
</SCRIPT>
<NOSCRIPT>
<A HREF="http://ad.doubleclick.net/jump/servlets.ds/home;abr=!ie;pos=textbar_art;sz=630x21;ord=91917237122038410?"><IMG SRC="http://ad.doubleclick.net/ad/servlets.ds/home;abr=!ie;pos=textbar_art;sz=630x21;ord=91917237122038410?" border=0 height="21" width="630" HSPACE=5></A>
</NOSCRIPT>
</IFRAME>
</td>
<td></td>
</tr>
--> 
    <!-- end textbar --> 
   </tbody>
  </table> 
  <!-- end top banner ad --> 
  <!-- set this to 900 with the skyscraper back --> 
  <table width="950" border="0" cellspacing="1" cellpadding="1"> 
   <tbody>
    <tr> 
     <td> 
      <table width="100%" border="0" cellspacing="1" cellpadding="1"> 
       <tbody>
        <tr> 
         <td width="130" valign="top"> <br> 
          <!-- Search Google --> 
          <form method="GET" action="http://www.google.com/custom"> 
           <input TYPE="text" name="q" size="13" maxlength="255" value="Search"> 
           <input type="hidden" name="cof" VALUE="LW:230;L:http://www.servlets.com/images/logo.gif;LH:76;AH:center;S:http://www.servlets.com;AWFID:35e510e43fcd468d;"> 
           <input type="hidden" name="domains" value="servlets.com"> 
           <input type="hidden" name="sitesearch" value="servlets.com"> 
          </form> 
          <!-- End search Google --> 
          <!--
            <table border="0" cellpadding="0" cellspacing="0" width="120" >
              <tr> 
                <td> <iframe src="http://ad.doubleclick.net/adi/servlets.ds/art;pos=cb_art;sz=120x240;ord=1900483146?" 
  width="120" height="240" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"> 
                  <script type="text/javascript" language="JavaScript1.1" 
    src="http://ad.doubleclick.net/adj/servlets.ds/art;abr=!ie;pos=cb_art;sz=120x240;ord=1900483146?">
  </script>
                  </iframe> <noscript> <a href="http://ad.doubleclick.net/jump/servlets.ds/art;abr=!ie;pos=cb_art;sz=120x240;ord=1900483146?"><img src="http://ad.doubleclick.net/ad/servlets.ds/art;abr=!ie;kw=pos=cb_art;sz=120x240;ord=1900483146?" 
  border="0" width="120" height="240" alt="Advertisement" /></a> </noscript></td>
              </tr>
            </table>
--> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../index.tea"><font color="#FFFFFE">Home</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../blog"><font color="#FFFFFE">What's New?</font></a></font></b></font></p> 
          <!--            <p><b><font face="Arial, Helvetica, sans-serif" size="2" color="#FFFFFF"><a href="http://careers.servlets.com"><font color="#FFFFFE">J2EE 
              Jobs</font></a> </font></b></p> --> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../cos"><font color="#FFFFFE">com.oreilly.servlet</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../polls"><font color="#FFFFFE">Servlet Polls</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../lists"><font color="#FFFFFE">Mailing Lists </font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../archive"><font color="#FFFFFE">List Archives </font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../engines"><font color="#FFFFFE">Servlet Engines</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../isps"><font color="#FFFFFE">Servlet ISPs</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../tools"><font color="#FFFFFE">Servlet Tools</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../docs"><font color="#FFFFFE">Documentation</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../articles"><font color="#FFFFFE">Online Articles</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../soapbox"><font color="#FFFFFE">The</font><font color="#FFFFFE"> Soapbox </font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../jservlet2"><font color="#FFFFFE">"Java Servlet <br> Programming, <br> Second Edition"</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../javaebp"><font color="#FFFFFE">"Java Enterprise <br> Best Practices"</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../speaking"><font color="#FFFFFE">Speaking &amp; Slides </font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="../jason"><font color="#FFFFFE">About Jason</font></a></font></b></font></p> <p><font size="2"><b><font color="#FFFFFF" face="Arial, Helvetica, sans-serif"><a href="http://www.x-query.com/"><font color="#FFFFFE">XQuery Affiliate</font></a></font></b></font></p> <p><b><font face="Arial, Helvetica, sans-serif" size="2" color="#FFFFFF"><a href="http://www.oreillynet.com/pub/a/mediakit/adcontact.html"><font color="#FFFFFE">Advertising Info</font></a> </font></b></p> <img src="../images/130x1-transparent.gif" width="140" height="1"> </td> 
         <td width="768" valign="top"> 
          <table> 
           <tbody>
            <tr> 
             <td width="800" colspan="3" bgcolor="#006699" valign="top"><b><font face="Arial,Helvetica" size="+2" color="#FFFFFF"> 
                <!-- #BeginEditable "title" -->Filter code with Servlet 2.3
                <!-- #EndEditable --></font></b></td> 
            </tr> 
           </tbody>
          </table> 
          <!-- Begin skyscraper ad --> 
          <!--
            <table align="right" cellspacing="0" cellpadding="3" border="0" width="100">
              <tr> 
                <td style="padding: 0px 0px 0px 30px"> <IFRAME SRC="http://ad.doubleclick.net/adi/servlets.ds/art;pos=sky_art;sz=160x600;ord=12987801856428454?" name="frame1" width="160" height="600" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no"> 
                  <SCRIPT language="JavaScript1.1" SRC="http://ad.doubleclick.net/adj/servlets.ds/art;abr=!ie;pos=sky_art;sz=160x600;ord=12987801856428454?">
</SCRIPT>
                  <NOSCRIPT> <A HREF="http://ad.doubleclick.net/jump/servlets.ds/art;abr=!ie;pos=sky_art;sz=160x600;ord=12987801856428454?"><IMG SRC="http://ad.doubleclick.net/ad/servlets.ds/art;abr=!ie;pos=sky_art;sz=160x600;ord=12987801856428454?" border=0 height="600" width="160"></A> 
                  </NOSCRIPT> </IFRAME> </td>
              </tr>
            </table>
			--> 
          <!-- End skyscraper ad --> 
          <!-- Begin mega ad --> 
          <!--
            <table align="right" cellspacing="0" cellpadding="3" border="0" width="100">
              <tr> 
                <td> <IFRAME SRC="http://ad.doubleclick.net/adi/servlets.ds/art;pos=mega_art;sz=336x280;ord=74425094033061550?" name="frame1" width="336" height="280" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no"> 
                  <SCRIPT language="JavaScript1.1" SRC="http://ad.doubleclick.net/adj/servlets.ds/art;abr=!ie;pos=mega_art;sz=336x280;ord=74425094033061550?">
</SCRIPT>
                  <NOSCRIPT> <A HREF="http://ad.doubleclick.net/jump/servlets.ds/art;abr=!ie;pos=mega_art;sz=336x280;ord=74425094033061550?"><IMG SRC="http://ad.doubleclick.net/ad/servlets.ds/art;abr=!ie;pos=mega_art;sz=336x280;ord=74425094033061550?" border=0 height="280" width="336"></A> 
                  </NOSCRIPT> </IFRAME> </td>
              </tr>
            </table>
			--> 
          <!-- End mega ad --> <font face="Arial, Helvetica, sans-serif"> <font size="+1" color="#003366"><b> 
             <!-- #BeginEditable "deck" -->Discover freely available servlet filters you can use today
             <!-- #EndEditable --> </b></font> <p> 
            <!-- This tag should be placed in the art/mega_336x280 category/subcategory in the 336x280 size space  --> 
            <!--
            <table align="right" cellspacing="0" cellpadding="3" border="0" width="100">
              <tr> 
                <td> <IFRAME SRC="http://ad.doubleclick.net/adi/servlets.ds/art;pos=mega_art;sz=336x280;ord=74425094033061550?" name="frame1" width="336" height="280" frameborder="no" border="0" MARGINWIDTH="0" MARGINHEIGHT="0" SCROLLING="no"> 
                  <SCRIPT language="JavaScript1.1" SRC="http://ad.doubleclick.net/adj/servlets.ds/art;abr=!ie;pos=mega_art;sz=336x280;ord=74425094033061550?">
</SCRIPT>
                  <NOSCRIPT> <A HREF="http://ad.doubleclick.net/jump/servlets.ds/art;abr=!ie;pos=mega_art;sz=336x280;ord=74425094033061550?"><IMG SRC="http://ad.doubleclick.net/ad/servlets.ds/art;abr=!ie;pos=mega_art;sz=336x280;ord=74425094033061550?" border=0 height="280" width="336"></A> 
                  </NOSCRIPT> </IFRAME> </td>
              </tr>
            </table>
--> 
            <!-- End of adMonitor v3.0 rich content tags --> 
            <!-- #BeginEditable "Content" --> <font size="-1"><i>(Originally published in JavaWorld, June 2001)</i></font></p><p><font size="-1"></font> <strong>Summary</strong><br> Jason Hunter looks in-depth at the new servlet filter model with an examination of several freely available filters. You'll learn how these filters work and what you can do with them. For a grand finale, Jason describes his own multipart request filter that simplifies the handling of file uploads. <em>(3,200 words)</em> </p><p> <strong>By Jason Hunter</strong> </p><p> In <a href="servlet23.html">"Servlet 2.3: New Features Exposed,"</a> I introduced the changes coming in the Servlet API 2.3 and gave a short tutorial on the new servlet filter model. In this follow-on article, I'll dig deeper into servlet filters and look at several filters you can download for free on the Web. For each filter, I'll examine what it does, how it works, and where you can get it. </p><p> You can use this article in two ways: to learn about some filters that are useful out of the box, or as an aid in writing your own filters. I'll start off with some simple examples and then move on to more advanced ones. At the end, I'll show you a file upload filter that I wrote to support multipart requests. </p><p> </p><p><font size="+1"><strong> Servlet filters</strong></font><br> In case you aren't yet familiar, a filter is an object that can transform a request or modify a response. Filters are not servlets; they don't actually create a response. They are preprocessors of the request before it reaches a servlet, and/or postprocessors of the response leaving a servlet. As you'll see later in the examples, a filter can: </p>
           <ul> 
            <li>Intercept a servlet's invocation before the servlet is called</li> 
            <li>Examine a request before a servlet is called</li> 
            <li>Modify the request headers and request data by providing a customized version of the request object that wraps the real request</li> 
            <li>Modify the response headers and response data by providing a customized version of the response object that wraps the real response</li> 
            <li>Intercept a servlet's invocation after the servlet is called</li> 
           </ul> You can configure a filter to act on a servlet or group of servlets. Zero or more filters can filter one or more servlets. A filter implements <code>javax.servlet.Filter</code> and defines its three methods: 
           <ol> 
            <li><code>void init(FilterConfig config) throws ServletException</code>: Called before the filter goes into service, and sets the filter's configuration object</li> 
            <li><code>void destroy()</code>: Called after the filter has been taken out of service</li> 
            <li><code>void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException</code>: Performs the actual filtering work</li> 
           </ol> The server calls <code>init(FilterConfig)</code> once to prepare the filter for service, then calls <code>doFilter()</code> any number of times for requests specially set up to use the filter. The <code>FilterConfig</code> interface has methods to retrieve the filter's name, its <code>init</code> parameters, and the active servlet context. The server calls <code>destroy()</code> to indicate that the filter is being taken out of service. The filter lifecycle is now very similar to the servlet lifecycle -- a change recently made in the Servlet API 2.3 Public Final Draft #2. Previously the lifecycle involved a <code>setFilterConfig(FilterConfig)</code> method. <p> In its <code>doFilter()</code> method, each filter receives the current request and response, as well as a <code>FilterChain</code> containing the filters that still must be processed. In the <code>doFilter()</code> method, a filter may do what it wants with the request and response. (It could gather data by calling their methods, or wrap the objects to give them new behavior, as I'll discuss later.) The filter then calls <code>chain.doFilter()</code> to transfer control to the next filter. When that call returns, a filter can, at the end of its own <code>doFilter()</code> method, perform additional work on the response; for instance, it can log information about the response. If the filter wants to halt the request processing and gain full control of the response, it can intentionally not call the next filter. </p><p><font size="+1"><strong> Spot the slowdown</strong></font><br> To really understand filters, you have to see them in action. The first filter we'll look at is simple but powerful; it records the duration of all requests. It's modeled loosely after the non-descriptively named <code>ExampleFilter</code> from the Tomcat 4.0 distribution. Here is the code: </p><pre>
import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class TimerFilter implements Filter {

  private FilterConfig config = null;

  public void init(FilterConfig config) throws ServletException {
    this.config = config;
  }

  public void destroy() {
    config = null;
  }

  public void doFilter(ServletRequest request, ServletResponse response,
                     FilterChain chain) throws IOException, ServletException {
    long before = System.currentTimeMillis();
    chain.doFilter(request, response);
    long after = System.currentTimeMillis();

    String name = "";
    if (request instanceof HttpServletRequest) {
      name = ((HttpServletRequest)request).getRequestURI();
    }
    config.getServletContext().log(name + ": " + (after - before) + "ms");
  }
}
</pre> When the server calls <code>init()</code>, the filter saves a reference to the config in its <code>config</code> variable, which is later used in the <code>doFilter()</code> method to retrieve the <code>ServletContext</code>. When the server calls <code>doFilter()</code>, the filter times how long the request handling takes and logs the time once processing has completed. This filter nicely demonstrates before- and after-request processing. Notice that the parameters to the <code>doFilter()</code> method are not HTTP-aware objects, so to call the HTTP-specific <code>getRequestURI()</code> method requires a cast of the request to an <code>HttpServletRequest</code> type. <p> To use this filter, you must declare it in the <code>web.xml</code> deployment descriptor using the <code>&lt;filter&gt;</code> tag, as shown below: </p><pre>
&lt;filter&gt;
    &lt;filter-name&gt;timerFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;TimerFilter&lt;/filter-class&gt;
&lt;/filter&gt;
</pre> This notifies the server that a filter named <code>timerFilter</code> is implemented in the <code>TimerFilter</code> class. You can apply a registered filter to certain URL patterns or servlet names using the <code>&lt;filter-mapping&gt;</code> tag: <pre>
&lt;filter-mapping&gt;
    &lt;filter-name&gt;timerFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</pre> This configures the filter to operate on all requests to the web application (static or dynamic), just what we want for our timing filter. If you connect to a simple page, the log output might look like this: <pre>
2001-05-25 00:14:11 /timer/index.html: 10ms
</pre> In Tomcat 4.0 beta5, you'll find the log file under <code>server_root/logs/</code>. <p><font size="+1"><strong> Who's on your site, and what are they doing?</strong></font><br> Our next filter is a <em>clickstream</em> filter written by the folks at <a href="#resources">OpenSymphony</a>. This filter tracks user requests (a.k.a. clicks) and request sequences (a.k.a. clickstreams) to show a site administrator who's visiting her site and what pages each visitor has accessed so far. It's an open source library, under the LGPL license. </p><p> Inside the clickstream library you'll find a <code>ClickstreamFilter</code> class that captures request information, a <code>Clickstream</code> class that operates like a struct to hold data, and a <code>ClickstreamLogger</code> class that captures session and context events to glue everything together. There's also a <code>BotChecker</code> class that determines if a client is a robot (using simple logic, like "Did they request robots.txt?"). To view the data, the library provides a <code>clickstreams.jsp</code> visitor summary page and a supporting <code>viewstream.jsp</code> visitor detail page. </p><p> We'll look first at the <code>ClickstreamFilter</code> class. All these examples are slightly modified from the original, for formatting and to fix portability issues, which I'll discuss later. </p><pre>
import java.io.IOException;
import javax.servlet.*;
import javax.servlet.http.*;

public class ClickstreamFilter implements Filter {
  protected FilterConfig filterConfig;
  private final static String FILTER_APPLIED = "_clickstream_filter_applied";

  public void init(FilterConfig config) throws ServletException {
    this.filterConfig = filterConfig;
  }

  public void doFilter(ServletRequest request, ServletResponse response,
                   FilterChain chain) throws IOException, ServletException {
    // Ensure that filter is only applied once per request.
    if (request.getAttribute(FILTER_APPLIED) == null) {
      request.setAttribute(FILTER_APPLIED, Boolean.TRUE);
      HttpSession session = ((HttpServletRequest)request).getSession();
      Clickstream stream = (Clickstream)session.getAttribute("clickstream");
      stream.addRequest(((HttpServletRequest)request));
    }

    // pass the request on
    chain.doFilter(request, response);
  }

  public void destroy() { }
}
</pre> The <code>doFilter()</code> method gets the user session, obtains the <code>Clickstream</code> from the session, and adds the current request data to the <code>Clickstream</code>. It uses a special <code>FILTER_APPLIED</code> marker attribute to note if the filter was already applied for this request (as might happen during request dispatching) and to ignore any follow-on filtering action. You might be wondering how the filter knows that the <code>clickstream</code> attribute will be present in the session. That's because the <code>ClickstreamLogger</code> places it there when the session is created. Here is the <code>ClickstreamLogger</code> code: <pre>
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class ClickstreamLogger implements ServletContextListener,
                                          HttpSessionListener {
  Map clickstreams = new HashMap();

  public ClickstreamLogger() { }

  public void contextInitialized(ServletContextEvent sce) {
    sce.getServletContext().setAttribute("clickstreams", clickstreams);
  }

  public void contextDestroyed(ServletContextEvent sce) {
    sce.getServletContext().setAttribute("clickstreams", null);
  }

  public void sessionCreated(HttpSessionEvent hse) {
    HttpSession session = hse.getSession();
    Clickstream clickstream = new Clickstream();
    session.setAttribute("clickstream", clickstream);
    clickstreams.put(session.getId(), clickstream);
  }

  public void sessionDestroyed(HttpSessionEvent hse) {
    HttpSession session = hse.getSession();
    Clickstream stream = (Clickstream)session.getAttribute("clickstream");
    clickstreams.remove(session.getId());
  }
}
</pre> The logger receives application events and uses them to bind everything together. On context creation, the logger places a shared map of streams into the context. This allows the <code>clickstreams.jsp</code> page to know what streams are currently active. On context destruction, the logger removes the map. When a new visitor creates a new session, the logger places a new <code>Clickstream</code> instance into the session and adds the <code>Clickstream</code> to the central map of streams. On session destruction, the logger removes the stream from the central map. <p> The following <code>web.xml</code> deployment descriptor snippet wires everything together: </p><pre>
    &lt;filter&gt;
         &lt;filter-name&gt;clickstreamFilter&lt;/filter-name&gt;
         &lt;filter-class&gt;ClickstreamFilter&lt;/filter-class&gt;
    &lt;/filter&gt;

    &lt;filter-mapping&gt;
         &lt;filter-name&gt;clickstreamFilter&lt;/filter-name&gt;
         &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

    &lt;filter-mapping&gt;
         &lt;filter-name&gt;clickstreamFilter&lt;/filter-name&gt;
         &lt;url-pattern&gt;*.html&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

    &lt;listener&gt;
         &lt;listener-class&gt;ClickstreamLogger&lt;/listener-class&gt;
    &lt;/listener&gt;
</pre> This registers the <code>ClickstreamFilter</code> and sets it up to handle <code>*.jsp</code> and <code>*.html</code> requests. This also registers the <code>ClickstreamLogger</code> as a listener to receive application events when they occur. <p> The two JSP pages pull the <code>clickstream</code> data from the session and context objects and use an HTML interface to display the current status. The following <code>clickstreams.jsp</code> file shows the overall summary: </p><pre>
&lt;%@ page import="java.util.*" %&gt;
&lt;%@ page import="Clickstream" %&gt;
&lt;%
Map clickstreams = (Map)application.getAttribute("clickstreams");
String showbots = "false";

if (request.getParameter("showbots") != null) {
  if (request.getParameter("showbots").equals("true"))
    showbots = "true";
  else if (request.getParameter("showbots").equals("both"))
    showbots = "both";
}
%&gt;

&lt;font face="Verdana" size="-1"&gt;
&lt;h1&gt;All Clickstreams&lt;/h1&gt;

&lt;a href="clickstreams.jsp?showbots=false"&gt;No Bots&lt;/a&gt; |
&lt;a href="clickstreams.jsp?showbots=true"&gt;All Bots&lt;/a&gt; |
&lt;a href="clickstreams.jsp?showbots=both"&gt;Both&lt;/a&gt; &lt;p&gt;

&lt;% if (clickstreams.keySet().size() == 0) { %&gt;
        No clickstreams in progress
&lt;% } %&gt;

&lt;%
Iterator it = clickstreams.keySet().iterator();
int count = 0;
while (it.hasNext()) {
  String key = (String)it.next();
  Clickstream stream = (Clickstream)clickstreams.get(key);

  if (showbots.equals("false") &amp;&amp; stream.isBot()) {
    continue;
  }
  else if (showbots.equals("true") &amp;&amp; !stream.isBot()) {
    continue;
  }
  count++;
  try {
%&gt;

&lt;%= count %&gt;.
&lt;a href="viewstream.jsp?sid=&lt;%= key %&gt;"&gt;&lt;b&gt;
&lt;%= (stream.getHostname() != null &amp;&amp; !stream.getHostname().equals("") ?
     stream.getHostname() : "Stream") %&gt;
&lt;/b&gt;&lt;/a&gt; &lt;font size="-1"&gt;[&lt;%= stream.getStream().size() %&gt; reqs]&lt;/font&gt;&lt;br&gt;

&lt;%
  }
  catch (Exception e) {
%&gt;
  An error occurred - &lt;%= e %&gt;&lt;br&gt;
&lt;%
  }
}
%&gt;
</pre> The package is fairly easy to download and install from the OpenSymphony website. Place and compile the Java files in <code>WEB-INF/classes</code>, put the JSP files in the Web application root, and modify the <code>web.xml</code> file as instructed. To save you the hassle of even this much work, you can find a prepackaged WAR file available in <a href="#resources">Resources</a>. <p> For the filter to work on Tomcat 4.0 beta5, I found I had to make some slight portability modifications. The changes I made show some common pitfalls in servlet and filter portability, so I'll list them here: </p>
           <ul> 
            <li>I had to add an extra import line to the JSP files: &lt;%@ page import="Clickstream" %&gt;. In Java you don't have to import classes within your own package, so on servers where JSPs compile into the default package, you don't need an import line like this. But on servers like Tomcat where JSPs compile into a custom package, you have to explicitly import classes in the default package.</li> 
            <li>I had to move the &lt;listener&gt; element in the <code>web.xml</code> file <em>after</em> the &lt;filter&gt; and &lt;filter-mapping&gt; elements, as required by the deployment descriptor DTD. Not all servers require elements to be in the proper order, but Tomcat does.</li> 
            <li>I had to change the <code>web.xml</code> mapping from <code>/*.html</code> and <code>/*.jsp</code> to the more correct <code>*.html</code> and <code>*.jsp</code>. Some servers are forgiving of the leading slash, but Tomcat rigidly enforces the rule that prohibits that slash.</li> 
            <li>Finally, I brought the <code>ClickstreamFilter</code> class up to the latest lifecycle API, changing <code>setFilterConfig()</code> to the newer <code>init()</code> and <code>destroy()</code> methods.</li> 
           </ul> The downloadable WAR contains all these modifications and should run out-of-the-box across servers, although I haven't tested it widely. <p><font size="+1"><strong> Squeeze the response</strong></font><br> The third filter on our menu today automatically compresses the response output stream, improving bandwidth utilization and providing a great demonstration of response object wrapping. This filter is based on one written by Amy Roh from Sun who contributed it to the Tomcat 4.0 "examples" Web application. You'll find the original code under <code>webapps/examples/WEB-INF/classes/compressionFilters</code>. That filter is available under the standard Apache license. The example code shown here and in the WAR has been edited for clarity and simplicity. </p><p> The strategy of the <code>CompressionFilter</code> class is to examine the request headers to determine if the client supports compression, and if so, wrap the response object with a custom response whose <code>getOutputStream()</code> and <code>getWriter()</code> methods have been customized to utilize a compressed output stream. Using filters allows such a simple yet powerful solution. </p><p> Looking at the code, we'll start with the filter's <code>init()</code> method: </p><pre>
  public void init(FilterConfig filterConfig) {
    config = filterConfig;
    compressionThreshold = 0;
    if (filterConfig != null) {
      String str = filterConfig.getInitParameter("compressionThreshold");
      if (str != null) {
        compressionThreshold = Integer.parseInt(str);
      }
      else {
        compressionThreshold = 0;
      }
    }
  }
</pre> When called before the filter is put into service, this <code>init()</code> method looks for the presence of a filter <code>init</code> parameter to determine the compression threshold -- the amount of bytes that must be in the response before it's worth compressing. <p> The <code>doFilter()</code> method, called when the request comes in, retrieves the <code>Accept-Encoding</code> header, and if the header value includes <code>gzip</code>, wraps the response and sets the threshold on the wrapper: </p><pre>
  public void doFilter(ServletRequest request, ServletResponse response,
                    FilterChain chain ) throws IOException, ServletException {
    boolean supportCompression = false;
    if (request instanceof HttpServletRequest) {
      Enumeration e = ((HttpServletRequest)request)
                           .getHeaders("Accept-Encoding");
      while (e.hasMoreElements()) {
        String name = (String)e.nextElement();
        if (name.indexOf("gzip") != -1) {
          supportCompression = true;
        }
      }
    }
    if (!supportCompression) {
      chain.doFilter(request, response);
    }
    else {
      if (response instanceof HttpServletResponse) {
        CompressionResponseWrapper wrappedResponse =
          new CompressionResponseWrapper((HttpServletResponse)response);
        wrappedResponse.setCompressionThreshold(compressionThreshold);
        chain.doFilter(request, wrappedResponse);
      }
    }
  }
</pre> Notice how the request must be cast to an <code>HttpServletRequest</code> before retrieving headers, just as with the first example. The filter uses the wrapper class <code>CompressionResponseWrapper</code>, a custom class extending the standard <code>HttpServletResponseWrapper</code>. The code for the wrapper is relatively simple: <pre>
public class CompressionResponseWrapper extends HttpServletResponseWrapper {

  protected ServletOutputStream stream = null;
  protected PrintWriter writer = null;
  protected int threshold = 0;
  protected HttpServletResponse origResponse = null;

  public CompressionResponseWrapper(HttpServletResponse response) {
    super(response);
    origResponse = response;
  }

  public void setCompressionThreshold(int threshold) {
    this.threshold = threshold;
  }

  public ServletOutputStream createOutputStream() throws IOException {
    return (new CompressionResponseStream(origResponse));
  }

  public ServletOutputStream getOutputStream() throws IOException {
    if (writer != null) {
      throw new IllegalStateException("getWriter() has already been " +
                                      "called for this response");
    }

    if (stream == null) {
      stream = createOutputStream();
    }
    ((CompressionResponseStream) stream).setCommit(true);
    ((CompressionResponseStream) stream).setBuffer(threshold);
    return stream;
  }

  public PrintWriter getWriter() throws IOException {
    if (writer != null) {
      return writer;
    }

    if (stream != null) {
      throw new IllegalStateException("getOutputStream() has already " +
                                      "been called for this response");
    }

    stream = createOutputStream();
    ((CompressionResponseStream) stream).setCommit(true);
    ((CompressionResponseStream) stream).setBuffer(threshold);
    writer = new PrintWriter(stream);
    return writer;
  }
}
</pre> Any call to <code>getOutputStream()</code> or <code>getWriter()</code> returns an object using <code>CompressResponseStream</code> under the covers. The <code>CompressionResponseStream</code> class isn't shown in this example, but it extends <code>ServletOutputStream</code> and compresses the stream using the <code>java.util.zip.GZIPOutputStream</code> class. <p> The Tomcat "examples" Web application comes preconfigured with the compression filter enabled with an example servlet set up. The example servlet responds to the <code>/CompressionTest</code> URL (make sure to prepend the <code>/examples</code> context path). With the WAR file I've made available, you can access the test servlet at <code>/servlet/compressionTest</code> (again, remember to prepend the appropriate context path). You can use the following <code>web.xml</code> snippet to configure the test. </p><pre>
&lt;filter&gt;
    &lt;filter-name&gt;compressionFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;CompressionFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;compressionThreshold&lt;/param-name&gt;
      &lt;param-value&gt;10&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;compressionFilter&lt;/filter-name&gt;
    &lt;servlet-name&gt;compressionTest&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;

&lt;servlet&gt;
  &lt;servlet-name&gt;
    compressionTest
  &lt;/servlet-name&gt;
  &lt;servlet-class&gt;
    CompressionTestServlet
  &lt;/servlet-class&gt;
&lt;/servlet&gt;
</pre> The <code>CompressionTestServlet</code> (not shown here) prints whether or not the compression was possible, and when possible, announces the success with a compressed response! <p><font size="+1"><strong> File upload filter</strong></font><br> The final filter we'll look at handles multipart/form-data <code>POST</code> requests, the type of request that can contain file uploads. Each multipart/form-data <code>POST</code> request contains any number of parameters and files, using a special format not natively understood by servlets. Servlet developers have historically used third-party classes to handle the uploads, such as the <code>MultipartRequest</code> and <code>MultipartParser</code> classes found in my own <code>com.oreilly.servlet</code> package. Here we see a new approach using a <code>MultipartFilter</code> to make the handling of such requests easier. The filter builds on the parsers in the <code>com.oreilly.servlet</code> package and has been integrated into the package. (See <a href="#resources">Resources</a>.) </p><p> The <code>MultipartFilter</code> works by watching incoming requests and when it detects a file upload request (with the content type <code>multipart/form-data</code>), the filter wraps the request object with a special request wrapper that knows how to parse the special content type format. A servlet receiving the special request wrapper has seamless access to the multipart parameters through the standard <code>getParameter()</code> methods, because the wrapper has redefined the behavior of those methods. The servlet can also handle uploaded files by casting the request to the wrapper type and using the additional <code>getFile()</code> methods on the wrapper. </p><p> Here is the code for the filter: </p><pre>
package com.oreilly.servlet;

import java.io.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class MultipartFilter implements Filter {

  private FilterConfig config = null;
  private String dir = null;

  public void init(FilterConfig config) throws ServletException {
    this.config = config;

    // Determine the upload directory.  First look for an uploadDir filter
    // init parameter.  Then look for the context tempdir.
    dir = config.getInitParameter("uploadDir");
    if (dir == null) {
      File tempdir = (File) config.getServletContext()
                  .getAttribute("javax.servlet.context.tempdir");
      if (tempdir != null) {
        dir = tempdir.toString();
      }
      else {
        throw new ServletException(
          "MultipartFilter: No upload directory found: set an uploadDir " +
          "init parameter or ensure the javax.servlet.context.tempdir " +
          "directory is valid");
      }
    }
  }

  public void destroy() {
    config = null;
  }

  public void doFilter(ServletRequest request, ServletResponse response,
                     FilterChain chain) throws IOException, ServletException {
    HttpServletRequest req = (HttpServletRequest) request;
    String type = req.getHeader("Content-Type");

    // If this is not a multipart/form-data request continue
    if (type == null || !type.startsWith("multipart/form-data")) {
      chain.doFilter(request, response);
    }
    else {
      MultipartWrapper multi = new MultipartWrapper(req, dir);
      chain.doFilter(multi, response);
    }
  }
}
</pre> The <code>init()</code> method determines the file upload directory. This is the location where the multipart parser places files, so that the entire request doesn't have to reside in memory. It looks first for an <code>uploadDir</code> filter <code>init</code> parameter, and failing to find that, defaults to the <code>tempdir</code> directory -- a standard context attribute added in Servlet API 2.2. <p> The <code>doFilter()</code> method examines the request content type, and should it be a <code>multipart/form-data</code> request, wraps the request with a <code>MultipartWrapper</code>. The wrapper code looks like this: </p><pre>
package com.oreilly.servlet;

import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class MultipartWrapper extends HttpServletRequestWrapper {

  MultipartRequest mreq = null;

  public MultipartWrapper(HttpServletRequest req, String dir)
                                     throws IOException {
    super(req);
    mreq = new MultipartRequest(req, dir);
  }

  // Methods to replace HSR methods
  public Enumeration getParameterNames() {
    return mreq.getParameterNames();
  }
  public String getParameter(String name) {
    return mreq.getParameter(name);
  }
  public String[] getParameterValues(String name) {
    return mreq.getParameterValues(name);
  }
  public Map getParameterMap() {
    Map map = new HashMap();
    Enumeration enum = getParameterNames();
    while (enum.hasMoreElements()) {
      String name = (String) enum.nextElement();
      map.put(name, mreq.getParameterValues(name));
    }
    return map;
  }

  // Methods only in MultipartRequest
  public Enumeration getFileNames() {
    return mreq.getFileNames();
  }
  public String getFilesystemName(String name) {
    return mreq.getFilesystemName(name);
  }
  public String getContentType(String name) {
    return mreq.getContentType(name);
  }
  public File getFile(String name) {
    return mreq.getFile(name);
  }
}
</pre> The wrapper constructs a <code>com.oreilly.servlet.MultipartRequest</code> object to handle the upload parsing and overrides the <code>getParameter()</code> family of methods to use the <code>MultipartRequest</code> rather than the raw request to read parameter values. The wrapper also defines various <code>getFile()</code> methods so that a servlet receiving this wrapped request can call additional methods to handle the uploaded files. <p> The <code>web.xml</code> deployment descriptor adds the filter like this: </p><pre>
&lt;filter&gt;
    &lt;filter-name&gt;multipartFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.oreilly.servlet.MultipartFilter&lt;/filter-class&gt;
    &lt;!--
    &lt;init-param&gt;
      &lt;param-name&gt;uploadDir&lt;/param-name&gt;
      &lt;param-value&gt;/tmp&lt;/param-value&gt;
    &lt;/init-param&gt;
    --&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;multipartFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;servlet&gt;
    &lt;servlet-name&gt;
        uploadTest
    &lt;/servlet-name&gt;
    &lt;servlet-class&gt;
        UploadTest
    &lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;
        uploadTest
    &lt;/servlet-name&gt;
    &lt;url-pattern&gt;
        /uploadTest
    &lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</pre> The <code>UploadTest</code> servlet looks like this: <pre>
import java.io.*;
import java.util.*;
import javax.servlet.*;
import javax.servlet.http.*;

import com.oreilly.servlet.*;

public class UploadTest extends HttpServlet {

  public void doPost(HttpServletRequest req, HttpServletResponse res)
                                throws ServletException, IOException {
    res.setContentType("text/html");
    PrintWriter out = res.getWriter();

    out.println("&lt;HTML&gt;");
    out.println("&lt;HEAD&gt;&lt;TITLE&gt;UploadTest&lt;/TITLE&gt;&lt;/HEAD&gt;");
    out.println("&lt;BODY&gt;");
    out.println("&lt;H1&gt;UploadTest&lt;/H1&gt;");

    // Parameters can now be read the same way for both
    // application/x-www-form-urlencoded and multipart/form-data requests!

    out.println("&lt;H3&gt;Request Parameters:&lt;/H3&gt;&lt;PRE&gt;");
    Enumeration enum = req.getParameterNames();
    while (enum.hasMoreElements()) {
      String name = (String) enum.nextElement();
      String values[] = req.getParameterValues(name);
      if (values != null) {
        for (int i = 0; i &lt; values.length; i++) {
          out.println(name + " (" + i + "): " + values[i]);
        }
      }
    }
    out.println("&lt;/PRE&gt;");

    // Files can be read if the request class is MultipartWrapper
    // Init params to MultipartWrapper control the upload handling

    if (req instanceof MultipartWrapper) {
      try {
        // Cast the request to a MultipartWrapper
        MultipartWrapper multi = (MultipartWrapper) req;

        // Show which files we received
        out.println("&lt;H3&gt;Files:&lt;/H3&gt;");
        out.println("&lt;PRE&gt;");
        Enumeration files = multi.getFileNames();
        while (files.hasMoreElements()) {
          String name = (String)files.nextElement();
          String filename = multi.getFilesystemName(name);
          String type = multi.getContentType(name);
          File f = multi.getFile(name);
          out.println("name: " + name);
          out.println("filename: " + filename);
          out.println("type: " + type);
          if (f != null) {
            out.println("length: " + f.length());
          }
          out.println();
        }
        out.println("&lt;/PRE&gt;");
      }
      catch (Exception e) {
        out.println("&lt;PRE&gt;");
        e.printStackTrace(out);
        out.println("&lt;/PRE&gt;");
      }
    }

    out.println("&lt;/BODY&gt;&lt;/HTML&gt;");
  }
}
</pre> The first half of the servlet shows how the filter exposes parameter data without any change to the receiving servlet. The second half shows how a servlet can downcase the request to a <code>MultipartWrapper</code> in order to expose the additional file-access methods. <p> An example HTML form to drive this servlet is shown here: </p><pre>
&lt;FORM ACTION="uploadTest" ENCTYPE="multipart/form-data" METHOD=POST&gt;
What is your name? &lt;INPUT TYPE=TEXT NAME=submitter&gt; &lt;BR&gt;
What is your age? &lt;INPUT TYPE=TEXT NAME=age&gt; &lt;BR&gt;
Which file do you want to upload? &lt;INPUT TYPE=FILE NAME=file1&gt;
&lt;BR&gt;
Any other file to upload? &lt;INPUT TYPE=FILE NAME=file2&gt; &lt;BR&gt;
&lt;INPUT TYPE=SUBMIT&gt;
&lt;/FORM&gt;
</pre> Here's some possible output: <pre>
UploadTest
Request Parameters:
submitter (0): Jason
age (0): 28

Files:
name: file1
filename: 4008b21.tif
type: application/octet-stream
length: 39396

name: file2
filename: null
type: null
</pre> Some of you may be wondering what assurance we have that the <code>MultipartWrapper</code> set by the filter will be directly exposed to the follow-on servlet. In the specification Public Draft #2 and in Tomcat 4.0 beta5, there is no guarantee. In fact, if you try to access the servlet as <code>/servlet/UploadTest</code>, you'll notice the filtering doesn't work quite right, because the invoker handling <code>/servlet</code> wraps the <code>MultipartWrapper</code> with its own Tomcat-specific wrapper. This allows the parameters to be parsed correctly, but the file access methods won't be directly exposed. In discussing this issue with the Servlet API expert group, we've decided that the servlet container shouldn't do further wrapping beyond the filter's wrapper. The servlet specification will be updated to make that clear. Later betas of Tomcat 4.0 will comply with the clarified rules. A short-term workaround is to use the <code>getRequest()</code> method in the request wrapper to "walk up" the request to find the shadowed multipart wrapper. <p><font size="+1"><strong> Filter power</strong></font><br> Servlet filters provide a powerful ability to control request processing and response generation, providing new functionality to servlets without large amounts of servlet coding. I hope these filters have shown you some of what is possible to do with filters, and taught you some tricks about how to make the most effective use of the new filter mechanism. </p><p> <em> My thanks to the authors of these filters and to the people who suggested useful filters to write about: Amy Roh, Criag McClanahan, Serge Knystautas, and the folks at OpenSymphony. </em> </p><p><strong>About the author</strong><br> <a href="../jason/">Jason Hunter</a> is a senior technologist with <a href="http://collab.net">CollabNet</a>, a company that provides tools and services for collaborative software development based on open source concepts. He is author of <em>Java Servlet Programming, 2nd Edition</em> (O'Reilly, April 2001), publisher of Servlets.com, and contributor to Apache Tomcat (starting on the project when it was still Sun internal). He is also a member of the expert groups responsible for Servlet/JSP and JAXP API development, and holds a seat on the JCP Executive Committee overseeing the Java platform, as a representative of the Apache Software Foundation. Most recently he co-created the open source <a href="http://www.jdom.org">JDOM</a> library to enable optimized Java and XML integration. <br></p> <i>To be notified when new articles are added to the site, <a href="../lists/subscribe.html">subscribe here</a>.</i> <p></p>
           <ul>
            <a name="resources"><strong>Resources</strong></a> 
            <br> Download the WAR files from: 
            <ul> 
             <li><a href="filters/timer.war">http://www.servlets.com/soapbox/filters/timer.war</a> </li>
             <li><a href="filters/clickstream.war">http://www.servlets.com/soapbox/filters/clickstream.war</a> </li>
             <li><a href="filters/compress.war">http://www.servlets.com/soapbox/filters/compress.war</a> </li>
             <li><a href="filters/multipart.war">http://www.servlets.com/soapbox/filters/multipart.war</a> </li>
            </ul> 
            <li>Apache Tomcat, the open source servlet reference implementation: <br><a href="http://jakarta.apache.org">http://jakarta.apache.org </a><br> </li>
            <li>OpenSymphony's Website: <br><a href="http://www.opensymphony.com/">http://www.opensymphony.com/ </a><br> </li>
            <li>Information on Jason's new book <em>Java Servlet Programming, 2nd Edition</em> (O'Reilly, April 2001; ISBN: 0596000405): <br><a href="http://www.servlets.com/book">http://www.servlets.com/book </a><br> </li>
            <li>The com.oreilly.servlet package with file upload abilities: <br><a href="http://www.servlets.com/cos">http://www.servlets.com/cos </a><br> </li>
            <li>Official home page for servlets: <br><a href="http://java.sun.com/products/servlet">http://java.sun.com/products/servlet </a><br> </li>
            <li>More Servlet API articles by Jason Hunter: <br><a href="./">http://www.servlets.com/soapbox/ </a><br> </li>
            <li>Jason's new pet project: <br><a href="http://www.jdom.org">http://www.jdom.org </a><br> <br> </li>
           </ul><br><p></p> <br><br> </font> 
          <!-- #EndEditable -->  <p>&nbsp;</p> 
          <hr> <font face="Arial,Helvetica"> 
           <div align="center">
            <font size="-1"><a href="../index.tea">Home</a>&nbsp;&nbsp; 
             <!--<A HREF="http://careers.servlets.com">Jobs</A>&nbsp;&nbsp; --> <a href="../cos">com.oreilly.servlet</a>&nbsp;&nbsp; <a href="../polls">Polls</a>&nbsp;&nbsp;&nbsp;<a href="../lists">Lists</a>&nbsp;&nbsp;&nbsp;<a href="../archive">Archives</a><br> <a href="../engines">Engines</a>&nbsp;&nbsp; <a href="../isps">ISPs</a>&nbsp;&nbsp;&nbsp;<a href="../tools">Tools</a>&nbsp;&nbsp;&nbsp;<a href="../docs">Docs</a>&nbsp;&nbsp;&nbsp;<a href="../articles">Articles</a>&nbsp;&nbsp;&nbsp;<a href="../soapbox">Soapbox</a>&nbsp;&nbsp;&nbsp;<a href="../jservlet2">Book</a></font>
           </div> </font> <br> 
          <!-- begin copyright area --> 
          <table width="100%"> 
           <tbody>
            <tr> 
             <td width="260" align="left" valign="top"> <font face="Arial,Helvetica"> <a href="../copyright.html"><font size="-1">Copyright</font></a> <font size="-1"> 1999-2005 Jason Hunter<br> <a href="http://www.oreillynet.com/pub/a/mediakit/privacy.html">Privacy Policy</a></font></font></td> 
             <td width="5"></td> 
             <td width="230" align="right" valign="top"> <p><font face="Arial,Helvetica"><font size="-1">webmaster@<b></b>servlets.com</font><font size="-1"><br> Last updated: 
                 <!-- #BeginDate format:Am1 -->March 1, 2009
                 <!-- #EndDate --> </font></font></p> </td> 
            </tr> 
           </tbody>
          </table> 
          <!-- end copyright area --> </td> 
        </tr> 
       </tbody>
      </table> </td> 
    </tr> 
   </tbody>
  </table>  
  <!-- #EndTemplate --> 
 </body>
</html>